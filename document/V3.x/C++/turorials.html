<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高频接口实战 | 二次开发</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/vuepress/logo.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.56d99626.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.00e88e4b.js" as="script"><link rel="preload" href="/vuepress/assets/js/4.fa06e885.js" as="script"><link rel="preload" href="/vuepress/assets/js/3.26fa4d2a.js" as="script"><link rel="preload" href="/vuepress/assets/js/1.23a03b08.js" as="script"><link rel="preload" href="/vuepress/assets/js/2.87db2cf7.js" as="script"><link rel="preload" href="/vuepress/assets/js/48.97909949.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.3c6ce834.js"><link rel="prefetch" href="/vuepress/assets/js/11.09762753.js"><link rel="prefetch" href="/vuepress/assets/js/14.b5e2fe37.js"><link rel="prefetch" href="/vuepress/assets/js/15.7779f75a.js"><link rel="prefetch" href="/vuepress/assets/js/16.dcb00087.js"><link rel="prefetch" href="/vuepress/assets/js/17.f5f97815.js"><link rel="prefetch" href="/vuepress/assets/js/18.a375d3e9.js"><link rel="prefetch" href="/vuepress/assets/js/19.8255e001.js"><link rel="prefetch" href="/vuepress/assets/js/20.11877118.js"><link rel="prefetch" href="/vuepress/assets/js/21.81070543.js"><link rel="prefetch" href="/vuepress/assets/js/22.a328fa26.js"><link rel="prefetch" href="/vuepress/assets/js/23.7b70a74b.js"><link rel="prefetch" href="/vuepress/assets/js/24.39eca4c0.js"><link rel="prefetch" href="/vuepress/assets/js/25.38a534ba.js"><link rel="prefetch" href="/vuepress/assets/js/26.6196ca23.js"><link rel="prefetch" href="/vuepress/assets/js/27.a2364143.js"><link rel="prefetch" href="/vuepress/assets/js/28.fb371d5d.js"><link rel="prefetch" href="/vuepress/assets/js/29.4b99363f.js"><link rel="prefetch" href="/vuepress/assets/js/30.23eeb12e.js"><link rel="prefetch" href="/vuepress/assets/js/31.305ec918.js"><link rel="prefetch" href="/vuepress/assets/js/32.fbc59b8b.js"><link rel="prefetch" href="/vuepress/assets/js/33.18dcd7ec.js"><link rel="prefetch" href="/vuepress/assets/js/34.7b0015f8.js"><link rel="prefetch" href="/vuepress/assets/js/35.b9d97528.js"><link rel="prefetch" href="/vuepress/assets/js/36.3bb2aed9.js"><link rel="prefetch" href="/vuepress/assets/js/37.ac45cea3.js"><link rel="prefetch" href="/vuepress/assets/js/38.a7eaab77.js"><link rel="prefetch" href="/vuepress/assets/js/39.b7a4e0d4.js"><link rel="prefetch" href="/vuepress/assets/js/40.fab28343.js"><link rel="prefetch" href="/vuepress/assets/js/41.f1fcf13e.js"><link rel="prefetch" href="/vuepress/assets/js/42.e0e8a79c.js"><link rel="prefetch" href="/vuepress/assets/js/43.676b60dd.js"><link rel="prefetch" href="/vuepress/assets/js/44.3c5d9688.js"><link rel="prefetch" href="/vuepress/assets/js/45.4410b748.js"><link rel="prefetch" href="/vuepress/assets/js/46.7c006e1c.js"><link rel="prefetch" href="/vuepress/assets/js/47.47319090.js"><link rel="prefetch" href="/vuepress/assets/js/49.544c8551.js"><link rel="prefetch" href="/vuepress/assets/js/5.73d34e77.js"><link rel="prefetch" href="/vuepress/assets/js/50.be8f7bd4.js"><link rel="prefetch" href="/vuepress/assets/js/51.b0dd1782.js"><link rel="prefetch" href="/vuepress/assets/js/52.033c6fd9.js"><link rel="prefetch" href="/vuepress/assets/js/53.fa6b74e1.js"><link rel="prefetch" href="/vuepress/assets/js/54.32fd1eea.js"><link rel="prefetch" href="/vuepress/assets/js/55.c770b928.js"><link rel="prefetch" href="/vuepress/assets/js/56.a33c6382.js"><link rel="prefetch" href="/vuepress/assets/js/57.7a48349c.js"><link rel="prefetch" href="/vuepress/assets/js/6.ede881a6.js"><link rel="prefetch" href="/vuepress/assets/js/7.75b85482.js"><link rel="prefetch" href="/vuepress/assets/js/8.ff8c51a6.js"><link rel="prefetch" href="/vuepress/assets/js/9.9c71da5b.js"><link rel="prefetch" href="/vuepress/assets/js/vendors~docsearch.638bbdd1.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.56d99626.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-98796a12><div data-v-98796a12><div class="password-shadow password-wrapper-out" style="display:none;" data-v-08f61db9 data-v-98796a12 data-v-98796a12><h3 class="title" data-v-08f61db9>二次开发</h3> <p class="description" data-v-08f61db9>Just playing around</p> <label id="box" class="inputBox" data-v-08f61db9><input type="password" value="" data-v-08f61db9> <span data-v-08f61db9>Konck! Knock!</span> <button data-v-08f61db9>OK</button></label> <div class="footer" data-v-08f61db9><span data-v-08f61db9><i class="iconfont reco-theme" data-v-08f61db9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-08f61db9>vuePress-theme-reco</a></span> <span data-v-08f61db9><i class="iconfont reco-copyright" data-v-08f61db9></i> <a data-v-08f61db9><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-98796a12><header class="navbar" data-v-98796a12><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="nav-home-link"><a href="/vuepress/" class="home-link router-link-active"><img src="/vuepress/jida_logo.png" alt="二次开发" class="logo"></a> <div class="nav-home-text"><span class="site-name">二次开发</span> <div class="color-picker"><a class="color-button"><i class="iconfont reco-theme"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><ul class="color-mode-options"><li class="light">护眼模式</li><li class="dark">暗黑模式</li></ul></div></div></div></div></div> <div class="links"><div class="second-link"><img src="/vuepress/link-icon.png">
      二次开发工具包
    </div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      C++ 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link"><i class="undefined"></i>
  Python3
</a></li><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  C++
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      V3.x 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  V3.x
</a></li></ul></div></div><div class="nav-item"><a href="https://www.jidatraffic.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  TESS NG 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/jida-traffic/TESSNG_SecondaryDev_Doc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-98796a12></div> <aside class="sidebar" data-v-98796a12><div class="side-top" data-v-98796a12><div class="search-box" data-v-98796a12><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      C++ 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link"><i class="undefined"></i>
  Python3
</a></li><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  C++
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      V3.x 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  V3.x
</a></li></ul></div></div><div class="nav-item"><a href="https://www.jidatraffic.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  TESS NG 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/jida-traffic/TESSNG_SecondaryDev_Doc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/vuepress/document/V3.x/C++/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/vuepress/document/V3.x/C++/1-changelog.html" class="sidebar-link">更新日志</a></li><li><a href="/vuepress/document/V3.x/C++/install.html" class="sidebar-link">软件安装</a></li><li><a href="/vuepress/document/V3.x/C++/quickstart.html" class="sidebar-link">快速入门</a></li><li><a href="/vuepress/document/V3.x/C++/details.html" class="sidebar-link">接口详解</a></li><li><a href="/vuepress/document/V3.x/C++/turorials.html" aria-current="page" class="active sidebar-link">典型接口案例</a></li><li><a href="/vuepress/document/V3.x/C++/demo.html" class="sidebar-link">行业案例</a></li><li><a href="/vuepress/document/V3.x/C++/2-information.html" class="sidebar-link">注意事项</a></li><li><a href="/vuepress/document/V3.x/C++/3-QA.html" class="sidebar-link">问答列表</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-08f61db9 data-v-98796a12><h3 class="title" data-v-08f61db9></h3> <!----> <label id="box" class="inputBox" data-v-08f61db9><input type="password" value="" data-v-08f61db9> <span data-v-08f61db9>Konck! Knock!</span> <button data-v-08f61db9>OK</button></label> <div class="footer" data-v-08f61db9><span data-v-08f61db9><i class="iconfont reco-theme" data-v-08f61db9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-08f61db9>vuePress-theme-reco</a></span> <span data-v-08f61db9><i class="iconfont reco-copyright" data-v-08f61db9></i> <a data-v-08f61db9><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-98796a12><div data-v-98796a12><main class="page"><section style="display:;"><div class="theme-reco-content content__default"><h1 id="高频接口实战"><a href="#高频接口实战" class="header-anchor">#</a> 高频接口实战</h1> <table><thead><tr><th>大类</th> <th>功能点</th></tr></thead> <tbody><tr><td>仿真窗口操作</td> <td>自定义菜单栏；自定义按钮事件</td></tr> <tr><td>路网编辑</td> <td>新建路网</td></tr> <tr><td></td> <td>获取，修改，删除路网</td></tr> <tr><td></td> <td>新增编辑路网上的附着物</td></tr> <tr><td>信控编辑</td> <td>新建信号灯</td></tr> <tr><td></td> <td>信号灯组新建，编辑</td></tr> <tr><td></td> <td>双环信控方案下发</td></tr> <tr><td>需求加载与管理</td> <td>流量加载</td></tr> <tr><td></td> <td>路径管理</td></tr> <tr><td></td> <td>路径重构</td></tr> <tr><td>仿真运行</td> <td>流程控制</td></tr> <tr><td></td> <td>动作控制</td></tr> <tr><td></td> <td>管控手段控制</td></tr> <tr><td>底层模型修改</td> <td>跟驰模型</td></tr> <tr><td></td> <td>换道模型</td></tr> <tr><td></td> <td>冲突交互模型（暂不支持二次开发）</td></tr> <tr><td></td> <td>车辆汇入模型</td></tr> <tr><td></td> <td>车辆穿越模型</td></tr> <tr><td>仿真输出</td> <td>检测器编辑</td></tr> <tr><td></td> <td>采集器编辑</td></tr> <tr><td></td> <td>输出控制</td></tr> <tr><td>特殊应用场景</td> <td>公交系统</td></tr> <tr><td></td> <td>行人系统</td></tr> <tr><td></td> <td>停车场系统</td></tr> <tr><td></td> <td>收费站系统</td></tr></tbody></table> <p>本章所有接口范例均可在安装包《安装目录/SecondaryDevCases/SecondaryDevCases.h》中找到；用户可以到GitHub下载</p> <p><a href="https://github.com/jida-traffic/TESSNG_SecondaryDev_Doc" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="">官网下载</a>:</p> <h2 id="_1-界面交互"><a href="#_1-界面交互" class="header-anchor">#</a> 1. 界面交互</h2> <h3 id="_1-1-增加菜单及菜单项"><a href="#_1-1-增加菜单及菜单项" class="header-anchor">#</a> 1.1. 增加菜单及菜单项</h3> <p>可以在main()方法中实例化TESS NG后创建菜单及菜单项，代码如下:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QMainWindow <span class="token operator">*</span>pWindow <span class="token operator">=</span> <span class="token function">tessng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pWindow<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		QMenuBar <span class="token operator">*</span>pMenuBar <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">guiInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">menuBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QMenu <span class="token operator">*</span>pMenu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QMenu</span><span class="token punctuation">(</span>pMenuBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pMenu<span class="token operator">-&gt;</span><span class="token function">setObjectName</span><span class="token punctuation">(</span><span class="token class-name">QString</span><span class="token double-colon punctuation">::</span><span class="token function">fromUtf8</span><span class="token punctuation">(</span><span class="token string">&quot;menuExample&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pMenuBar<span class="token operator">-&gt;</span><span class="token function">addAction</span><span class="token punctuation">(</span>pMenu<span class="token operator">-&gt;</span><span class="token function">menuAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pMenu<span class="token operator">-&gt;</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">QString</span><span class="token double-colon punctuation">::</span><span class="token function">fromLocal8Bit</span><span class="token punctuation">(</span><span class="token string">&quot;范例菜单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		QAction <span class="token operator">*</span>pActionOk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAction</span><span class="token punctuation">(</span>pMenuBar<span class="token operator">-&gt;</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pActionOk<span class="token operator">-&gt;</span><span class="token function">setObjectName</span><span class="token punctuation">(</span><span class="token string">&quot;actionExample&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pActionOk<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">QString</span><span class="token double-colon punctuation">::</span><span class="token function">fromLocal8Bit</span><span class="token punctuation">(</span><span class="token string">&quot;范例菜单项&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pActionOk<span class="token operator">-&gt;</span><span class="token function">setCheckable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		pMenu<span class="token operator">-&gt;</span><span class="token function">addAction</span><span class="token punctuation">(</span>pActionOk<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span>pActionOk<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QAction<span class="token double-colon punctuation">::</span>triggered<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span>gpTessInterface<span class="token operator">-&gt;</span><span class="token function">guiInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">mainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">QString</span><span class="token double-colon punctuation">::</span><span class="token function">fromLocal8Bit</span><span class="token punctuation">(</span><span class="token string">&quot;提示&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">&quot;is ok!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>结果如下：</p> <p><img src="/vuepress/img/%E9%AB%98%E9%A2%91%E6%8E%A5%E5%8F%A3%E5%AE%9E%E6%88%98_%E5%9B%BE1%E5%88%9B%E5%BB%BA%E8%8C%83%E4%BE%8B%E8%8F%9C%E5%8D%95.png" alt="创建范例菜单"></p> <p>点击菜单项“范例菜单项”弹出对话框：</p> <p><img src="/vuepress/img/%E9%AB%98%E9%A2%91%E6%8E%A5%E5%8F%A3%E5%AE%9E%E6%88%98_%E5%9B%BE2%E8%8C%83%E4%BE%8B%E8%8F%9C%E5%8D%95%E7%82%B9%E5%87%BB%E6%95%88%E6%9E%9C.png" alt="范例菜单点击效果"></p> <p>如果希望增加菜单的功能放到插件的动态库中，让TESS NG加载插件时创建菜单，则上述代码需要移至插件接口的实现代码中，如范例；将上述代码放到TessPlugin的initGui()方法中。</p> <h3 id="_1-2-获取车辆在路网二维平面上所有可移动的轨迹"><a href="#_1-2-获取车辆在路网二维平面上所有可移动的轨迹" class="header-anchor">#</a> 1.2. <strong>获取车辆在路网二维平面上所有可移动的轨迹</strong></h3> <p>路网二维平面主要由路段连接段组成，路段由路段自身和车道组成，连接段由连接段自身和“车道连接”组成，路段、车道、“车道连接”都存在中心线断点序列，车辆都是在这些点构成的线上移动的。取得这些断点序列的步骤如下：</p> <p>1）获取所有路段；</p> <p>2）获取路段的所有车道；</p> <p>3）获取车道的中心线断点序列</p> <p>4）获取所有连接段</p> <p>5）获取连接段的所有“车道连接”</p> <p>6）获取“车道连接”中心线断点序列</p> <p>实现的代码如下：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//获取所有路段</span>
	QList<span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span> lLink <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">links</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">foreach</span><span class="token punctuation">(</span>ILink <span class="token operator">*</span>pLink<span class="token punctuation">,</span> lLink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QList<span class="token operator">&lt;</span>ILane<span class="token operator">*</span><span class="token operator">&gt;</span> lLane <span class="token operator">=</span> pLink<span class="token operator">-&gt;</span><span class="token function">lanes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">foreach</span><span class="token punctuation">(</span>ILane <span class="token operator">*</span>pLane<span class="token punctuation">,</span> lLane<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoint<span class="token operator">=</span> pLane<span class="token operator">-&gt;</span><span class="token function">centerBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token comment">//获取所有连接段</span>
	QList<span class="token operator">&lt;</span>IConnector<span class="token operator">*</span><span class="token operator">&gt;</span> lConn <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">connectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">foreach</span><span class="token punctuation">(</span>IConnector <span class="token operator">*</span>pConn<span class="token punctuation">,</span> lConn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QList<span class="token operator">&lt;</span>ILaneConnector<span class="token operator">*</span><span class="token operator">&gt;</span> lLaneConn <span class="token operator">=</span> pConn<span class="token operator">-&gt;</span><span class="token function">laneConnectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">foreach</span><span class="token punctuation">(</span>ILaneConnector <span class="token operator">*</span>pLC<span class="token punctuation">,</span> lLaneConn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoint <span class="token operator">=</span> pLC<span class="token operator">-&gt;</span><span class="token function">centerBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-3-增加车辆显示内容"><a href="#_1-3-增加车辆显示内容" class="header-anchor">#</a> 1.3. <strong>增加车辆显示内容</strong></h3> <p>下图展示自动驾驶车辆，雷达探测范围100米。</p> <p><img src="/vuepress/img/%E9%AB%98%E9%A2%91%E6%8E%A5%E5%8F%A3%E5%AE%9E%E6%88%98_%E5%A2%9E%E5%8A%A0%E8%BD%A6%E8%BE%86%E6%98%BE%E7%A4%BA%E5%86%85%E5%AE%B9.png" alt="自动驾驶车辆雷达展示"></p> <p>为了增添车辆展示的内容，可以实现接口CustomerSimulator的如下方法：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">rePaintVehicle</span> <span class="token punctuation">(</span>IVehicle <span class="token operator">*</span>pIVehicle<span class="token punctuation">,</span> QPainter <span class="token operator">*</span>painter<span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-路网编辑"><a href="#_2-路网编辑" class="header-anchor">#</a> 2. 路网编辑</h2> <h3 id="_2-1-代码新建路网"><a href="#_2-1-代码新建路网" class="header-anchor">#</a> 2.1.  代码新建路网</h3> <p>1- 新建link</p> <p>2- 新建connector</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//第一条路段</span>
	QPointF startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QPointF endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink1 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;曹安公路&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//创建发车点</span>
		IDispatchPoint <span class="token operator">*</span>pDp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDispatchPoint</span><span class="token punctuation">(</span>pLink1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pDp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pDp<span class="token operator">-&gt;</span><span class="token function">addDispatchInterval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第二条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink2 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;次干道&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//创建发车点</span>
		IDispatchPoint <span class="token operator">*</span>pDp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDispatchPoint</span><span class="token punctuation">(</span>pLink2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pDp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pDp<span class="token operator">-&gt;</span><span class="token function">addDispatchInterval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//修改车道类型</span>
		pLink2<span class="token operator">-&gt;</span><span class="token function">lanes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">setLaneType</span><span class="token punctuation">(</span><span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;公交专用道&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第三条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink3 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//创建发车点</span>
		IDispatchPoint <span class="token operator">*</span>pDp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDispatchPoint</span><span class="token punctuation">(</span>pLink3<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pDp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pDp<span class="token operator">-&gt;</span><span class="token function">addDispatchInterval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第四条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink4 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//创建第五条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink5 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;自定义限速路段&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pLink5<span class="token operator">-&gt;</span><span class="token function">setLimitSpeed</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第六条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink6 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;动态发车路段&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink6<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pLink6<span class="token operator">-&gt;</span><span class="token function">setLimitSpeed</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第七条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink7 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink7<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pLink7<span class="token operator">-&gt;</span><span class="token function">setLimitSpeed</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第八条路段</span>
	startPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endPoint <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> startPoint<span class="token punctuation">;</span>
	lPoint <span class="token operator">&lt;&lt;</span> endPoint<span class="token punctuation">;</span>
	ILink <span class="token operator">*</span>pLink8 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink8<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pLink8<span class="token operator">-&gt;</span><span class="token function">setLimitSpeed</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第一条连接段</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink3 <span class="token operator">&amp;&amp;</span> pLink4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QList<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> lFromLaneNumber <span class="token operator">=</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
		QList<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> lToLaneNumber <span class="token operator">=</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
		IConnector <span class="token operator">*</span>pConn1 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createConnector</span><span class="token punctuation">(</span>pLink3<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pLink4<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber
			<span class="token punctuation">,</span> <span class="token string">&quot;连接段1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第二条连接段</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink4 <span class="token operator">&amp;&amp;</span> pLink5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		IConnector <span class="token operator">*</span>pConn2 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createConnector</span><span class="token punctuation">(</span>pLink4<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pLink5<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;连接段2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//创建第三条连接段</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink7 <span class="token operator">&amp;&amp;</span> pLink8<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		IConnector <span class="token operator">*</span>pConn3 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createConnector</span><span class="token punctuation">(</span>pLink7<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pLink8<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;动态发车连接段&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-地图转tessng路网"><a href="#_2-2-地图转tessng路网" class="header-anchor">#</a> 2.2. 地图转TESSNG路网</h3> <p>需要使用到Python工具，导入opendrive， osm shapely生成tessng路网；直接使用pytessng的工具代码;</p> <p>截图：</p> <p><img src="/vuepress/img/ec682d0819e92ce81d2871a11f19fbb.png" alt="opendrive转换工具"></p> <p>工具链接：<a href="https://pypi.org/search/?q=pytessng" target="_blank" rel="noopener noreferrer">pytessng<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>安装命令：</p> <div class="language- extra-class"><pre class="language-text"><code>pip install pytessng
</code></pre></div><h3 id="_2-3-修改路网元素"><a href="#_2-3-修改路网元素" class="header-anchor">#</a> 2.3. 修改路网元素</h3> <p>1-修改删除link编号，名称，形状，长度，宽度等属性</p> <p>2-修改connector的laneconnector连接关系，形状；</p> <p>3- 获取link, connector, connectorarea, laneconnector形状，属性</p> <p>用户可以先获取目标对象，在修改对象属性</p> <p>详见<a href="/vuepress/document/V3.x/C++/details.html">接口详解</a></p> <h3 id="_2-4-编辑路网附着物"><a href="#_2-4-编辑路网附着物" class="header-anchor">#</a> 2.4. 编辑路网附着物</h3> <p>1-新建删除车道导向箭头；</p> <div class="language- extra-class"><pre class="language-text"><code>IGuidArrow* pGuideArrow = gpTessInterface-&gt;netInterface()-&gt;createGuidArrow(pRightLane, length, distToTerminal, arrowType);
    qDebug() &lt;&lt; &quot;导向箭头类型为：&quot; &lt;&lt; pGuideArrow-&gt;arrowType() &lt;&lt; endl;

</code></pre></div><p>2-限速区：指定车道位置设置，限速区的长度，生效时间, 速度值</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新计算期望速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reCalcdesirSpeed</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> inOutDesirSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// L5最右侧车道50-100m处，限速10，持续30s</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//当前已仿真时间，单位：秒</span>
		<span class="token keyword">long</span> simuTime <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">simuTimeIntervalWithAcceMutiples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//当前已仿真时间，单位：毫秒</span>
			mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedStartTime <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">simuTimeIntervalWithAcceMutiples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
			mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段最右侧车道50-100m处设置限速区，限速10km/h，持续时间30s！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">laneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">distToStartPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">distToStartPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				inOutDesirSpeed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>simuTime <span class="token operator">-</span> mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedStartTime <span class="token operator">&gt;=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段最右侧车道50-100m处限速区已关闭，车辆正常行驶！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3-施工区：根据车辆序号和位置，施工区长度新建</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>Online<span class="token double-colon punctuation">::</span>DynaRoadWorkZoneParam workZone<span class="token punctuation">;</span>
	<span class="token comment">//道路ID</span>
	workZone<span class="token punctuation">.</span>roadId <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
	<span class="token comment">//施工区名称</span>
	workZone<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;施工区，限速60&quot;</span><span class="token punctuation">;</span>
	<span class="token comment">//位置，距路段或连接段起点距离，单位米</span>
	workZone<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//施工区长度，单位米</span>
	workZone<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//车辆经过施工区的最大车速，单位千米/小时</span>
	workZone<span class="token punctuation">.</span>limitSpeed <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//施工区施工时长，单位秒</span>
	workZone<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
	<span class="token comment">//施工区起始车道</span>
	workZone<span class="token punctuation">.</span>mlFromLaneNumber<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建施工区</span>
	IRoadWorkZone<span class="token operator">*</span> pZone <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createRoadWorkZone</span><span class="token punctuation">(</span>workZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>5-事故区：根据车道序号，位置，影响范围新建</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>Online<span class="token double-colon punctuation">::</span>DynaAccidentZoneParam accidentZone<span class="token punctuation">;</span>
	<span class="token comment">//道路ID</span>
	accidentZone<span class="token punctuation">.</span>roadId <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
	<span class="token comment">//事故区名称</span>
	accidentZone<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;最左侧车道发生事故&quot;</span><span class="token punctuation">;</span>
	<span class="token comment">//位置，距路段或连接段起点距离，单位米</span>
	accidentZone<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//事故区长度，单位米</span>
	accidentZone<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//事故区起始车道序号列表</span>
	accidentZone<span class="token punctuation">.</span>mlFromLaneNumber<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//事故等级</span>
	accidentZone<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">//创建事故区</span>
	IAccidentZone<span class="token operator">*</span> pZone <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createAccidentZone</span><span class="token punctuation">(</span>accidentZone<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>6-公交站：根据车道序号，位置，长度，类型设置；</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//创建公交线路</span>
IBusLine<span class="token operator">*</span> pBusLine <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createBusLine</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink11<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pBusLine<span class="token operator">-&gt;</span><span class="token function">setDesirSpeed</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>详见接口详解</p> <h2 id="_3-信控编辑"><a href="#_3-信控编辑" class="header-anchor">#</a> 3. 信控编辑</h2> <h3 id="_3-1-新建信号灯"><a href="#_3-1-新建信号灯" class="header-anchor">#</a> 3.1. 新建信号灯</h3> <p>1- 根据车道序号，位置新建信号灯</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//创建信号灯</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> size <span class="token operator">=</span> lConnLaneObjs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ISignalLamp<span class="token operator">*</span> pSignalLamp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createSignalLamp</span><span class="token punctuation">(</span>pSignalPhase<span class="token punctuation">,</span> <span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;信号灯%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lConnLaneObjs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">fromLaneObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  lConnLaneObjs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">toLaneObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-2-编辑信号灯组"><a href="#_3-2-编辑信号灯组" class="header-anchor">#</a> 3.2.  编辑信号灯组</h3> <p>2- 新建信号灯组，设置信号相位相序和灯色</p> <p>核心代码</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//创建示例路段和连接段</span>
QList<span class="token operator">&lt;</span>ISection<span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">createExampleLinkAndConnector</span><span class="token punctuation">(</span>QString LinkName<span class="token punctuation">,</span> <span class="token keyword">int</span> Posy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//创建两条路段</span>
	QPointF startPoint1 <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span>Posy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//m2p(数字)后的坐标可以对上原点在中心的坐标，TESSNG中的坐标始终是像素</span>
	QPointF endPoint1 <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span>Posy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoint1<span class="token punctuation">;</span>
	lPoint1 <span class="token operator">&lt;&lt;</span> startPoint1 <span class="token operator">&lt;&lt;</span> endPoint1<span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink1 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> LinkName <span class="token operator">+</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;路段1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	QPointF startPoint2 <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span>Posy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//m2p(数字)后的坐标可以对上原点在中心的坐标，TESSNG中的坐标始终是像素</span>
	QPointF endPoint2 <span class="token operator">=</span> <span class="token function">QPointF</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span>Posy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoint2<span class="token punctuation">;</span>
	lPoint2 <span class="token operator">&lt;&lt;</span> startPoint2 <span class="token operator">&lt;&lt;</span> endPoint2<span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink2 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createLink</span><span class="token punctuation">(</span>lPoint2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> LinkName <span class="token operator">+</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;路段2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IConnector<span class="token operator">*</span> pConn <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token comment">//创建连接段</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink1 <span class="token operator">&amp;&amp;</span> pLink2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QList<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> lFromLaneNumber <span class="token operator">=</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
		QList<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> lToLaneNumber <span class="token operator">=</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
		pConn <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createConnector</span><span class="token punctuation">(</span>pLink1<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pLink2<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span> LinkName <span class="token operator">+</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;连接段&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pConn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//连接段车道连接列表</span>
			QList<span class="token operator">&lt;</span>ILaneObject<span class="token operator">*</span><span class="token operator">&gt;</span> lConnLaneObjs<span class="token punctuation">;</span>
			lConnLaneObjs <span class="token operator">=</span> pConn<span class="token operator">-&gt;</span><span class="token function">laneObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>ILaneObject<span class="token operator">*</span><span class="token operator">&amp;</span> pLaneObj <span class="token operator">:</span> lConnLaneObjs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;上游车道ID&quot;</span> <span class="token operator">&lt;&lt;</span> pLaneObj<span class="token operator">-&gt;</span><span class="token function">fromLaneObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;下游车道ID&quot;</span> <span class="token operator">&lt;&lt;</span> pLaneObj<span class="token operator">-&gt;</span><span class="token function">toLaneObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ISection<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink1 <span class="token operator">&lt;&lt;</span> pLink2 <span class="token operator">&lt;&lt;</span> pConn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//信控编辑</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">signalControllerEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	QList<span class="token operator">&lt;</span>ISection<span class="token operator">*</span><span class="token operator">&gt;</span> lLinksAndConnector <span class="token operator">=</span> <span class="token function">createExampleLinkAndConnector</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;信控编辑&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink1 <span class="token operator">=</span> lLinksAndConnector<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">castToLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IConnector<span class="token operator">*</span> pConn <span class="token operator">=</span> lLinksAndConnector<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">castToConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//连接段车道连接列表</span>
	QList<span class="token operator">&lt;</span>ILaneObject<span class="token operator">*</span><span class="token operator">&gt;</span> lConnLaneObjs<span class="token punctuation">;</span>
	lConnLaneObjs <span class="token operator">=</span> pConn<span class="token operator">-&gt;</span><span class="token function">laneObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建发车点</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//创建发车点</span>
		IDispatchPoint<span class="token operator">*</span> pDp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDispatchPoint</span><span class="token punctuation">(</span>pLink1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pDp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pDp<span class="token operator">-&gt;</span><span class="token function">addDispatchInterval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//200秒400辆车</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//创建信号灯组</span>
	ISignalGroup<span class="token operator">*</span> pSignalGroup <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createSignalGroup</span><span class="token punctuation">(</span><span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;信号灯组1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建相位,40秒绿灯，黄灯3秒，全红3秒</span>
	Online<span class="token double-colon punctuation">::</span>ColorInterval <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">&quot;绿&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">&quot;黄&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">red</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ISignalPhase<span class="token operator">*</span> pSignalPhase <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createSignalPhase</span><span class="token punctuation">(</span>pSignalGroup<span class="token punctuation">,</span> <span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;信号灯组1相位1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>ColorInterval<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> green <span class="token operator">&lt;&lt;</span> yellow <span class="token operator">&lt;&lt;</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建信号灯</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> size <span class="token operator">=</span> lConnLaneObjs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ISignalLamp<span class="token operator">*</span> pSignalLamp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createSignalLamp</span><span class="token punctuation">(</span>pSignalPhase<span class="token punctuation">,</span> <span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;信号灯%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			lConnLaneObjs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">fromLaneObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lConnLaneObjs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">toLaneObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-3-信控方案下发"><a href="#_3-3-信控方案下发" class="header-anchor">#</a> 3.3. 信控方案下发</h3> <p>3- 支持双环结构信控方案下发（前提是已正确新建信号灯；已知一个路口所有进口道的流向及车道对应的信号灯id）</p> <p>核心代码</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//双环信控方案下发</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">doubleRingSignalControl</span><span class="token punctuation">(</span><span class="token keyword">long</span> currentSimuTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 读取方案数据</span>
	QFile <span class="token function">jsonFile</span><span class="token punctuation">(</span><span class="token string">&quot;./Data/Signal_Plan_Data_1109.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>jsonFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token double-colon punctuation">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Error: Could not open Signal_Plan_Data_1109.json&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	QByteArray jsonData <span class="token operator">=</span> jsonFile<span class="token punctuation">.</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	jsonFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QJsonDocument doc <span class="token operator">=</span> <span class="token class-name">QJsonDocument</span><span class="token double-colon punctuation">::</span><span class="token function">fromJson</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	QJsonObject signalGroupsDict <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>QJsonObject<span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> signalGroupsDict<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> signalGroupsDict<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QString groupName <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QJsonObject group <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ISignalGroup<span class="token operator">*</span> pCurrentSignalGroup <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token comment">// 通过灯组名称查询到灯组</span>
		QList<span class="token operator">&lt;</span>ISignalGroup<span class="token operator">*</span><span class="token operator">&gt;</span> lAllSignalGroups <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">signalGroups</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>ISignalGroup<span class="token operator">*</span><span class="token operator">&amp;</span> pSignalGroup <span class="token operator">:</span> lAllSignalGroups<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pSignalGroup<span class="token operator">-&gt;</span><span class="token function">groupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> groupName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				pCurrentSignalGroup <span class="token operator">=</span> pSignalGroup<span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pCurrentSignalGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;FindError: The signalGroup not in current net.&quot;</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//获取当前灯组相位</span>
		QList<span class="token operator">&lt;</span>ISignalPhase<span class="token operator">*</span><span class="token operator">&gt;</span> lCurrentSignalGroupPhases <span class="token operator">=</span> pCurrentSignalGroup<span class="token operator">-&gt;</span><span class="token function">phases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 获取所有灯组的起始时间</span>
		QStringList lSignalGroupStartTime <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>QJsonObject<span class="token double-colon punctuation">::</span>iterator it2 <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it2 <span class="token operator">!=</span> group<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			QString startTime <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 获取下一个元素的迭代器</span>
			QJsonObject<span class="token double-colon punctuation">::</span>iterator nextIt <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">next</span><span class="token punctuation">(</span>it2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			QString endTime <span class="token operator">=</span> <span class="token punctuation">(</span>nextIt <span class="token operator">!=</span> group<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> nextIt<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;24:00&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// 起始时间和结束时间的秒数表示</span>
			<span class="token keyword">long</span> startTimeSeconds <span class="token operator">=</span> <span class="token class-name">Functions</span><span class="token double-colon punctuation">::</span><span class="token function">timeToSeconds</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">long</span> endTimeSeconds <span class="token operator">=</span> <span class="token class-name">Functions</span><span class="token double-colon punctuation">::</span><span class="token function">timeToSeconds</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 若当前仿真时间位于当前时段内，修改当前时段信号灯组的相位</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>startTimeSeconds <span class="token operator">&lt;=</span> currentSimuTime <span class="token operator">&amp;&amp;</span> currentSimuTime <span class="token operator">&lt;</span> endTimeSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				QJsonObject currentGroupData <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> periodTime <span class="token operator">=</span> currentGroupData<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;cycle_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> yellowInteral <span class="token operator">=</span> currentGroupData<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;yellow_interval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				QJsonArray phases <span class="token operator">=</span> currentGroupData<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;phases&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 修改周期</span>
				pCurrentSignalGroup<span class="token operator">-&gt;</span><span class="token function">setPeriodTime</span><span class="token punctuation">(</span>periodTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QJsonValueRef<span class="token operator">&amp;</span> phase <span class="token operator">:</span> phases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					QJsonObject phaseObj <span class="token operator">=</span> phase<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					QString phaseName <span class="token operator">=</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;phase_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> phaseNumber <span class="token operator">=</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;phase_number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;phaseName&quot;</span> <span class="token operator">&lt;&lt;</span> phaseName <span class="token operator">&lt;&lt;</span> phaseNumber <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>ColorInterval<span class="token operator">&gt;</span> lColorInterval<span class="token punctuation">;</span>
					lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;start_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;绿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;green_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;黄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> yellowInteral<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> remainingTime <span class="token operator">=</span> periodTime <span class="token operator">-</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;start_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;green_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> yellowInteral<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>remainingTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> remainingTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 当前灯组包含的相位序号</span>
					ISignalPhase<span class="token operator">*</span> pCurrentPhase <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span>ISignalPhase<span class="token operator">*</span><span class="token operator">&amp;</span> pCurrentSignalGroupPhase <span class="token operator">:</span> lCurrentSignalGroupPhases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>phaseNumber <span class="token operator">==</span> pCurrentSignalGroupPhase<span class="token operator">-&gt;</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							pCurrentPhase <span class="token operator">=</span> pCurrentSignalGroupPhase<span class="token punctuation">;</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 若已存在该相位，修改相位灯色顺序，否则添加相位</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>pCurrentPhase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// 修改相位</span>
						pCurrentPhase<span class="token operator">-&gt;</span><span class="token function">setColorList</span><span class="token punctuation">(</span>lColorInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pCurrentPhase<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;相位设置成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{</span>
						ISignalPhase<span class="token operator">*</span> pSignalPhase <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createSignalPhase</span><span class="token punctuation">(</span>pCurrentSignalGroup<span class="token punctuation">,</span> phaseName<span class="token punctuation">,</span> lColorInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">// 设置相位序号</span>
						pSignalPhase<span class="token operator">-&gt;</span><span class="token function">setNumber</span><span class="token punctuation">(</span>phaseNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pSignalPhase<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;相位创建成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 设置相位包含的信号灯</span>
					QJsonArray lampList <span class="token operator">=</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;lamp_lst&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QJsonValue<span class="token operator">&amp;</span> lampId <span class="token operator">:</span> lampList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						ISignalLamp<span class="token operator">*</span> pLamp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findSignalLamp</span><span class="token punctuation">(</span>lampId<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pLamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">/*
							 * 目前一个信号灯属于多个相位，相位间不交叉。
							 * 因此如果要实际下发方案时，应按照仿真时间实时管理相位序号。
							 */</span>
							pLamp<span class="token operator">-&gt;</span><span class="token function">setPhaseNumber</span><span class="token punctuation">(</span>phaseNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLamp<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;序号信号灯相位设置成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;FindError:未查找到信号灯:&quot;</span> <span class="token operator">&lt;&lt;</span> lampId<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>案例效果：</p> <p><video controls="controls" src="https://www.jidatraffic.com/newWebsite/video/20231201_134842_双环信控方案下发测试效果.mp4" style="width:100%;"></video></p> <h2 id="_4-需求加载与管理"><a href="#_4-需求加载与管理" class="header-anchor">#</a> 4. 需求加载与管理</h2> <h3 id="_4-1-流量加载"><a href="#_4-1-流量加载" class="header-anchor">#</a> 4.1. 流量加载</h3> <p>支持多种方式加载车辆，供用户灵活使用</p> <p>1-新建发车点，设置发车流量时间间隔；设置发车分布；设置车辆组成，车辆类型（发车点已创建后无法修改车辆组成和车辆类型，可以创建车辆组成和车辆类型后设置发车点）；</p> <p><img src="/vuepress/img/%E5%88%9B%E5%BB%BA%E8%BD%A6%E8%BE%86%E7%BB%84%E6%88%90%EF%BC%8C%E6%8C%87%E5%AE%9A%E8%BD%A6%E5%9E%8B.png" alt="创建车辆组成，指定车型"></p> <p><video controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231110_122009_流量加载_创建车辆组成和发车点.mp4" style="width:100%;"></video></p> <p>2-动态发车：不设置发车点，在指定车道和位置处加载车辆（一辆一辆加载）</p> <p><video controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231113_095503_指定车道和位置加载车辆.mp4" style="width:100%;"></video></p> <p>核心代码</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//流量加载示例路段和连接段创建</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">trafficLoadingPrePare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	QList<span class="token operator">&lt;</span>ISection<span class="token operator">*</span><span class="token operator">&gt;</span> lLinksAndConnector <span class="token operator">=</span> <span class="token function">createExampleLinkAndConnector</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;流量加载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink1 <span class="token operator">=</span> lLinksAndConnector<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">castToLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/* 2.动态发车 */</span>
	QList<span class="token operator">&lt;</span>ISection<span class="token operator">*</span><span class="token operator">&gt;</span> lLinksAndConnectorDynaVehi <span class="token operator">=</span> <span class="token function">createExampleLinkAndConnector</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;动态发车&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink3 <span class="token operator">=</span> lLinksAndConnectorDynaVehi<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">castToLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lTrafficLoadingSections <span class="token operator">&lt;&lt;</span> pLink1<span class="token punctuation">;</span>
	lTrafficLoadingSections <span class="token operator">&lt;&lt;</span> pLink3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//流量加载</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">trafficLoading</span><span class="token punctuation">(</span><span class="token keyword">float</span> planNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">bool</span> bVehiCompositionFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	ILink<span class="token operator">*</span> pLink3 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lTrafficLoadingSections<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pLink1 <span class="token operator">=</span> lTrafficLoadingSections<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">castToLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pLink3 <span class="token operator">=</span> lTrafficLoadingSections<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">castToLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>bVehiCompositionFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 创建车辆组成及指定车辆类型</span>
		QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiComposition<span class="token operator">&gt;</span> lVehiTypeProportion<span class="token punctuation">;</span>
		<span class="token comment">// 车型组成：小客车0.3，大客车0.2，公交车0.1，货车0.4</span>
		lVehiTypeProportion<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">VehiComposition</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lVehiTypeProportion<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">VehiComposition</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lVehiTypeProportion<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">VehiComposition</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lVehiTypeProportion<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">VehiComposition</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> vehiCompositionID <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createVehicleComposition</span><span class="token punctuation">(</span><span class="token string">&quot;动态创建车型组成&quot;</span><span class="token punctuation">,</span> lVehiTypeProportion<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>vehiCompositionID <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;车型组成创建成功，id为：&quot;</span> <span class="token operator">&lt;&lt;</span> vehiCompositionID <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token comment">// 新建发车点,车型组成ID为动态创建的，600秒发300辆车</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				IDispatchPoint<span class="token operator">*</span> dp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDispatchPoint</span><span class="token punctuation">(</span>pLink1<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>dp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					dp<span class="token operator">-&gt;</span><span class="token function">addDispatchInterval</span><span class="token punctuation">(</span>vehiCompositionID<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					bVehiCompositionFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			Online<span class="token double-colon punctuation">::</span>DynaVehiParam dvpLane0<span class="token punctuation">,</span> dvpLane1<span class="token punctuation">,</span> dvpLane2<span class="token punctuation">;</span>
			<span class="token comment">// 在指定车道和位置动态加载车辆(示例：在0,1,2车道不同位置动态加载车辆)</span>
			dvpLane0<span class="token punctuation">.</span>vehiTypeCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			dvpLane1<span class="token punctuation">.</span>vehiTypeCode <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			dvpLane2<span class="token punctuation">.</span>vehiTypeCode <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
			dvpLane0<span class="token punctuation">.</span>roadId <span class="token operator">=</span> pLink3<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dvpLane1<span class="token punctuation">.</span>roadId <span class="token operator">=</span> pLink3<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dvpLane2<span class="token punctuation">.</span>roadId <span class="token operator">=</span> pLink3<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dvpLane0<span class="token punctuation">.</span>laneNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			dvpLane1<span class="token punctuation">.</span>laneNumber <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			dvpLane2<span class="token punctuation">.</span>laneNumber <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			dvpLane0<span class="token punctuation">.</span>dist <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dvpLane1<span class="token punctuation">.</span>dist <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dvpLane2<span class="token punctuation">.</span>dist <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dvpLane0<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
			dvpLane1<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
			dvpLane2<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
			dvpLane0<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;#FF0000&quot;</span><span class="token punctuation">;</span>
			dvpLane1<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;#008000&quot;</span><span class="token punctuation">;</span>
			dvpLane2<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;#0000FF&quot;</span><span class="token punctuation">;</span>
			<span class="token keyword">auto</span> vehi_lane0 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createGVehicle</span><span class="token punctuation">(</span>dvpLane0<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">auto</span> vehi_lane1 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createGVehicle</span><span class="token punctuation">(</span>dvpLane1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">auto</span> vehi_lane2 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createGVehicle</span><span class="token punctuation">(</span>dvpLane2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3- 路径（veh path）加载：单车车辆路径（根据方式4间接实现）</p> <p>或者通过IVehicleDriving类实现</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 修改车辆路径，将L1路段所有车辆修改为右转路径</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicle<span class="token operator">*</span><span class="token operator">&amp;</span> vehi <span class="token operator">:</span> lAllVehi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				QList<span class="token operator">&lt;</span>IDecisionPoint<span class="token operator">*</span><span class="token operator">&gt;</span> lDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decisionPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				IDecisionPoint<span class="token operator">*</span> pDecisionPointInLink1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>IDecisionPoint<span class="token operator">*</span><span class="token operator">&amp;</span> pDecisionPoint <span class="token operator">:</span> lDecisionPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>pDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						pDecisionPointInLink1 <span class="token operator">=</span> pDecisionPoint<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				QList<span class="token operator">&lt;</span>IRouting<span class="token operator">*</span><span class="token operator">&gt;</span> lRoutingsOfDecisionPointInLink1<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>pDecisionPointInLink1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					lRoutingsOfDecisionPointInLink1 <span class="token operator">=</span> pDecisionPointInLink1<span class="token operator">-&gt;</span><span class="token function">routings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lRoutingsOfDecisionPointInLink1<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">routing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> lRoutingsOfDecisionPointInLink1<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setRouting</span><span class="token punctuation">(</span>lRoutingsOfDecisionPointInLink1<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L1路段所有车辆路径修改为右转！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
</code></pre></div><p>4- flow 路径加载：发车点+静态路径</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//路径加载</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">flowLoading</span><span class="token punctuation">(</span><span class="token keyword">float</span> planNumber<span class="token punctuation">,</span> <span class="token keyword">long</span> currentTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">bool</span> bPlanNumberFlag1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">bool</span> bPlanNumberFlag2 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token comment">//标准四岔路口流量加载，L3-C2-L10为例</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>bPlanNumberFlag1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 根据路段ID获取路段</span>
		ILink<span class="token operator">*</span> pLink3 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ILink<span class="token operator">*</span> pLink10 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ILink<span class="token operator">*</span> pLink6 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ILink<span class="token operator">*</span> pLink7 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ILink<span class="token operator">*</span> pLink8 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//新建发车点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			IDispatchPoint<span class="token operator">*</span> dp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDispatchPoint</span><span class="token punctuation">(</span>pLink3<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>dp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				dp<span class="token operator">-&gt;</span><span class="token function">addDispatchInterval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//创建决策点</span>
		mpDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDecisionPoint</span><span class="token punctuation">(</span>pLink3<span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//创建路径(左，直，右)</span>
		IRouting<span class="token operator">*</span> decisionRoutingLeft <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink3 <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink6<span class="token punctuation">)</span><span class="token punctuation">;</span>
		IRouting<span class="token operator">*</span> decisionRoutingStraight <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink3 <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink8<span class="token punctuation">)</span><span class="token punctuation">;</span>
		IRouting<span class="token operator">*</span> decisionRoutingRight <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink3 <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink7<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//分配左直右流量比</span>
		_RoutingFLowRatio _flowRatioLeft<span class="token punctuation">,</span> _flowRatioStraight<span class="token punctuation">,</span> _flowRatioRight<span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRoutingLeft<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRoutingStraight<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRoutingRight<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
		<span class="token comment">// 决策点数据</span>
		_DecisionPoint _decisionPointData<span class="token punctuation">;</span>
		_decisionPointData<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_decisionPointData<span class="token punctuation">.</span>deciPointName <span class="token operator">=</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QPointF decisionPointPos<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getPointByDist</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decisionPointPos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			_decisionPointData<span class="token punctuation">.</span>X <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			_decisionPointData<span class="token punctuation">.</span>Y <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			_decisionPointData<span class="token punctuation">.</span>Z <span class="token operator">=</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//更新决策点及其各路径不同时间段流量比</span>
		mpDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">updateDecipointPoint</span><span class="token punctuation">(</span>_decisionPointData<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>_RoutingFLowRatio<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> _flowRatioLeft <span class="token operator">&lt;&lt;</span> _flowRatioStraight <span class="token operator">&lt;&lt;</span> _flowRatioRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bPlanNumberFlag1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//移除右转路径</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> bPlanNumberFlag1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>bPlanNumberFlag2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">removeDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">routings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			bPlanNumberFlag2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;删除右转路径成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">flowLoadingSection</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>5- 断面流量+转向比例（路径比例）加载</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//路径断面流量加载</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">flowLoadingSection</span><span class="token punctuation">(</span><span class="token keyword">long</span> currentTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 读取方案数据</span>
	QFile <span class="token function">jsonFile</span><span class="token punctuation">(</span><span class="token string">&quot;./Data/flow_ratio_quarter.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>jsonFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token double-colon punctuation">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Error: Could not open flow_ratio_quarter.json&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	QByteArray jsonData <span class="token operator">=</span> jsonFile<span class="token punctuation">.</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	jsonFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QJsonDocument doc <span class="token operator">=</span> <span class="token class-name">QJsonDocument</span><span class="token double-colon punctuation">::</span><span class="token function">fromJson</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	QJsonObject flowRatioQuarterDict <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>QJsonObject<span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> flowRatioQuarterDict<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> flowRatioQuarterDict<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> linkId <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QJsonObject quarterRatios <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		IDecisionPoint<span class="token operator">*</span> pCurrentDecisionPoint <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token comment">//查找决策点</span>
		QList<span class="token operator">&lt;</span>IDecisionPoint<span class="token operator">*</span><span class="token operator">&gt;</span> lDecisionPoints <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decisionPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>IDecisionPoint<span class="token operator">*</span><span class="token operator">&amp;</span> pDecisionPoint <span class="token operator">:</span> lDecisionPoints<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> linkId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				pCurrentDecisionPoint <span class="token operator">=</span> pDecisionPoint<span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pCurrentDecisionPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>QJsonObject<span class="token double-colon punctuation">::</span>iterator it2 <span class="token operator">=</span> quarterRatios<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it2 <span class="token operator">!=</span> quarterRatios<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				QString quarterStartTime <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">long</span> quarterStartTimeSeconds <span class="token operator">=</span> <span class="token class-name">Functions</span><span class="token double-colon punctuation">::</span><span class="token function">timeToSeconds</span><span class="token punctuation">(</span>quarterStartTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
				QJsonObject<span class="token double-colon punctuation">::</span>iterator nextIt <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">next</span><span class="token punctuation">(</span>it2<span class="token punctuation">)</span><span class="token punctuation">;</span>
				QString quarterEndTime <span class="token operator">=</span> <span class="token punctuation">(</span>nextIt <span class="token operator">!=</span> quarterRatios<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> nextIt<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;24:00&quot;</span><span class="token punctuation">;</span>
				<span class="token keyword">long</span> quarterEndTimeSeconds <span class="token operator">=</span> <span class="token class-name">Functions</span><span class="token double-colon punctuation">::</span><span class="token function">timeToSeconds</span><span class="token punctuation">(</span>quarterEndTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>currentTime <span class="token operator">&lt;</span> quarterEndTimeSeconds <span class="token operator">&amp;&amp;</span> currentTime <span class="token operator">&gt;=</span> quarterStartTimeSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> quarterStartTime <span class="token operator">&lt;&lt;</span> quarterEndTimeSeconds <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					QJsonObject quarterRatio <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					QList<span class="token operator">&lt;</span>IRouting<span class="token operator">*</span><span class="token operator">&gt;</span> lDecisionPointRoutings <span class="token operator">=</span> pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">routings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>lDecisionPointRoutings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// 分配左、直、右流量比</span>
						_RoutingFLowRatio _flowRatioLeft<span class="token punctuation">,</span> _flowRatioStraight<span class="token punctuation">,</span> _flowRatioRight<span class="token punctuation">;</span>
						_flowRatioLeft<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> lDecisionPointRoutings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioLeft<span class="token punctuation">.</span>routingID <span class="token operator">=</span> lDecisionPointRoutings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioLeft<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
						_flowRatioLeft<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">99999</span><span class="token punctuation">;</span>
						_flowRatioLeft<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>quarterRatio<span class="token punctuation">[</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioStraight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> lDecisionPointRoutings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioStraight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> lDecisionPointRoutings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioStraight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
						_flowRatioStraight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">99999</span><span class="token punctuation">;</span>
						_flowRatioStraight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>quarterRatio<span class="token punctuation">[</span><span class="token string">&quot;straight&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioRight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> lDecisionPointRoutings<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioRight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> lDecisionPointRoutings<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_flowRatioRight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
						_flowRatioRight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">99999</span><span class="token punctuation">;</span>
						_flowRatioRight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>quarterRatio<span class="token punctuation">[</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">// 决策点数据</span>
						_DecisionPoint _decisionPointData<span class="token punctuation">;</span>
						_decisionPointData<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						_decisionPointData<span class="token punctuation">.</span>deciPointName <span class="token operator">=</span> pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						QPointF decisionPointPos<span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getPointByDist</span><span class="token punctuation">(</span>pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decisionPointPos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							_decisionPointData<span class="token punctuation">.</span>X <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							_decisionPointData<span class="token punctuation">.</span>Y <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							_decisionPointData<span class="token punctuation">.</span>Z <span class="token operator">=</span> pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">//更新决策点及其各路径不同时间段流量比</span>
						IDecisionPoint<span class="token operator">*</span> pUpdatedCurrentDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">updateDecipointPoint</span><span class="token punctuation">(</span>_decisionPointData<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>_RoutingFLowRatio<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> _flowRatioLeft <span class="token operator">&lt;&lt;</span> _flowRatioStraight <span class="token operator">&lt;&lt;</span> _flowRatioRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>pUpdatedCurrentDecisionPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> quarterStartTime <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;流量更新成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{</span>
						<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pCurrentDecisionPoint<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;决策点需要包含3条路径&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-2-路径管理"><a href="#_4-2-路径管理" class="header-anchor">#</a> 4.2.  路径管理</h3> <p>1- 新建决策点；新建决策路径，编辑决策路径流量比例，时间，路径的link,connector，删除路径。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>		<span class="token comment">//创建决策点</span>
		mpDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDecisionPoint</span><span class="token punctuation">(</span>pLink3<span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//创建路径(左，直，右)</span>
		IRouting<span class="token operator">*</span> decisionRoutingLeft <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink3 <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink6<span class="token punctuation">)</span><span class="token punctuation">;</span>
		IRouting<span class="token operator">*</span> decisionRoutingStraight <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink3 <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink8<span class="token punctuation">)</span><span class="token punctuation">;</span>
		IRouting<span class="token operator">*</span> decisionRoutingRight <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink3 <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink7<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//分配左直右流量比</span>
		_RoutingFLowRatio _flowRatioLeft<span class="token punctuation">,</span> _flowRatioStraight<span class="token punctuation">,</span> _flowRatioRight<span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRoutingLeft<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span><span class="token punctuation">;</span>
		_flowRatioLeft<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRoutingStraight<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span><span class="token punctuation">;</span>
		_flowRatioStraight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRoutingRight<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span><span class="token punctuation">;</span>
		_flowRatioRight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
		<span class="token comment">// 决策点数据</span>
		_DecisionPoint _decisionPointData<span class="token punctuation">;</span>
		_decisionPointData<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_decisionPointData<span class="token punctuation">.</span>deciPointName <span class="token operator">=</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QPointF decisionPointPos<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getPointByDist</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decisionPointPos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			_decisionPointData<span class="token punctuation">.</span>X <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			_decisionPointData<span class="token punctuation">.</span>Y <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			_decisionPointData<span class="token punctuation">.</span>Z <span class="token operator">=</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//更新决策点及其各路径不同时间段流量比</span>
		mpDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">updateDecipointPoint</span><span class="token punctuation">(</span>_decisionPointData<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>_RoutingFLowRatio<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> _flowRatioLeft <span class="token operator">&lt;&lt;</span> _flowRatioStraight <span class="token operator">&lt;&lt;</span> _flowRatioRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bPlanNumberFlag1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//移除右转路径</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> bPlanNumberFlag1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>bPlanNumberFlag2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">removeDeciRouting</span><span class="token punctuation">(</span>mpDecisionPoint<span class="token punctuation">,</span> mpDecisionPoint<span class="token operator">-&gt;</span><span class="token function">routings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			bPlanNumberFlag2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;删除右转路径成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">flowLoadingSection</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>2 - 运行过程中编辑决策路径的属性（流量比例，时间段信息），暂时不要求新增，删除，修改已有路径的“路径”（link,connector）</p> <p>见CustomerSimulator</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>DecipointFlowRatioByInterval<span class="token operator">&gt;</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">calcDynaFlowRatioParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>DecipointFlowRatioByInterval<span class="token operator">&gt;</span> lDecipointFLowRatioByInterval<span class="token punctuation">;</span>
	<span class="token keyword">long</span> batchNumber <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">batchNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>batchNumber <span class="token operator">==</span> <span class="token number">100</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Online<span class="token double-colon punctuation">::</span>DecipointFlowRatioByInterval dfi <span class="token operator">=</span> <span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">DecipointFlowRatioByInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dfi<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		dfi<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		dfi<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">84000</span><span class="token punctuation">;</span>
		Online<span class="token double-colon punctuation">::</span>RoutingFlowRatio rfr1 <span class="token operator">=</span> <span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">RoutingFlowRatio</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Online<span class="token double-colon punctuation">::</span>RoutingFlowRatio rfr2 <span class="token operator">=</span> <span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">RoutingFlowRatio</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dfi<span class="token punctuation">.</span>mlRoutingFlowRatio <span class="token operator">&lt;&lt;</span> rfr1<span class="token punctuation">;</span>
		dfi<span class="token punctuation">.</span>mlRoutingFlowRatio <span class="token operator">&lt;&lt;</span> rfr2<span class="token punctuation">;</span>
		lDecipointFLowRatioByInterval <span class="token operator">&lt;&lt;</span> dfi<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> lDecipointFLowRatioByInterval<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上两点需求可在流量加载中找到实现方式。</p> <p><video controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231113_114751_发车点+决策点创建+路径加载+删除路径.mp4" style="width:100%;"></video></p> <h3 id="_4-3-路径重构"><a href="#_4-3-路径重构" class="header-anchor">#</a> 4.3.  路径重构</h3> <p>1- 断面流量+转向流量重构车辆路径，并加载到仿真中;(暂时忽略)</p> <p>2- OD数据重构路径，并加载到仿真中(暂时忽略)</p> <p>用户可以利用自有算法实现OD分配、路径重构，然后依据4.1中所述的流量加载方式实现TESSNG 软件加载路径重构结果</p> <p><video controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231113_145224_断面流量+转向比例加载.mp4" style="width:100%;"></video></p> <h2 id="_5-仿真运行"><a href="#_5-仿真运行" class="header-anchor">#</a> 5. 仿真运行</h2> <h3 id="_5-1-倒车入库"><a href="#_5-1-倒车入库" class="header-anchor">#</a> 5.1. 倒车入库</h3> <p>在实现自动泊车的仿真及调度时需要展示车辆倒车入库的过程，这个过程可让车辆顺向前移，将车辆旋转180度，展现的便是倒着行驶状态。</p> <p><img src="/vuepress/img/%E5%9B%BE13%E8%BD%A6%E8%BE%86%E5%80%92%E8%BD%A6%E5%85%A5%E5%BA%93%E5%9C%BA%E6%99%AF.png" alt="车辆倒车入库场景"></p> <p>为了实现倒着行驶效果，可以实现CustomerSimulator的如下方法</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token function">reCalcAngle</span><span class="token punctuation">(</span>IVehicle <span class="token operator">*</span>pIVehicle<span class="token punctuation">,</span> qreal <span class="token operator">&amp;</span>outAngle<span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-2-循环仿真"><a href="#_5-2-循环仿真" class="header-anchor">#</a> 5.2. 循环仿真</h3> <p>对加载的路网启动仿真后，不需要人工干预的情况下重复仿真指定次数，且每次仿真前自动进行参数设置，仿真后输出仿真结果到文件。</p> <p>1）、仿真前判断当前仿真路网与上次仿真路网是否相同，如果不同设置仿真次数为1；</p> <p>2）、仿真结束后判断仿真次数是否小于指定次数，如果小于指定次数则发送要求仿真的消息给TESSNG主窗体，TESSNG主窗体启动仿真。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//仿真结束后的处理</span>
<span class="token keyword">void</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">afterStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//QDateTime dt = QDateTime::fromMSecsSinceEpoch(mrStartMSecs);</span>
	<span class="token comment">//QString dtStr = dt.toString(&quot;yyyy年MM月dd日 hh时mm分ss秒&quot;);</span>
	<span class="token comment">//QString startDtStr = QString(&quot;仿真开始现实时间:&quot;).append(dtStr);</span>

	<span class="token comment">//dtStr = QDateTime::currentDateTime().toString(&quot;yyyy年MM月dd日 hh时mm分ss秒&quot;);</span>
	<span class="token comment">//QString endDtStr = QString(&quot;仿真结束现实时间:&quot;).append(dtStr);</span>

	<span class="token comment">//QMessageBox::information(nullptr, QString(), QString().append(startDtStr).append(&quot;\n&quot;).append(endDtStr));</span>

	mSimuCount<span class="token operator">++</span><span class="token punctuation">;</span>
	QString netfilePath <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">netFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>netfilePath<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;深圳南海大道创业路交叉口CFI方案&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mSimuCount <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forReStartSimu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3-流程控制"><a href="#_5-3-流程控制" class="header-anchor">#</a> 5.3. 流程控制</h3> <p>1-开始仿真</p> <p>2- 暂停仿真</p> <p>3- 恢复仿真</p> <p>4-结束关闭仿真</p> <p>5-生成仿真快照</p> <p>6-加载仿真快照</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//流程控制</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">processControl</span><span class="token punctuation">(</span><span class="token keyword">float</span> planNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/*
	'''1. 启动、暂停、恢复、停止仿真'''
	*/</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">startSimu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">pauseSimu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">stopSimu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">pauseSimuOrNot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/*
	'''2. 获取运动信息'''
	*/</span>
	<span class="token comment">//2.1 获取路网在途车辆</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">2.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//所有在运行车辆</span>
		QList<span class="token operator">&lt;</span>IVehicle<span class="token operator">*</span><span class="token operator">&gt;</span> lAllVehi <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">allVehiStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QString runInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;路网在途车辆共%0辆，ID为:\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>lAllVehi<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicle<span class="token operator">*</span><span class="token operator">&amp;</span> vehi <span class="token operator">:</span> lAllVehi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			runInfo <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;车辆%0,当前坐标(%1,%2)\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">showDynaInfo</span><span class="token punctuation">(</span>runInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//2.2 根据路段|车道获取车辆list,以L5路段，lane20车道为例。</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">2.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QList<span class="token operator">&lt;</span>IVehicle<span class="token operator">*</span><span class="token operator">&gt;</span> lVehiOnLink5 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">vehisInLink</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QString runInfoOfLinkAndLane <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段车辆共%0辆，ID为:\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>lVehiOnLink5<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicle<span class="token operator">*</span><span class="token operator">&amp;</span> vehi <span class="token operator">:</span> lVehiOnLink5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			runInfoOfLinkAndLane <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;车辆%0,当前坐标(%1,%2)\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		QList<span class="token operator">&lt;</span>IVehicle<span class="token operator">*</span><span class="token operator">&gt;</span> lVehiOnLane20 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">vehisInLane</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		runInfoOfLinkAndLane <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;Lane20车道车辆共%0辆，ID为:\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>lVehiOnLane20<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicle<span class="token operator">*</span><span class="token operator">&amp;</span> vehi <span class="token operator">:</span> lVehiOnLane20<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			runInfoOfLinkAndLane <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;车辆%0,当前坐标(%1,%2)\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">showDynaInfo</span><span class="token punctuation">(</span>runInfoOfLinkAndLane<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//2.3 根据车辆id获取具体的车辆信息,以id为300001的车辆为例</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">2.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		IVehicle<span class="token operator">*</span> vehi300001 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehicle</span><span class="token punctuation">(</span><span class="token number">300001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi300001<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			QString runInfoOfVehi <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;%0车辆信息为:\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;所在路段ID:%0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;所在车道序号:%0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">lane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;当前车速:%0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">currSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;当前加速度:%0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">acce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;当前角度:%0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">angle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;当前位置:(%1,%2)\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>vehi300001<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			runInfoOfVehi <span class="token operator">+=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;其它：......\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">showDynaInfo</span><span class="token punctuation">(</span>runInfoOfVehi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 3. 设置仿真精度</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setSimuAccuracy</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 4. 设置仿真开始结束时间</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setSimuIntervalScheming</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 5. 设置仿真加速比</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setAcceMultiples</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_094245_启动-停止-暂停-恢复仿真.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_101732_查询指定车辆信息.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_115440_查询路段或车道车辆信息.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_155104_设置仿真精度.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_155826_设置仿真时长.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_160110_设置仿真加速比.mp4"></video></p> <h3 id="_5-4-动作控制"><a href="#_5-4-动作控制" class="header-anchor">#</a> 5.4.  动作控制</h3> <p>运行过程中的操作：</p> <p>1- 修改发车流量信息</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_113447_动态发车流量编辑.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_114107_动态删除发车点.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>DispatchInterval<span class="token operator">&gt;</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">calcDynaDispatchParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>DispatchInterval<span class="token operator">&gt;</span> lDispatchInterval<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		QTime t <span class="token operator">=</span> <span class="token class-name">QTime</span><span class="token double-colon punctuation">::</span><span class="token function">currentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> t<span class="token punctuation">;</span>
		<span class="token keyword">long</span> currSecs <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">minute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Online<span class="token double-colon punctuation">::</span>DispatchInterval di <span class="token operator">=</span> <span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">DispatchInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		di<span class="token punctuation">.</span>dispatchId <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
		di<span class="token punctuation">.</span>fromTime <span class="token operator">=</span> currSecs<span class="token punctuation">;</span>
		di<span class="token punctuation">.</span>toTime <span class="token operator">=</span> di<span class="token punctuation">.</span>fromTime <span class="token operator">+</span> <span class="token number">300</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
		di<span class="token punctuation">.</span>vehiCount <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
		di<span class="token punctuation">.</span>mlVehicleConsDetail <span class="token operator">&lt;&lt;</span> <span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">VehiComposition</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">VehiComposition</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lDispatchInterval <span class="token operator">&lt;&lt;</span> di<span class="token punctuation">;</span>
		mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> lDispatchInterval<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2- 修改限速区，事故区信息；删除减速区，限速区，事故区</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_130300_减速区.mp4"></video></p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_141714_施工区.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新计算期望速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reCalcdesirSpeed</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> inOutDesirSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// L5最右侧车道50-100m处，限速10，持续30s</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//当前已仿真时间，单位：秒</span>
		<span class="token keyword">long</span> simuTime <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">simuTimeIntervalWithAcceMutiples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//当前已仿真时间，单位：毫秒</span>
			mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedStartTime <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">simuTimeIntervalWithAcceMutiples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
			mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段最右侧车道50-100m处设置限速区，限速10km/h，持续时间30s！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">laneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">distToStartPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">distToStartPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				inOutDesirSpeed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>simuTime <span class="token operator">-</span> mpSecondDevCasesObj<span class="token operator">-&gt;</span>reCalcdesirSpeedStartTime <span class="token operator">&gt;=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段最右侧车道50-100m处限速区已关闭，车辆正常行驶！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3-车辆位置移动</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_133231_移动车辆.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 车辆移动测试时，将L5路段车辆移动过路口的各个车道</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lAllVehi<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>lAllVehi<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				ILink<span class="token operator">*</span> nextLink <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				QList<span class="token operator">&lt;</span>ILaneObject<span class="token operator">*</span><span class="token operator">&gt;</span> lNextLinkLaneObj <span class="token operator">=</span> nextLink<span class="token operator">-&gt;</span><span class="token function">laneObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>lAllVehi<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">move</span><span class="token punctuation">(</span>lNextLinkLaneObj<span class="token punctuation">[</span>i <span class="token operator">%</span> lNextLinkLaneObj<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段车辆转移成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>4-修改车辆速度</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231207_131017_车辆速度设置测试.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新设置速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reSetSpeed</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> inOutSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 3. 修改车辆速度，将L5路段车辆修改为0</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			inOutSpeed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>5-修改车辆路径</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/20231207_133054_修改车辆路径测试.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 修改车辆路径，将L1路段所有车辆修改为右转路径</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicle<span class="token operator">*</span><span class="token operator">&amp;</span> vehi <span class="token operator">:</span> lAllVehi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				QList<span class="token operator">&lt;</span>IDecisionPoint<span class="token operator">*</span><span class="token operator">&gt;</span> lDecisionPoint <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decisionPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				IDecisionPoint<span class="token operator">*</span> pDecisionPointInLink1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>IDecisionPoint<span class="token operator">*</span><span class="token operator">&amp;</span> pDecisionPoint <span class="token operator">:</span> lDecisionPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>pDecisionPoint<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						pDecisionPointInLink1 <span class="token operator">=</span> pDecisionPoint<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				QList<span class="token operator">&lt;</span>IRouting<span class="token operator">*</span><span class="token operator">&gt;</span> lRoutingsOfDecisionPointInLink1<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>pDecisionPointInLink1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					lRoutingsOfDecisionPointInLink1 <span class="token operator">=</span> pDecisionPointInLink1<span class="token operator">-&gt;</span><span class="token function">routings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lRoutingsOfDecisionPointInLink1<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">routing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> lRoutingsOfDecisionPointInLink1<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setRouting</span><span class="token punctuation">(</span>lRoutingsOfDecisionPointInLink1<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mRunInfo <span class="token operator">=</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;L1路段所有车辆路径修改为右转！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token function">emit</span><span class="token punctuation">(</span><span class="token function">forRunInfo</span><span class="token punctuation">(</span>mRunInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>6-强制车辆不变道</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/20231207_151904_强制车辆不变道测试.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reCalcDismissChangeLane</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//强制车辆不变道，禁止L2路段所有车辆右变道</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span><span class="token function">judgeVehicleLaneChangeDirection</span><span class="token punctuation">(</span>pIVehicle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>7-强制车辆变道</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/20231207_180602_强制车辆变道测试.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//计算是否要右自由变道</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reCalcToRightFreely</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">lane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reCalcDismissChangeLane</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//强制L5路段中间车道向右变道</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">lane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">lane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span><span class="token function">judgeVehicleLaneChangeDirection</span><span class="token punctuation">(</span>pIVehicle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>8-强制车辆闯红灯</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/20231208_092546_强制车辆闯红灯测试.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新设置速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reSetSpeed</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> inOutSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 7.强制车辆闯红灯,让L12等待的车辆强制闯红灯</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			qreal vehiCurrSpeed <span class="token operator">=</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">currSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			qreal vehiCurrentDistToEnd <span class="token operator">=</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">distToEndpoint</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span>vehiCurrSpeed<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token function">p2m</span><span class="token punctuation">(</span>vehiCurrentDistToEnd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 生成一个随机浮点数，范围在 [0.0, 1.0)</span>
				<span class="token keyword">double</span> randomNumber <span class="token operator">=</span> <span class="token class-name">QRandomGenerator</span><span class="token double-colon punctuation">::</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">generateDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>randomNumber <span class="token operator">&lt;</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					inOutSpeed <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>9-强制车辆停车</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_153837_强制车辆停车.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新设置速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reSetSpeed</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> inOutSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 3. 修改车辆速度，将L5路段车辆修改为0</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			inOutSpeed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>10-强制清除车辆（车辆消失）</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_155811_强制清除车辆.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//8. 强制清除车辆,以L5路段为例，清除所有小客车</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicle<span class="token operator">*</span><span class="token operator">&amp;</span> pIVehicle <span class="token operator">:</span> lAllVehi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleTypeCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">stopVehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>11-修改车辆航向角</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_160304_修改航向角.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">afterStep</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//9. 修改车辆航向角，以L5路段为例</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setAngle</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>12-修改车辆速度，加速度</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新设置速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reSetSpeed</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> inOutSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 3. 修改车辆速度，将L5路段车辆修改为0</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			inOutSpeed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 7.强制车辆闯红灯,让L12等待的车辆强制闯红灯</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mActionControlMethodNumber <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">roadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			qreal vehiCurrSpeed <span class="token operator">=</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">currSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			qreal vehiCurrentDistToEnd <span class="token operator">=</span> pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehicleDriving</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">distToEndpoint</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span>vehiCurrSpeed<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token function">p2m</span><span class="token punctuation">(</span>vehiCurrentDistToEnd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 生成一个随机浮点数，范围在 [0.0, 1.0)</span>
				<span class="token keyword">double</span> randomNumber <span class="token operator">=</span> <span class="token class-name">QRandomGenerator</span><span class="token double-colon punctuation">::</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">generateDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>randomNumber <span class="token operator">&lt;</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					inOutSpeed <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//计算加速度</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">calcAcce</span><span class="token punctuation">(</span>IVehicle <span class="token operator">*</span>pIVehicle<span class="token punctuation">,</span> qreal <span class="token operator">&amp;</span>acce<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">vehiDistFront</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//前车距小于5米，让TESSNG计算加速度</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">currSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        acce <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pIVehicle<span class="token operator">-&gt;</span><span class="token function">currSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        acce <span class="token operator">=</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>13- 车道关闭，恢复</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_161500_车道封闭和恢复.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token operator">/</span>动作控制
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">actionControl</span><span class="token punctuation">(</span><span class="token keyword">float</span> planNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/*以动作控制案例-机动车交叉口路网的L5路段为例*/</span>

	<span class="token comment">/*
	'''1. 修改发车流量信息'''
	修改发车流量信息需在MySimulator中的calcDynaDispatchParameters函数
	*/</span>
	<span class="token comment">/*
	'''2. 车辆位置移动'''
		# 见MySimulator中的afterOneStep函数
	*/</span>
	<span class="token comment">/*
	'''3. 修改车辆速度'''
		# 见MySimulator中的reSetSpeed函数
	*/</span>
	<span class="token comment">/*
	'''4. 修改车辆路径'''
		 # 以L1路段上的路径为例，见MySimulator中的afterOneStep函数
	*/</span>
	<span class="token comment">/*
	'''5. 强制车辆不变道'''
		 # 以L2路段上的路径为例，见MySimulator中的afterOneStep函数
	*/</span>
	<span class="token comment">/*
	'''6. 强制车辆变道'''
		 # 以L5路段上的路径为例，见MySimulator中的afterOneStep函数
	*/</span>
	<span class="token comment">/*
	'''7. 强制车辆闯红灯'''
		# 见MySimulator的reSetSpeed函数
	*/</span>
	<span class="token comment">/*
	'''8. 强制清除车辆'''
		# 以L5路段上的路径为例，见afterOneStep
	*/</span>
	<span class="token comment">/*
	'''9. 修改车辆航向角'''
		# 以L5路段上的路径为例，见afterStep
	*/</span>
	<span class="token comment">/*
	   10. 车道关闭和恢复
		# 可由强制变道和不变道实现。
	*/</span>
	mActionControlMethodNumber <span class="token operator">=</span> planNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-5-管控手段控制"><a href="#_5-5-管控手段控制" class="header-anchor">#</a> 5.5. 管控手段控制</h3> <p>1- 修改信号灯灯色（直接修改某个直行方向的信号灯颜色，如红色直接切换为绿色）</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/管控手段控制/20231120_150706_L12直行灯第10s强制修改为绿色持续50s.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">calcLampColor</span><span class="token punctuation">(</span>ISignalLamp<span class="token operator">*</span> pSignalLamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mContorlMeasureMethodNumber <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 将所有信号灯变为绿色</span>
		pSignalLamp<span class="token operator">-&gt;</span><span class="token function">setLampColor</span><span class="token punctuation">(</span><span class="token string">&quot;绿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2- 修改信号灯组方案</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//双环信控方案下发</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">doubleRingSignalControl</span><span class="token punctuation">(</span><span class="token keyword">long</span> currentSimuTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 读取方案数据</span>
	QFile <span class="token function">jsonFile</span><span class="token punctuation">(</span><span class="token string">&quot;./Data/Signal_Plan_Data_1109.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>jsonFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token double-colon punctuation">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Error: Could not open Signal_Plan_Data_1109.json&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	QByteArray jsonData <span class="token operator">=</span> jsonFile<span class="token punctuation">.</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	jsonFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QJsonDocument doc <span class="token operator">=</span> <span class="token class-name">QJsonDocument</span><span class="token double-colon punctuation">::</span><span class="token function">fromJson</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	QJsonObject signalGroupsDict <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>QJsonObject<span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> signalGroupsDict<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> signalGroupsDict<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		QString groupName <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QJsonObject group <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ISignalGroup<span class="token operator">*</span> pCurrentSignalGroup <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token comment">// 通过灯组名称查询到灯组</span>
		QList<span class="token operator">&lt;</span>ISignalGroup<span class="token operator">*</span><span class="token operator">&gt;</span> lAllSignalGroups <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">signalGroups</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>ISignalGroup<span class="token operator">*</span><span class="token operator">&amp;</span> pSignalGroup <span class="token operator">:</span> lAllSignalGroups<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pSignalGroup<span class="token operator">-&gt;</span><span class="token function">groupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> groupName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				pCurrentSignalGroup <span class="token operator">=</span> pSignalGroup<span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pCurrentSignalGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;FindError: The signalGroup not in current net.&quot;</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//获取当前灯组相位</span>
		QList<span class="token operator">&lt;</span>ISignalPhase<span class="token operator">*</span><span class="token operator">&gt;</span> lCurrentSignalGroupPhases <span class="token operator">=</span> pCurrentSignalGroup<span class="token operator">-&gt;</span><span class="token function">phases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 获取所有灯组的起始时间</span>
		QStringList lSignalGroupStartTime <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>QJsonObject<span class="token double-colon punctuation">::</span>iterator it2 <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it2 <span class="token operator">!=</span> group<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			QString startTime <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 获取下一个元素的迭代器</span>
			QJsonObject<span class="token double-colon punctuation">::</span>iterator nextIt <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">next</span><span class="token punctuation">(</span>it2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			QString endTime <span class="token operator">=</span> <span class="token punctuation">(</span>nextIt <span class="token operator">!=</span> group<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> nextIt<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;24:00&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// 起始时间和结束时间的秒数表示</span>
			<span class="token keyword">long</span> startTimeSeconds <span class="token operator">=</span> <span class="token class-name">Functions</span><span class="token double-colon punctuation">::</span><span class="token function">timeToSeconds</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">long</span> endTimeSeconds <span class="token operator">=</span> <span class="token class-name">Functions</span><span class="token double-colon punctuation">::</span><span class="token function">timeToSeconds</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 若当前仿真时间位于当前时段内，修改当前时段信号灯组的相位</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>startTimeSeconds <span class="token operator">&lt;=</span> currentSimuTime <span class="token operator">&amp;&amp;</span> currentSimuTime <span class="token operator">&lt;</span> endTimeSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				QJsonObject currentGroupData <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> periodTime <span class="token operator">=</span> currentGroupData<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;cycle_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> yellowInteral <span class="token operator">=</span> currentGroupData<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;yellow_interval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				QJsonArray phases <span class="token operator">=</span> currentGroupData<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;phases&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 修改周期</span>
				pCurrentSignalGroup<span class="token operator">-&gt;</span><span class="token function">setPeriodTime</span><span class="token punctuation">(</span>periodTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QJsonValueRef<span class="token operator">&amp;</span> phase <span class="token operator">:</span> phases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					QJsonObject phaseObj <span class="token operator">=</span> phase<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					QString phaseName <span class="token operator">=</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;phase_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> phaseNumber <span class="token operator">=</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;phase_number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;phaseName&quot;</span> <span class="token operator">&lt;&lt;</span> phaseName <span class="token operator">&lt;&lt;</span> phaseNumber <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>ColorInterval<span class="token operator">&gt;</span> lColorInterval<span class="token punctuation">;</span>
					lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;start_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;绿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;green_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;黄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> yellowInteral<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> remainingTime <span class="token operator">=</span> periodTime <span class="token operator">-</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;start_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;green_time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> yellowInteral<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>remainingTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						lColorInterval<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Online</span><span class="token double-colon punctuation">::</span><span class="token function">ColorInterval</span><span class="token punctuation">(</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> remainingTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 当前灯组包含的相位序号</span>
					ISignalPhase<span class="token operator">*</span> pCurrentPhase <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span>ISignalPhase<span class="token operator">*</span><span class="token operator">&amp;</span> pCurrentSignalGroupPhase <span class="token operator">:</span> lCurrentSignalGroupPhases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>phaseNumber <span class="token operator">==</span> pCurrentSignalGroupPhase<span class="token operator">-&gt;</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							pCurrentPhase <span class="token operator">=</span> pCurrentSignalGroupPhase<span class="token punctuation">;</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 若已存在该相位，修改相位灯色顺序，否则添加相位</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>pCurrentPhase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// 修改相位</span>
						pCurrentPhase<span class="token operator">-&gt;</span><span class="token function">setColorList</span><span class="token punctuation">(</span>lColorInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pCurrentPhase<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;相位设置成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{</span>
						ISignalPhase<span class="token operator">*</span> pSignalPhase <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createSignalPhase</span><span class="token punctuation">(</span>pCurrentSignalGroup<span class="token punctuation">,</span> phaseName<span class="token punctuation">,</span> lColorInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">// 设置相位序号</span>
						pSignalPhase<span class="token operator">-&gt;</span><span class="token function">setNumber</span><span class="token punctuation">(</span>phaseNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pSignalPhase<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;相位创建成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 设置相位包含的信号灯</span>
					QJsonArray lampList <span class="token operator">=</span> phaseObj<span class="token punctuation">[</span><span class="token function">QStringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;lamp_lst&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QJsonValue<span class="token operator">&amp;</span> lampId <span class="token operator">:</span> lampList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						ISignalLamp<span class="token operator">*</span> pLamp <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findSignalLamp</span><span class="token punctuation">(</span>lampId<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pLamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">/*
							 * 目前一个信号灯属于多个相位，相位间不交叉。
							 * 因此如果要实际下发方案时，应按照仿真时间实时管理相位序号。
							 */</span>
							pLamp<span class="token operator">-&gt;</span><span class="token function">setPhaseNumber</span><span class="token punctuation">(</span>phaseNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLamp<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;序号信号灯相位设置成功&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;FindError:未查找到信号灯:&quot;</span> <span class="token operator">&lt;&lt;</span> lampId<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3- 修改相位绿灯时间长度</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/管控手段控制/20231120_153332_修改相位红绿灯持续时间_L12直行红绿灯由红90绿32黄3红25改为红10绿110黄3红28.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ISignalPhase<span class="token operator">*</span> pSignalPhase7OfL12 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findSignalPhase</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Online<span class="token double-colon punctuation">::</span>ColorInterval <span class="token function">redIntervalFront</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">greenInterval</span><span class="token punctuation">(</span><span class="token string">&quot;绿&quot;</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">yellowInterval</span><span class="token punctuation">(</span><span class="token string">&quot;黄&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">redIntervalBack</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pSignalPhase7OfL12<span class="token operator">-&gt;</span><span class="token function">setColorList</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>ColorInterval<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> redIntervalFront <span class="token operator">&lt;&lt;</span> greenInterval <span class="token operator">&lt;&lt;</span> yellowInterval <span class="token operator">&lt;&lt;</span> redIntervalBack<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>5- 修改link, connector 限速</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/管控手段控制/20231120_160424_L5路段最高限速由80修改至20.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
	'''3. 修改路段限速'''
	*/</span>
	<span class="token comment">//以L5路段为例</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ILink<span class="token operator">*</span> pLink5 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		qreal minSpeedOfLink5 <span class="token operator">=</span> pLink5<span class="token operator">-&gt;</span><span class="token function">minSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>limitSpeed <span class="token operator">&gt;=</span> minSpeedOfLink5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pLink5<span class="token operator">-&gt;</span><span class="token function">setLimitSpeed</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>qreal<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>limitSpeed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>6- 修改link, connector 允许的车辆类型（暂时无法实现）</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//管控手段控制</span>
<span class="token keyword">void</span> <span class="token class-name">SecondaryDevCases</span><span class="token double-colon punctuation">::</span><span class="token function">controlMeasures</span><span class="token punctuation">(</span><span class="token keyword">float</span> planNumber<span class="token punctuation">,</span> <span class="token keyword">int</span> limitSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/*
	'''1. 修改信号灯灯色'''
	见MySimulator的calcLampColor函数
	*/</span>
	mContorlMeasureMethodNumber <span class="token operator">=</span> planNumber<span class="token punctuation">;</span>
	<span class="token comment">/*
	'''2. 修改信号灯灯色'''
	*/</span>
	<span class="token comment">// 以L12路段相位直行信号灯相位为例（ID为7），由红90绿32黄3红25改为红10绿110黄3红28</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ISignalPhase<span class="token operator">*</span> pSignalPhase7OfL12 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findSignalPhase</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Online<span class="token double-colon punctuation">::</span>ColorInterval <span class="token function">redIntervalFront</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">greenInterval</span><span class="token punctuation">(</span><span class="token string">&quot;绿&quot;</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">yellowInterval</span><span class="token punctuation">(</span><span class="token string">&quot;黄&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">redIntervalBack</span><span class="token punctuation">(</span><span class="token string">&quot;红&quot;</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pSignalPhase7OfL12<span class="token operator">-&gt;</span><span class="token function">setColorList</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>ColorInterval<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> redIntervalFront <span class="token operator">&lt;&lt;</span> greenInterval <span class="token operator">&lt;&lt;</span> yellowInterval <span class="token operator">&lt;&lt;</span> redIntervalBack<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/*
	'''3. 修改路段限速'''
	*/</span>
	<span class="token comment">//以L5路段为例</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>planNumber <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ILink<span class="token operator">*</span> pLink5 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		qreal minSpeedOfLink5 <span class="token operator">=</span> pLink5<span class="token operator">-&gt;</span><span class="token function">minSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>limitSpeed <span class="token operator">&gt;=</span> minSpeedOfLink5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pLink5<span class="token operator">-&gt;</span><span class="token function">setLimitSpeed</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>qreal<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>limitSpeed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-底层模型修改"><a href="#_6-底层模型修改" class="header-anchor">#</a> 6. 底层模型修改</h2> <h3 id="_6-1-跟驰模型"><a href="#_6-1-跟驰模型" class="header-anchor">#</a> 6.1 跟驰模型</h3> <p>1-修改跟驰模型参数（机动车，非机动车）</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/跟驰模型参数修改/20231120_144406_跟驰模型参数修改.mp4"></video></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 修改跟驰模型参数</span>
QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>FollowingModelParam<span class="token operator">&gt;</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reSetFollowingParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mModelModifyMethodNumber <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		Online<span class="token double-colon punctuation">::</span>FollowingModelParam followingModelParamMotor<span class="token punctuation">,</span> followingModelParamNonmotor<span class="token punctuation">;</span>
		<span class="token comment">// 机动车</span>
		followingModelParamMotor<span class="token punctuation">.</span>vtype <span class="token operator">=</span> Online<span class="token double-colon punctuation">::</span>MotorOrNonmotor<span class="token double-colon punctuation">::</span>Motor<span class="token punctuation">;</span>
		followingModelParamMotor<span class="token punctuation">.</span>alfa <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
		followingModelParamMotor<span class="token punctuation">.</span>beit <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
		followingModelParamMotor<span class="token punctuation">.</span>safeDistance <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
		followingModelParamMotor<span class="token punctuation">.</span>safeInterval <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 非机动车</span>
		followingModelParamNonmotor<span class="token punctuation">.</span>vtype <span class="token operator">=</span> Online<span class="token double-colon punctuation">::</span>MotorOrNonmotor<span class="token double-colon punctuation">::</span>Nonmotor<span class="token punctuation">;</span>
		followingModelParamNonmotor<span class="token punctuation">.</span>alfa <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
		followingModelParamNonmotor<span class="token punctuation">.</span>beit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		followingModelParamNonmotor<span class="token punctuation">.</span>safeDistance <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
		followingModelParamNonmotor<span class="token punctuation">.</span>safeInterval <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>FollowingModelParam<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> followingModelParamMotor <span class="token operator">&lt;&lt;</span> followingModelParamNonmotor<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>FollowingModelParam<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认参数效果</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/换道模型/20231120_181258_无修改版本.mp4"></video></p> <p>修改参数使车辆倾向变道</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/换道模型/20231120_182330_修改_倾向变道.mp4"></video></p> <p>修改参数使车辆不倾向变道</p> <p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/换道模型/20231120_182702_修改_不倾向变道.mp4"></video></p> <h3 id=""><a href="#" class="header-anchor">#</a></h3> <h3 id="_6-2-换道模型"><a href="#_6-2-换道模型" class="header-anchor">#</a> 6.2. 换道模型</h3> <p>1-选择变道类型：强制变道，压迫变道，自由变道</p> <p>暂不支持二次开发接口选择变道类型</p> <p>2- 设置强制变道，压迫变道参数(暂不支持，仅支持自有变道参数修改)</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
重新设置自由变道参数，
参数 safeTime : 安全操作时间，从驾驶员反应到实施变道(完成变道前半段)所需时间，默认4秒，
	ultimateDist:安全变道(完成变道前半段)后距前车距离，小于此距离压迫感增强，触发驾驶员寻求变道，
	targetRParm:目标车道后车影响系数，大于等于0小于等于1，此值越大目标车道后车距影响越大，反之则越小
*/</span>
<span class="token keyword">bool</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">reSetChangeLaneFreelyParam</span><span class="token punctuation">(</span>IVehicle<span class="token operator">*</span> pIVehicle<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> safeTime<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> ultimateDist<span class="token punctuation">,</span> qreal<span class="token operator">&amp;</span> targetRParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mpSecondDevCasesObj<span class="token operator">-&gt;</span>mModelModifyMethodNumber <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 安全操作时间，从驾驶员反应到实施变道(完成变道前半段)所需时间，默认4秒</span>
		safeTime <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
		<span class="token comment">// 安全变道(完成变道前半段)后距前车距离，小于此距离压迫感增强，触发驾驶员寻求变道</span>
		ultimateDist <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
		<span class="token comment">// 目标车道后车影响系数，大于等于0小于等于1，此值越大目标车道后车距影响越大，反之则越小</span>
		targetRParam <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><video controls="controls" width="100%" src="https://www.jidatraffic.com/newWebsite/video/20231213_162031_修改自由变道参数测试.mp4"></video></p> <h3 id="_6-3-冲突交互模型"><a href="#_6-3-冲突交互模型" class="header-anchor">#</a> 6.3. 冲突交互模型</h3> <p>1-根据link,车道序号|连接器编号获取冲突连接器对的优先关系</p> <p>2-修改连接器对的优先关系</p> <p>3- 修改连接器对的冲突模型参数</p> <p>4- 新增，修改，删除冲突模型参数</p> <p>5-获取所有冲突关系的冲突连接器对</p> <p>6- 一键设置同等路权的工具函数</p> <p>7- 重置优先关系</p> <p>8- 获取面域与连接器的映射关系</p> <p><strong>目前版本暂不支持二次开发方式操作以上参数， 用户只能在建模阶段人工设置</strong></p> <h3 id="_6-4-车辆汇入模型"><a href="#_6-4-车辆汇入模型" class="header-anchor">#</a> 6.4.  车辆汇入模型</h3> <p>暂不支持二次开发操作，用户可根据跟车模型，自由换道模型调整车辆运动行为</p> <h3 id="_6-5-车辆穿越模型"><a href="#_6-5-车辆穿越模型" class="header-anchor">#</a> 6.5. 车辆穿越模型</h3> <p>暂不支持二次开发操作，用户可根据跟车模型，自由换道模型，冲突交互模型调整车辆运动行为</p> <h2 id="_7-仿真输出"><a href="#_7-仿真输出" class="header-anchor">#</a> 7. 仿真输出</h2> <h3 id="_7-1-获取路网几何线性数据"><a href="#_7-1-获取路网几何线性数据" class="header-anchor">#</a> 7.1. 获取路网几何线性数据</h3> <p>路网二维平面主要由路段连接段组成，路段由路段自身和车道组成，连接段由连接段自身和“车道连接”组成，路段、车道、“车道连接”都存在中心线断点序列，车辆都是在这些点构成的线上移动的。取得这些断点序列的步骤如下：</p> <p>1）获取所有路段；</p> <p>2）获取路段的所有车道；</p> <p>3）获取车道的中心线断点序列</p> <p>4）获取所有连接段</p> <p>5）获取连接段的所有“车道连接”</p> <p>6）获取“车道连接”中心线断点序列</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//加载完路网后的行为</span>
<span class="token keyword">void</span> <span class="token class-name">MyNet</span><span class="token double-colon punctuation">::</span><span class="token function">afterLoadNet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">linkCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//软件打开后自动加载临时路网，因为临时路网上没有路段，所以下面创建路段等要素的语句得到执行</span>
		<span class="token function">createNet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//获取所有路段</span>
	QList<span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span> lLink <span class="token operator">=</span>  gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">links</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> minPointCount <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
	<span class="token function">foreach</span><span class="token punctuation">(</span>ILink <span class="token operator">*</span> pLink<span class="token punctuation">,</span> lLink<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//==============创建当前路段SVG=================</span>
		<span class="token comment">//路段中心线断点集</span>
		QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoints <span class="token operator">=</span> pLink<span class="token operator">-&gt;</span><span class="token function">centerBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//路段左侧断点集</span>
		QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lLeftPoints <span class="token operator">=</span> pLink<span class="token operator">-&gt;</span><span class="token function">leftBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//路段右侧断点集</span>
		QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lRightPoints <span class="token operator">=</span> pLink<span class="token operator">-&gt;</span><span class="token function">rightBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//创建路段SVG,略</span>

		<span class="token comment">//===============创建当前路段所有车道SVG================</span>
		<span class="token comment">//路段的所有车道</span>
		QList<span class="token operator">&lt;</span>ILane<span class="token operator">*</span><span class="token operator">&gt;</span> lLane <span class="token operator">=</span> pLink<span class="token operator">-&gt;</span><span class="token function">lanes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">foreach</span><span class="token punctuation">(</span>ILane <span class="token operator">*</span> pLane<span class="token punctuation">,</span> lLane<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pLane<span class="token operator">-&gt;</span><span class="token function">centerBreakPoint3Ds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> minPointCount<span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				minPointCount <span class="token operator">=</span> pLane<span class="token operator">-&gt;</span><span class="token function">centerBreakPoint3Ds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//车道中心线断点集</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lPoint <span class="token operator">=</span> pLane<span class="token operator">-&gt;</span><span class="token function">centerBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//车道左侧断点集</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lLeftPoint <span class="token operator">=</span> pLane<span class="token operator">-&gt;</span><span class="token function">leftBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//车道右侧断点集</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lRightPoint <span class="token operator">=</span> pLane<span class="token operator">-&gt;</span><span class="token function">rightBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> minPointCount<span class="token punctuation">;</span>

	<span class="token comment">//获取所有连接段</span>
	QList<span class="token operator">&lt;</span>IConnector<span class="token operator">*</span><span class="token operator">&gt;</span> lConnector <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">connectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">foreach</span><span class="token punctuation">(</span>IConnector<span class="token operator">*</span> pConn<span class="token punctuation">,</span> lConnector<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		QList<span class="token operator">&lt;</span>ILaneConnector<span class="token operator">*</span><span class="token operator">&gt;</span> lLC <span class="token operator">=</span> pConn<span class="token operator">-&gt;</span><span class="token function">laneConnectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">foreach</span><span class="token punctuation">(</span>ILaneConnector <span class="token operator">*</span> pLC<span class="token punctuation">,</span> lLC<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//&quot;车道连接”左侧断点集</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lLeftPoint <span class="token operator">=</span> pLC<span class="token operator">-&gt;</span><span class="token function">leftBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//“车道连接”右侧点集</span>
			QList<span class="token operator">&lt;</span>QPointF<span class="token operator">&gt;</span> lRightPoint <span class="token operator">=</span> pLC<span class="token operator">-&gt;</span><span class="token function">rightBreakPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//=========编制svg===========</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//如果配置文件配置了加载后启动仿真，则TESSNG会启动仿真，本方法不用启动仿真，否则本方法启动仿真</span>
	QJsonObject config <span class="token operator">=</span>  gpTessPlugin<span class="token operator">-&gt;</span><span class="token function">tessngConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;__simuafterload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;__simuafterload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2-检测器-采集器-排队计数器编辑"><a href="#_7-2-检测器-采集器-排队计数器编辑" class="header-anchor">#</a> 7.2. 检测器|采集器|排队计数器编辑</h3> <p>1-根据车道序号，位置新建排队计数器</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//在路段9最左侧车道100米处创建排队计数器</span>
IVehicleQueueCounter<span class="token operator">*</span> pCounter <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createVehiQueueCounterOnLink</span><span class="token punctuation">(</span>pLeftLane<span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;计数器所在点坐标为：(&quot;</span> <span class="token operator">&lt;&lt;</span> pCounter<span class="token operator">-&gt;</span><span class="token function">point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">&quot;,&quot;</span><span class="token operator">&lt;&lt;</span> pCounter<span class="token operator">-&gt;</span><span class="token function">point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">&quot;)&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

</code></pre></div><p>2-根据车道序号，位置新建行程时间检测器</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//在路段9 50-550米处创建行程检测器</span>
ILink<span class="token operator">*</span> pLink <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findLink</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pLink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
QList<span class="token operator">&lt;</span>IVehicleTravelDetector<span class="token operator">*</span><span class="token operator">&gt;</span> pDetector <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createVehicleTravelDetector_link2link</span><span class="token punctuation">(</span>pLink<span class="token punctuation">,</span> pLink<span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">550</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

</code></pre></div><p>3-根据路段获取检测器</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//3 - 根据路段，车道序号获取检测器(机动车交叉口案例：L5路段为起点，L9路段为终点)</span>
	QList<span class="token operator">&lt;</span>IVehicleTravelDetector<span class="token operator">*</span><span class="token operator">&gt;</span>  lvehiTravelDetectors <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">vehiTravelDetectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicleTravelDetector<span class="token operator">*</span><span class="token operator">&amp;</span> pVehicleTravelDetector <span class="token operator">:</span> lvehiTravelDetectors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ILink<span class="token operator">*</span> linkStartDetector <span class="token operator">=</span> pVehicleTravelDetector<span class="token operator">-&gt;</span><span class="token function">link_startDetector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ILink<span class="token operator">*</span> linkEndDetector <span class="token operator">=</span> pVehicleTravelDetector<span class="token operator">-&gt;</span><span class="token function">link_endDetector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>linkStartDetector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>linkStartDetector<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;find the startVehicleTravelDetector in L5:&quot;</span> <span class="token operator">&lt;&lt;</span> pVehicleTravelDetector<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>linkEndDetector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>linkEndDetector<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;find the endVehicleTravelDetector in L9:&quot;</span> <span class="token operator">&lt;&lt;</span> pVehicleTravelDetector<span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>4- 根据检测器获取车道</p> <p>目前仅支持车道连接</p> <p>5-设置检测器属性，如检测开始结束时间，检测间隔</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QList<span class="token operator">&lt;</span>IVehicleTravelDetector<span class="token operator">*</span><span class="token operator">&gt;</span> lVehicleTravelDetector <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createVehicleTravelDetector_link2link</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> link<span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">550</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lVehicleTravelDetector<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>IVehicleTravelDetector<span class="token operator">*</span> detector <span class="token operator">:</span> lVehicleTravelDetector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				detector<span class="token operator">-&gt;</span><span class="token function">setFromTime</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				detector<span class="token operator">-&gt;</span><span class="token function">setToTime</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

</code></pre></div><p>详见: <a href="/vuepress/document/V3.x/C++/details.html#_2-18-IVehicleDrivInfoCollector">接口详解-IVehicleDrivInfoCollector</a>、<a href="/vuepress/document/V3.x/C++/details.html#_2-19-IVehicleQueueCounter">接口详解-IVehicleQueueCounter</a>、<a href="/vuepress/document/V3.x/C++/details.html#_2-20-IVehicleTravelDetector">接口详解-IVehicleTravelDetector</a></p> <h3 id="_7-3-输出控制"><a href="#_7-3-输出控制" class="header-anchor">#</a> 7.3. 输出控制</h3> <p>1- 设置仿真过程中输出</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//一个批次计算后的处理</span>
<span class="token keyword">void</span> <span class="token class-name">MySimulator</span><span class="token double-colon punctuation">::</span><span class="token function">afterOneStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//============以下是获取一些仿真过程数据的方法============</span>
	<span class="token comment">//当前仿真计算批次</span>
	<span class="token keyword">long</span> batchNum <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">batchNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//当前已仿真时间，单位：毫秒</span>
	<span class="token keyword">long</span> simuTime <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">simuTimeIntervalWithAcceMutiples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>batchNum <span class="token operator">==</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setAcceMultiples</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//开始仿真的现实时间</span>
	qint64 startRealtime <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">startMSecsSinceEpoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//所有在运行车辆</span>
	QList<span class="token operator">&lt;</span>IVehicle<span class="token operator">*</span><span class="token operator">&gt;</span> lAllVehi <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">allVehiStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//ID为1的路段上所有已启动车辆</span>
	QList<span class="token operator">&lt;</span>IVehicle<span class="token operator">*</span><span class="token operator">&gt;</span> lVehi <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">vehisInLink</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//车辆轨迹</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehicleStatus<span class="token operator">&gt;</span> lVehiStatus <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//车辆数据采集信息</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiInfoCollected<span class="token operator">&gt;</span> lOutVehiInfo <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisInfoCollected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//采集器集计信息</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiInfoAggregated<span class="token operator">&gt;</span> lOutVehiInfoAggre <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisInfoAggregated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//车辆排队信息</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiQueueCounted<span class="token operator">&gt;</span> lOutVehiQueue <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisQueueCounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//车辆排队集计数据</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiQueueAggregated<span class="token operator">&gt;</span> lOutVehiQueueAggre <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisQueueAggregated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//行程序时间采集信息</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiTravelDetected<span class="token operator">&gt;</span> lOutVehiTravel <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisTravelDetected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//行程时间集计数据</span>
	QList<span class="token operator">&lt;</span>Online<span class="token double-colon punctuation">::</span>VehiTravelAggregated<span class="token operator">&gt;</span> lOutVehiTravelAggre <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">simuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getVehisTravelAggregated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2- 设置仿真结束后输出</p> <p>3- 设置轨迹输出频率，仿真过程中输出还是仿真结束后输出；输出的路径和名称</p> <p>4- 输出结构化路网</p> <p>5- 输出连接器和车道的路网的映射关系</p> <h2 id="_8-特殊应用场景"><a href="#_8-特殊应用场景" class="header-anchor">#</a> 8. 特殊应用场景</h2> <h3 id="_8-1-公交系统"><a href="#_8-1-公交系统" class="header-anchor">#</a> 8.1. 公交系统</h3> <p>1-新建公交站点（港湾式，路侧式）</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//创建公交线路</span>
		IBusLine<span class="token operator">*</span> pBusLine <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createBusLine</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink11<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pBusLine<span class="token operator">-&gt;</span><span class="token function">setDesirSpeed</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			IBusStation<span class="token operator">*</span> pBusStation1 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createBusStation</span><span class="token punctuation">(</span>pLink10<span class="token operator">-&gt;</span><span class="token function">lanes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;公交站1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			IBusStation<span class="token operator">*</span> pBusStation2 <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createBusStation</span><span class="token punctuation">(</span>pLink11<span class="token operator">-&gt;</span><span class="token function">lanes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;公交站2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusStation1 <span class="token operator">&amp;&amp;</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addBusStationToLine</span><span class="token punctuation">(</span>pBusLine<span class="token punctuation">,</span> pBusStation1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				pBusStation1<span class="token operator">-&gt;</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;公交站1已关联到公交线路&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusStation2 <span class="token operator">&amp;&amp;</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addBusStationToLine</span><span class="token punctuation">(</span>pBusLine<span class="token punctuation">,</span> pBusStation2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;公交站2已关联到公交线路&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token comment">//站点类型 1：路边式、2：港湾式</span>

</code></pre></div><p>2-新建公交线路</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//创建公交线路</span>
IBusLine<span class="token operator">*</span> pBusLine <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createBusLine</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink11<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pBusLine<span class="token operator">-&gt;</span><span class="token function">setDesirSpeed</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3-编辑线路站点</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//创建公交线路</span>
IBusLine<span class="token operator">*</span> pBusLine <span class="token operator">=</span> gpTessInterface<span class="token operator">-&gt;</span><span class="token function">netInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createBusLine</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">QList</span><span class="token generic class-name"><span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink11<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pBusLine<span class="token operator">-&gt;</span><span class="token function">setDesirSpeed</span><span class="token punctuation">(</span><span class="token function">m2p</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QList<span class="token operator">&lt;</span>IBusStationLine<span class="token operator">*</span><span class="token operator">&gt;</span> lStationLine <span class="token operator">=</span> pBusLine<span class="token operator">-&gt;</span><span class="token function">stationLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lStationLine<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			IBusStationLine<span class="token operator">*</span> pStationLine <span class="token operator">=</span> lStationLine<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 设置车辆停靠时间(秒)</span>
			pStationLine<span class="token operator">-&gt;</span><span class="token function">setBusParkingTime</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress/document/V3.x/C++/details.html" class="prev">
          接口详解
        </a></span> <span class="next"><a href="/vuepress/document/V3.x/C++/demo.html">
          行业案例
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-6ea58682 data-v-98796a12><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_1-界面交互" class="sidebar-link reco-side-_1-界面交互" data-v-6ea58682>1. 界面交互</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_1-1-增加菜单及菜单项" class="sidebar-link reco-side-_1-1-增加菜单及菜单项" data-v-6ea58682>1.1. 增加菜单及菜单项</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_1-2-获取车辆在路网二维平面上所有可移动的轨迹" class="sidebar-link reco-side-_1-2-获取车辆在路网二维平面上所有可移动的轨迹" data-v-6ea58682>1.2. 获取车辆在路网二维平面上所有可移动的轨迹</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_1-3-增加车辆显示内容" class="sidebar-link reco-side-_1-3-增加车辆显示内容" data-v-6ea58682>1.3. 增加车辆显示内容</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_2-路网编辑" class="sidebar-link reco-side-_2-路网编辑" data-v-6ea58682>2. 路网编辑</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_2-1-代码新建路网" class="sidebar-link reco-side-_2-1-代码新建路网" data-v-6ea58682>2.1.  代码新建路网</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_2-2-地图转tessng路网" class="sidebar-link reco-side-_2-2-地图转tessng路网" data-v-6ea58682>2.2. 地图转TESSNG路网</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_2-3-修改路网元素" class="sidebar-link reco-side-_2-3-修改路网元素" data-v-6ea58682>2.3. 修改路网元素</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_2-4-编辑路网附着物" class="sidebar-link reco-side-_2-4-编辑路网附着物" data-v-6ea58682>2.4. 编辑路网附着物</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_3-信控编辑" class="sidebar-link reco-side-_3-信控编辑" data-v-6ea58682>3. 信控编辑</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_3-1-新建信号灯" class="sidebar-link reco-side-_3-1-新建信号灯" data-v-6ea58682>3.1. 新建信号灯</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_3-2-编辑信号灯组" class="sidebar-link reco-side-_3-2-编辑信号灯组" data-v-6ea58682>3.2.  编辑信号灯组</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_3-3-信控方案下发" class="sidebar-link reco-side-_3-3-信控方案下发" data-v-6ea58682>3.3. 信控方案下发</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_4-需求加载与管理" class="sidebar-link reco-side-_4-需求加载与管理" data-v-6ea58682>4. 需求加载与管理</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_4-1-流量加载" class="sidebar-link reco-side-_4-1-流量加载" data-v-6ea58682>4.1. 流量加载</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_4-2-路径管理" class="sidebar-link reco-side-_4-2-路径管理" data-v-6ea58682>4.2.  路径管理</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_4-3-路径重构" class="sidebar-link reco-side-_4-3-路径重构" data-v-6ea58682>4.3.  路径重构</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_5-仿真运行" class="sidebar-link reco-side-_5-仿真运行" data-v-6ea58682>5. 仿真运行</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_5-1-倒车入库" class="sidebar-link reco-side-_5-1-倒车入库" data-v-6ea58682>5.1. 倒车入库</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_5-2-循环仿真" class="sidebar-link reco-side-_5-2-循环仿真" data-v-6ea58682>5.2. 循环仿真</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_5-3-流程控制" class="sidebar-link reco-side-_5-3-流程控制" data-v-6ea58682>5.3. 流程控制</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_5-4-动作控制" class="sidebar-link reco-side-_5-4-动作控制" data-v-6ea58682>5.4.  动作控制</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_5-5-管控手段控制" class="sidebar-link reco-side-_5-5-管控手段控制" data-v-6ea58682>5.5. 管控手段控制</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_6-底层模型修改" class="sidebar-link reco-side-_6-底层模型修改" data-v-6ea58682>6. 底层模型修改</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_6-1-跟驰模型" class="sidebar-link reco-side-_6-1-跟驰模型" data-v-6ea58682>6.1 跟驰模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#" class="sidebar-link reco-side-" data-v-6ea58682></a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_6-2-换道模型" class="sidebar-link reco-side-_6-2-换道模型" data-v-6ea58682>6.2. 换道模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_6-3-冲突交互模型" class="sidebar-link reco-side-_6-3-冲突交互模型" data-v-6ea58682>6.3. 冲突交互模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_6-4-车辆汇入模型" class="sidebar-link reco-side-_6-4-车辆汇入模型" data-v-6ea58682>6.4.  车辆汇入模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_6-5-车辆穿越模型" class="sidebar-link reco-side-_6-5-车辆穿越模型" data-v-6ea58682>6.5. 车辆穿越模型</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_7-仿真输出" class="sidebar-link reco-side-_7-仿真输出" data-v-6ea58682>7. 仿真输出</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_7-1-获取路网几何线性数据" class="sidebar-link reco-side-_7-1-获取路网几何线性数据" data-v-6ea58682>7.1. 获取路网几何线性数据</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_7-2-检测器-采集器-排队计数器编辑" class="sidebar-link reco-side-_7-2-检测器-采集器-排队计数器编辑" data-v-6ea58682>7.2. 检测器|采集器|排队计数器编辑</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_7-3-输出控制" class="sidebar-link reco-side-_7-3-输出控制" data-v-6ea58682>7.3. 输出控制</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_8-特殊应用场景" class="sidebar-link reco-side-_8-特殊应用场景" data-v-6ea58682>8. 特殊应用场景</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/C++/turorials.html#_8-1-公交系统" class="sidebar-link reco-side-_8-1-公交系统" data-v-6ea58682>8.1. 公交系统</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/vuepress/assets/js/app.00e88e4b.js" defer></script><script src="/vuepress/assets/js/4.fa06e885.js" defer></script><script src="/vuepress/assets/js/3.26fa4d2a.js" defer></script><script src="/vuepress/assets/js/1.23a03b08.js" defer></script><script src="/vuepress/assets/js/2.87db2cf7.js" defer></script><script src="/vuepress/assets/js/48.97909949.js" defer></script>
  </body>
</html>
