<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高频接口实战 | 二次开发</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/vuepress/logo.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.56d99626.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.bd557f6f.js" as="script"><link rel="preload" href="/vuepress/assets/js/4.fa06e885.js" as="script"><link rel="preload" href="/vuepress/assets/js/3.26fa4d2a.js" as="script"><link rel="preload" href="/vuepress/assets/js/1.8ad87f6f.js" as="script"><link rel="preload" href="/vuepress/assets/js/2.87db2cf7.js" as="script"><link rel="preload" href="/vuepress/assets/js/57.a78e7125.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.3c6ce834.js"><link rel="prefetch" href="/vuepress/assets/js/11.09762753.js"><link rel="prefetch" href="/vuepress/assets/js/14.b5e2fe37.js"><link rel="prefetch" href="/vuepress/assets/js/15.7779f75a.js"><link rel="prefetch" href="/vuepress/assets/js/16.dcb00087.js"><link rel="prefetch" href="/vuepress/assets/js/17.f5f97815.js"><link rel="prefetch" href="/vuepress/assets/js/18.a375d3e9.js"><link rel="prefetch" href="/vuepress/assets/js/19.8255e001.js"><link rel="prefetch" href="/vuepress/assets/js/20.11877118.js"><link rel="prefetch" href="/vuepress/assets/js/21.81070543.js"><link rel="prefetch" href="/vuepress/assets/js/22.a328fa26.js"><link rel="prefetch" href="/vuepress/assets/js/23.7b70a74b.js"><link rel="prefetch" href="/vuepress/assets/js/24.39eca4c0.js"><link rel="prefetch" href="/vuepress/assets/js/25.38a534ba.js"><link rel="prefetch" href="/vuepress/assets/js/26.6196ca23.js"><link rel="prefetch" href="/vuepress/assets/js/27.a2364143.js"><link rel="prefetch" href="/vuepress/assets/js/28.fb371d5d.js"><link rel="prefetch" href="/vuepress/assets/js/29.4b99363f.js"><link rel="prefetch" href="/vuepress/assets/js/30.23eeb12e.js"><link rel="prefetch" href="/vuepress/assets/js/31.305ec918.js"><link rel="prefetch" href="/vuepress/assets/js/32.fbc59b8b.js"><link rel="prefetch" href="/vuepress/assets/js/33.18dcd7ec.js"><link rel="prefetch" href="/vuepress/assets/js/34.7b0015f8.js"><link rel="prefetch" href="/vuepress/assets/js/35.b9d97528.js"><link rel="prefetch" href="/vuepress/assets/js/36.3bb2aed9.js"><link rel="prefetch" href="/vuepress/assets/js/37.ac45cea3.js"><link rel="prefetch" href="/vuepress/assets/js/38.64eba635.js"><link rel="prefetch" href="/vuepress/assets/js/39.b7a4e0d4.js"><link rel="prefetch" href="/vuepress/assets/js/40.fab28343.js"><link rel="prefetch" href="/vuepress/assets/js/41.3eafe134.js"><link rel="prefetch" href="/vuepress/assets/js/42.71090910.js"><link rel="prefetch" href="/vuepress/assets/js/43.c486453b.js"><link rel="prefetch" href="/vuepress/assets/js/44.3c5d9688.js"><link rel="prefetch" href="/vuepress/assets/js/45.fdcdfe6c.js"><link rel="prefetch" href="/vuepress/assets/js/46.00cc8482.js"><link rel="prefetch" href="/vuepress/assets/js/47.5ab78590.js"><link rel="prefetch" href="/vuepress/assets/js/48.bf2d57b6.js"><link rel="prefetch" href="/vuepress/assets/js/49.3dc8c444.js"><link rel="prefetch" href="/vuepress/assets/js/5.73d34e77.js"><link rel="prefetch" href="/vuepress/assets/js/50.777d1602.js"><link rel="prefetch" href="/vuepress/assets/js/51.7aa467c4.js"><link rel="prefetch" href="/vuepress/assets/js/52.95bdfa4b.js"><link rel="prefetch" href="/vuepress/assets/js/53.fa6b74e1.js"><link rel="prefetch" href="/vuepress/assets/js/54.45e7bc32.js"><link rel="prefetch" href="/vuepress/assets/js/55.3cc143c2.js"><link rel="prefetch" href="/vuepress/assets/js/56.5319b8e6.js"><link rel="prefetch" href="/vuepress/assets/js/6.ede881a6.js"><link rel="prefetch" href="/vuepress/assets/js/7.75b85482.js"><link rel="prefetch" href="/vuepress/assets/js/8.ff8c51a6.js"><link rel="prefetch" href="/vuepress/assets/js/9.9c71da5b.js"><link rel="prefetch" href="/vuepress/assets/js/vendors~docsearch.638bbdd1.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.56d99626.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-98796a12><div data-v-98796a12><div class="password-shadow password-wrapper-out" style="display:none;" data-v-08f61db9 data-v-98796a12 data-v-98796a12><h3 class="title" data-v-08f61db9>二次开发</h3> <p class="description" data-v-08f61db9>Just playing around</p> <label id="box" class="inputBox" data-v-08f61db9><input type="password" value="" data-v-08f61db9> <span data-v-08f61db9>Konck! Knock!</span> <button data-v-08f61db9>OK</button></label> <div class="footer" data-v-08f61db9><span data-v-08f61db9><i class="iconfont reco-theme" data-v-08f61db9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-08f61db9>vuePress-theme-reco</a></span> <span data-v-08f61db9><i class="iconfont reco-copyright" data-v-08f61db9></i> <a data-v-08f61db9><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-98796a12><header class="navbar" data-v-98796a12><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="nav-home-link"><a href="/vuepress/" class="home-link router-link-active"><img src="/vuepress/jida_logo.png" alt="二次开发" class="logo"></a> <div class="nav-home-text"><span class="site-name">二次开发</span> <div class="color-picker"><a class="color-button"><i class="iconfont reco-theme"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><ul class="color-mode-options"><li class="light">护眼模式</li><li class="dark">暗黑模式</li></ul></div></div></div></div></div> <div class="links"><div class="second-link"><img src="/link-icon.png">
      二次开发工具包
    </div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      Python3 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  Python3
</a></li><li class="dropdown-item"><!----> <a class="nav-link"><i class="undefined"></i>
  C++
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      V3.x 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  V3.x
</a></li></ul></div></div><div class="nav-item"><a href="https://www.jidatraffic.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  TESS NG 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/jida-traffic/TESSNG_SecondaryDev_Doc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-98796a12></div> <aside class="sidebar" data-v-98796a12><div class="side-top" data-v-98796a12><div class="search-box" data-v-98796a12><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      Python3 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  Python3
</a></li><li class="dropdown-item"><!----> <a class="nav-link"><i class="undefined"></i>
  C++
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i> 
      V3.x 
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a class="nav-link router-link-active"><i class="undefined"></i>
  V3.x
</a></li></ul></div></div><div class="nav-item"><a href="https://www.jidatraffic.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  TESS NG 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/jida-traffic/TESSNG_SecondaryDev_Doc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/vuepress/document/V3.x/Python3/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/vuepress/document/V3.x/Python3/1-changelog.html" class="sidebar-link">更新日志</a></li><li><a href="/vuepress/document/V3.x/Python3/install.html" class="sidebar-link">软件安装</a></li><li><a href="/vuepress/document/V3.x/Python3/quickstart.html" class="sidebar-link">快速入门</a></li><li><a href="/vuepress/document/V3.x/Python3/details.html" class="sidebar-link">接口详解</a></li><li><a href="/vuepress/document/V3.x/Python3/turorials.html" aria-current="page" class="active sidebar-link">典型接口案例</a></li><li><a href="/vuepress/document/V3.x/Python3/demo.html" class="sidebar-link">行业案例</a></li><li><a href="/vuepress/document/V3.x/Python3/2-information.html" class="sidebar-link">注意事项</a></li><li><a href="/vuepress/document/V3.x/Python3/3-QA.html" class="sidebar-link">问答列表</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-08f61db9 data-v-98796a12><h3 class="title" data-v-08f61db9></h3> <!----> <label id="box" class="inputBox" data-v-08f61db9><input type="password" value="" data-v-08f61db9> <span data-v-08f61db9>Konck! Knock!</span> <button data-v-08f61db9>OK</button></label> <div class="footer" data-v-08f61db9><span data-v-08f61db9><i class="iconfont reco-theme" data-v-08f61db9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-08f61db9>vuePress-theme-reco</a></span> <span data-v-08f61db9><i class="iconfont reco-copyright" data-v-08f61db9></i> <a data-v-08f61db9><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-98796a12><div data-v-98796a12><main class="page"><section style="display:;"><div class="theme-reco-content content__default"><h1 id="高频接口实战"><a href="#高频接口实战" class="header-anchor">#</a> 高频接口实战</h1> <table><thead><tr><th>大类</th> <th>功能点</th></tr></thead> <tbody><tr><td>仿真窗口操作</td> <td>自定义菜单栏；自定义按钮事件</td></tr> <tr><td>路网编辑</td> <td>新建路网</td></tr> <tr><td></td> <td>获取，修改，删除路网</td></tr> <tr><td></td> <td>新增编辑路网上的附着物</td></tr> <tr><td>信控编辑</td> <td>新建信号灯</td></tr> <tr><td></td> <td>信号灯组新建，编辑</td></tr> <tr><td></td> <td>双环信控方案下发</td></tr> <tr><td>需求加载与管理</td> <td>流量加载</td></tr> <tr><td></td> <td>路径管理</td></tr> <tr><td></td> <td>路径重构</td></tr> <tr><td>仿真运行</td> <td>流程控制</td></tr> <tr><td></td> <td>动作控制</td></tr> <tr><td></td> <td>管控手段控制</td></tr> <tr><td>底层模型修改</td> <td>跟驰模型</td></tr> <tr><td></td> <td>换道模型</td></tr> <tr><td></td> <td>冲突交互模型（暂不支持二次开发）</td></tr> <tr><td></td> <td>车辆汇入模型</td></tr> <tr><td></td> <td>车辆穿越模型</td></tr> <tr><td>仿真输出</td> <td>检测器编辑</td></tr> <tr><td></td> <td>采集器编辑</td></tr> <tr><td></td> <td>输出控制</td></tr> <tr><td>特殊应用场景</td> <td>公交系统</td></tr> <tr><td></td> <td>行人系统</td></tr> <tr><td></td> <td>停车场系统</td></tr> <tr><td></td> <td>收费站系统</td></tr></tbody></table> <p>本章所有接口范例均可在安装包《安装目录/SecondaryDevCases/SecondaryDevCases.py》中找到；用户可以到GitHub下载</p> <p><a href="https://github.com/jida-traffic/TESSNG_SecondaryDev_Doc" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="">官网下载</a>:</p> <h2 id="_1-界面交互"><a href="#_1-界面交互" class="header-anchor">#</a> 1. 界面交互</h2> <h3 id="_1-1-增加菜单及菜单项"><a href="#_1-1-增加菜单及菜单项" class="header-anchor">#</a> 1.1. 增加菜单及菜单项</h3> <p>利用TessInterface及其子接口实现，可以在插件init()方法中创建菜单及菜单项，代码如下:</p> <div class="language-python extra-class"><pre class="language-python"><code>
<span class="token comment"># 用户插件，继承自TessPlugin</span>
<span class="token keyword">class</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span>TessPlugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MyPlugin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mNetInf <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>mSimuInf <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">initGui</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 在TESS NG主界面上增加 QDockWidget对象</span>
        self<span class="token punctuation">.</span>examleWindow <span class="token operator">=</span> TESS_API_EXAMPLE<span class="token punctuation">(</span><span class="token punctuation">)</span>

        iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
        win <span class="token operator">=</span> iface<span class="token punctuation">.</span>guiInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>

        dockWidget <span class="token operator">=</span> QDockWidget<span class="token punctuation">(</span><span class="token string">&quot;自定义与TESS NG交互界面&quot;</span><span class="token punctuation">,</span> win<span class="token punctuation">)</span>
        dockWidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">&quot;mainDockWidget&quot;</span><span class="token punctuation">)</span>
        dockWidget<span class="token punctuation">.</span>setFeatures<span class="token punctuation">(</span>QDockWidget<span class="token punctuation">.</span>NoDockWidgetFeatures<span class="token punctuation">)</span>
        dockWidget<span class="token punctuation">.</span>setAllowedAreas<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>LeftDockWidgetArea<span class="token punctuation">)</span>
        dockWidget<span class="token punctuation">.</span>setWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>examleWindow<span class="token punctuation">.</span>centralWidget<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        iface<span class="token punctuation">.</span>guiInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addDockWidgetToMainWindow<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>DockWidgetArea<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dockWidget<span class="token punctuation">)</span>

        <span class="token comment"># 增加菜单及菜单项</span>
        menuBar <span class="token operator">=</span> iface<span class="token punctuation">.</span>guiInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>menuBar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        menu <span class="token operator">=</span> QMenu<span class="token punctuation">(</span>menuBar<span class="token punctuation">)</span>
        menu<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">&quot;menuExample&quot;</span><span class="token punctuation">)</span>
        menuBar<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span>menu<span class="token punctuation">.</span>menuAction<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        menu<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span><span class="token string">&quot;范例菜单&quot;</span><span class="token punctuation">)</span>
        actionOk <span class="token operator">=</span> menu<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span><span class="token string">&quot;范例菜单项&quot;</span><span class="token punctuation">)</span>
        actionOk<span class="token punctuation">.</span>setCheckable<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        actionOk<span class="token punctuation">.</span>triggered<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>examleWindow<span class="token punctuation">.</span>isOk<span class="token punctuation">)</span>
</code></pre></div><p>结果如下：</p> <p><img src="/img/%E5%88%9B%E5%BB%BA%E8%8C%83%E4%BE%8B%E8%8F%9C%E5%8D%95.png" alt="创建范例菜单"></p> <p>点击菜单项“范例菜单项”弹出对话框：
<img src="/img/%E5%9B%BE11%E8%8C%83%E4%BE%8B%E8%8F%9C%E5%8D%95%E7%82%B9%E5%87%BB%E6%95%88%E6%9E%9C.png" alt="范例菜单点击效果"></p> <h3 id="_1-2-自定义车辆显示内容"><a href="#_1-2-自定义车辆显示内容" class="header-anchor">#</a> 1.2. 自定义车辆显示内容</h3> <p>下图展示自动驾驶车辆，雷达探测范围100米。</p> <p><img src="/img/%E5%9B%BE12%E5%A2%9E%E5%8A%A0%E8%BD%A6%E8%BE%86%E6%98%BE%E7%A4%BA%E5%86%85%E5%AE%B9.png" alt="增加车辆显示内容"></p> <p>为了增添车辆展示的内容，可以实现接口PyCustomerSimulator的如下方法</p> <p>def rePaintVehicle(self, pIVehicle:Tessng.IVehicle, painter:PySide2.QtGui.QPainter) -&gt; None: ...</p> <h2 id="_2-路网编辑"><a href="#_2-路网编辑" class="header-anchor">#</a> 2. 路网编辑</h2> <h3 id="_2-1-代码新建路网"><a href="#_2-1-代码新建路网" class="header-anchor">#</a> 2.1.  代码新建路网</h3> <p>1- 新建link</p> <p>2- 新建connector</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">createNet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 第一条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link1 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;曹安公路&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link1 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token comment"># 车道列表</span>
        lanes <span class="token operator">=</span> link1<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 打印该路段所有车道ID列表</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;曹安公路车道ID列表：&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>lane<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> lane <span class="token keyword">in</span> lanes<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 在当前路段创建发车点</span>
        dp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDispatchPoint<span class="token punctuation">(</span>link1<span class="token punctuation">)</span>
        <span class="token keyword">if</span> dp <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># 设置发车间隔，含车型组成、时间间隔、发车数</span>
            dp<span class="token punctuation">.</span>addDispatchInterval<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span>

    <span class="token comment"># 第二条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link2 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;次干道&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link2 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        dp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDispatchPoint<span class="token punctuation">(</span>link2<span class="token punctuation">)</span>
        <span class="token keyword">if</span> dp <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            dp<span class="token punctuation">.</span>addDispatchInterval<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span>
        <span class="token comment"># 将外侧车道设为”公交专用道&quot;</span>
        lanes <span class="token operator">=</span> link2<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span>
        lanes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>setLaneType<span class="token punctuation">(</span><span class="token string">&quot;公交专用道&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 第三条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link3 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link3 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        dp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDispatchPoint<span class="token punctuation">(</span>link3<span class="token punctuation">)</span>
        <span class="token keyword">if</span> dp <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            dp<span class="token punctuation">.</span>addDispatchInterval<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第四条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link4 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第五条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link5 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;自定义限速路段&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link5 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        link5<span class="token punctuation">.</span>setLimitSpeed<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第六条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link6 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;动态发车路段&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link6 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        link6<span class="token punctuation">.</span>setLimitSpeed<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第七条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link7 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link7 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        link7<span class="token punctuation">.</span>setLimitSpeed<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第八条路段</span>
    startPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">]</span>
    link8 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> link8 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        link8<span class="token punctuation">.</span>setLimitSpeed<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第一条连接段</span>
    <span class="token keyword">if</span> link3 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> link4 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        lFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        lToLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        conn1 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createConnector<span class="token punctuation">(</span>link3<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link4<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span> <span class="token string">&quot;连接段1&quot;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第二条连接段</span>
    <span class="token keyword">if</span> link4 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> link5 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        lFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        lToLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        conn2 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createConnector<span class="token punctuation">(</span>link4<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link5<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span> <span class="token string">&quot;连接段2&quot;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建第三条连接段</span>
    <span class="token keyword">if</span> link7 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> link8 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        lFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        lToLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        conn3 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createConnector<span class="token punctuation">(</span>link7<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link8<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span> <span class="token string">&quot;动态发车连接段&quot;</span><span class="token punctuation">,</span>
                                         <span class="token boolean">True</span><span class="token punctuation">)</span>
    routing <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createRouting<span class="token punctuation">(</span><span class="token punctuation">[</span>link7<span class="token punctuation">,</span> link8<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>routing<span class="token punctuation">)</span>

</code></pre></div><h3 id="_2-2-地图转tessng路网"><a href="#_2-2-地图转tessng路网" class="header-anchor">#</a> 2.2. 地图转TESSNG路网</h3> <p>导入opendrive， osm shapely生成tessng路网；直接使用pytessng的工具代码;</p> <p>截图：</p> <p><img src="/img/pytessng.png" alt="pytessng"></p> <p>工具链接：<a href="https://pypi.org/search/?q=pytessng" target="_blank" rel="noopener noreferrer">pytessng<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>安装命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>pip <span class="token function">install</span> pytessng
</code></pre></div><h3 id="_2-3-修改路网元素"><a href="#_2-3-修改路网元素" class="header-anchor">#</a> 2.3. 修改路网元素</h3> <p>1-修改删除link编号，名称，形状，长度，宽度等属性</p> <p>2-修改connector的laneconnector连接关系，形状；</p> <p>3- 获取link, connector, connectorarea, laneconnector形状，属性</p> <p>用户可以先获取目标对象，在修改对象属性</p> <p>详见<a href="/vuepress/document/V3.x/Python3/details.html">接口详解</a></p> <h3 id="_2-4-编辑路网附着物"><a href="#_2-4-编辑路网附着物" class="header-anchor">#</a> 2.4. 编辑路网附着物</h3> <p>1-新建删除车道导向箭头；</p> <p>2-限速区：指定车道位置设置，限速区的长度，生效时间, 速度值</p> <p>3-施工区：根据车辆序号和位置，施工区长度新建</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">createworkZone</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 创建施工区
    :param :
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 创建施工区</span>
    workZone <span class="token operator">=</span> Online<span class="token punctuation">.</span>DynaRoadWorkZoneParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 道路ID</span>
    workZone<span class="token punctuation">.</span>roadId <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token comment"># 施工区名称</span>
    workZone<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;施工区，限速40,持续20秒&quot;</span>
    <span class="token comment"># 位置，距离路段或连接段起点距离，单位米</span>
    workZone<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token number">50</span>
    <span class="token comment"># 施工区长度，单位米</span>
    workZone<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">50</span>
    <span class="token comment"># 车辆经过施工区的最大车速，单位千米/小时</span>
    workZone<span class="token punctuation">.</span>limitSpeed <span class="token operator">=</span> <span class="token number">40</span>
    <span class="token comment"># 施工区施工时长，单位秒</span>
    workZone<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">20</span>
    <span class="token comment"># 施工区起始车道</span>
    workZone<span class="token punctuation">.</span>mlFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 创建施工区</span>
    zone <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createRoadWorkZone<span class="token punctuation">(</span>workZone<span class="token punctuation">)</span>

</code></pre></div><p>5-事故区：根据车道序号，位置，影响范围新建</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 创建事故区</span>
accidentZone <span class="token operator">=</span> Online<span class="token punctuation">.</span>DynaAccidentZoneParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 道路ID</span>
accidentZone<span class="token punctuation">.</span>roadId <span class="token operator">=</span> <span class="token number">9</span>
<span class="token comment"># 事故区名称</span>
accidentZone<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;最左侧车道发生事故&quot;</span>
<span class="token comment"># 位置，距离路段或连接段起点距离，单位米</span>
accidentZone<span class="token punctuation">.</span>location <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token comment"># 事故区长度，单位米</span>
accidentZone<span class="token punctuation">.</span>length <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment"># 事故区起始车道序号列表</span>
accidentZone<span class="token punctuation">.</span>mlFromLaneNumber<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token comment"># 事故等级</span>
accidentZone<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment"># 创建事故区</span>

</code></pre></div><p>6-公交站：根据车道序号，位置，长度，类型设置；</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 创建公交线路</span>
busLine <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusLine<span class="token punctuation">(</span><span class="token punctuation">[</span>link10<span class="token punctuation">,</span> link11<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> busLine <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
   busLine<span class="token punctuation">.</span>setDesirSpeed<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   busStation1 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusStation<span class="token punctuation">(</span>link10<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;公交站1&quot;</span><span class="token punctuation">)</span>
   busStation2 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusStation<span class="token punctuation">(</span>link11<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;公交站2&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 创建公交线路</span>
<span class="token keyword">if</span> busStation1 <span class="token keyword">and</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addBusStationToLine<span class="token punctuation">(</span>busLine<span class="token punctuation">,</span> busStation1<span class="token punctuation">)</span><span class="token punctuation">:</span>
  	busStation1<span class="token punctuation">.</span>setType<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;公交站1已关联到公交线路&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> busStation2 <span class="token keyword">and</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addBusStationToLine<span class="token punctuation">(</span>busLine<span class="token punctuation">,</span> busStation2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;公交站2已关联到公交线路&quot;</span><span class="token punctuation">)</span>

</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>lStationLine <span class="token operator">=</span> busLine<span class="token punctuation">.</span>stationLines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lStationLine<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
    stationLine <span class="token operator">=</span> lStationLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 
    <span class="token comment"># 设置车辆停靠时间(秒)</span>
    stationLine<span class="token punctuation">.</span>setBusParkingTime<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre></div><p>详见<a href="/vuepress/document/V3.x/Python3/details.html">接口详解</a></p> <h2 id="_3-信控编辑"><a href="#_3-信控编辑" class="header-anchor">#</a> 3. 信控编辑</h2> <h3 id="_3-1-新建信号灯"><a href="#_3-1-新建信号灯" class="header-anchor">#</a> 3.1. 新建信号灯</h3> <p>1- 根据车道序号，位置新建信号灯</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> index<span class="token punctuation">,</span> laneObj <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lLaneObjects<span class="token punctuation">)</span><span class="token punctuation">:</span>
    signalLamp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createSignalLamp<span class="token punctuation">(</span>signalPhase<span class="token punctuation">,</span> <span class="token string">&quot;信号灯{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>fromLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>laneObj<span class="token punctuation">.</span>toLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="_3-2-编辑信号灯组"><a href="#_3-2-编辑信号灯组" class="header-anchor">#</a> 3.2.  编辑信号灯组</h3> <p>2- 新建信号灯组，设置信号相位相序和灯色</p> <p>核心代码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">edit_signal_controller</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 信控编辑
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建两条新路段和一条连接段作为示例</span>
    startPoint1 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint1 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint1 <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint1<span class="token punctuation">,</span> endPoint1<span class="token punctuation">]</span>
    link1 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;信控编辑路段1&quot;</span><span class="token punctuation">)</span>

    startPoint2 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint2 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint2 <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint2<span class="token punctuation">,</span> endPoint2<span class="token punctuation">]</span>
    link2 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;信控编辑路段2&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 连接段车道连接列表</span>
    lLaneObjects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> link1 <span class="token keyword">and</span> link2<span class="token punctuation">:</span>
        lFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        lToLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        connector <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createConnector<span class="token punctuation">(</span>link1<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link2<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span>
                                             <span class="token string">&quot;信控编辑连接段&quot;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> connector<span class="token punctuation">:</span>
            lLaneObjects <span class="token operator">=</span> connector<span class="token punctuation">.</span>laneObjects<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> laneObj <span class="token keyword">in</span> lLaneObjects<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上游车道ID&quot;</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>fromLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;下游车道ID&quot;</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>toLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 创建发车点</span>
    <span class="token keyword">if</span> link1<span class="token punctuation">:</span>
        dp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDispatchPoint<span class="token punctuation">(</span>link1<span class="token punctuation">)</span>
        <span class="token keyword">if</span> dp<span class="token punctuation">:</span>
            dp<span class="token punctuation">.</span>addDispatchInterval<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建信号灯组</span>
    signalGroup <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createSignalGroup<span class="token punctuation">(</span><span class="token string">&quot;信号灯组1&quot;</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span>
    <span class="token comment"># 创建相位,40秒绿灯，黄灯3秒，全红3秒</span>
    red <span class="token operator">=</span> Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">&quot;G&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
    green <span class="token operator">=</span> Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">&quot;Y&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    yellow <span class="token operator">=</span> Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">&quot;R&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    signalPhase <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createSignalPhase<span class="token punctuation">(</span>signalGroup<span class="token punctuation">,</span> <span class="token string">&quot;信号灯组1相位1&quot;</span><span class="token punctuation">,</span>
                                             <span class="token punctuation">[</span>green<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> red<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 创建信号灯</span>
    <span class="token keyword">for</span> index<span class="token punctuation">,</span> laneObj <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lLaneObjects<span class="token punctuation">)</span><span class="token punctuation">:</span>
        signalLamp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createSignalLamp<span class="token punctuation">(</span>signalPhase<span class="token punctuation">,</span> <span class="token string">&quot;信号灯{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>fromLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                               laneObj<span class="token punctuation">.</span>toLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-3-信控方案下发"><a href="#_3-3-信控方案下发" class="header-anchor">#</a> 3.3. 信控方案下发</h3> <p>3- 支持双环结构信控方案下发（前提是已正确新建信号灯；已知一个路口所有进口道的流向及车道对应的信号灯id）</p> <p>核心代码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> Tessng <span class="token keyword">import</span> Online
<span class="token keyword">def</span> <span class="token function">double_ring_signal_control</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> current_simuTime<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 双环信控方案下发
    :param current_simuTime: 当前仿真时间
    :return:
    &quot;&quot;&quot;</span>

    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 读取方案数据</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./Data/Signal_Plan_Data_1109.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json_file<span class="token punctuation">:</span>
        signal_groups_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>json_file<span class="token punctuation">)</span>

    <span class="token comment"># 创建信号灯组和相位</span>
    <span class="token keyword">for</span> group_name<span class="token punctuation">,</span> group <span class="token keyword">in</span> signal_groups_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 当前灯组</span>
        current_signal_group <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token comment"># 通过灯组名称查询到灯组</span>
        all_signal_groups_lst <span class="token operator">=</span> netiface<span class="token punctuation">.</span>signalGroups<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> signal_group <span class="token keyword">in</span> all_signal_groups_lst<span class="token punctuation">:</span>
            <span class="token keyword">if</span> signal_group<span class="token punctuation">.</span>groupName<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> group_name<span class="token punctuation">:</span>
                current_signal_group <span class="token operator">=</span> signal_group
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> current_signal_group<span class="token punctuation">:</span>
            current_signal_group_phases_lst <span class="token operator">=</span> current_signal_group<span class="token punctuation">.</span>phases<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;FindError: The signalGroup not in current net.&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>

        <span class="token comment"># 获取所有灯组的起始时间</span>
        signal_group_startTime_lst <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> index<span class="token punctuation">,</span> group_data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            start_time <span class="token operator">=</span> signal_group_startTime_lst<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
            end_time <span class="token operator">=</span> signal_group_startTime_lst<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> index <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>
                signal_group_startTime_lst<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">&quot;24:00&quot;</span>
            <span class="token comment"># 起始时间和结束时间的秒数表示</span>
            start_time_seconds <span class="token operator">=</span> time_to_seconds<span class="token punctuation">(</span>start_time<span class="token punctuation">)</span>
            end_time_seconds <span class="token operator">=</span> time_to_seconds<span class="token punctuation">(</span>end_time<span class="token punctuation">)</span>
            <span class="token comment"># 若当前仿真时间位于当前时段内，修改当前时段信号灯组的相位</span>
            <span class="token keyword">if</span> start_time_seconds <span class="token operator">&lt;=</span> current_simuTime <span class="token operator">&lt;</span> end_time_seconds<span class="token punctuation">:</span>
                period_time <span class="token operator">=</span> group_data<span class="token punctuation">[</span><span class="token string">'cycle_time'</span><span class="token punctuation">]</span>
                phases <span class="token operator">=</span> group_data<span class="token punctuation">[</span><span class="token string">'phases'</span><span class="token punctuation">]</span>
                <span class="token comment"># 修改周期</span>
                current_signal_group<span class="token punctuation">.</span>setPeriodTime<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>period_time<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> phase <span class="token keyword">in</span> phases<span class="token punctuation">:</span>
                    phase_name <span class="token operator">=</span> phase<span class="token punctuation">[</span><span class="token string">'phase_name'</span><span class="token punctuation">]</span>
                    phase_number <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>phase<span class="token punctuation">[</span><span class="token string">'phase_number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    color_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 按照红灯、绿灯、黄灯、红灯顺序计算</span>
                    color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'红'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>phase<span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'绿'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>phase<span class="token punctuation">[</span><span class="token string">'green_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'黄'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>period_time <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'green_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                            Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'红'</span><span class="token punctuation">,</span>
                                                 <span class="token builtin">int</span><span class="token punctuation">(</span>period_time <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'green_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token comment"># 当前灯组包含的相位序号</span>
                    current_phase <span class="token operator">=</span> <span class="token boolean">None</span>
                    <span class="token keyword">for</span> current_signal_group_phase <span class="token keyword">in</span> current_signal_group_phases_lst<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> phase_number <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>current_signal_group_phase<span class="token punctuation">.</span>number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            current_phase <span class="token operator">=</span> current_signal_group_phase
                            <span class="token keyword">break</span>

                    <span class="token comment"># 若已存在该相位，修改相位灯色顺序，否则添加相位</span>
                    <span class="token keyword">if</span> current_phase<span class="token punctuation">:</span>
                        <span class="token comment"># 修改相位</span>
                        current_phase<span class="token punctuation">.</span>setColorList<span class="token punctuation">(</span>color_list<span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        signal_phase <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createSignalPhase<span class="token punctuation">(</span>current_signal_group<span class="token punctuation">,</span> phase_name<span class="token punctuation">,</span> color_list<span class="token punctuation">)</span>
                        <span class="token comment"># 设置相位序号</span>
                        signal_phase<span class="token punctuation">.</span>setNumber<span class="token punctuation">(</span>phase_number<span class="token punctuation">)</span>
                    <span class="token comment"># 设置相位包含的信号灯</span>
                    <span class="token keyword">for</span> lampId <span class="token keyword">in</span> phase<span class="token punctuation">[</span><span class="token string">&quot;lamp_lst&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        lamp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findSignalLamp<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>lampId<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> lamp<span class="token punctuation">:</span>
                            <span class="token triple-quoted-string string">'''
                            目前一个信号灯属于多个相位，相位间不交叉。因此如果要实际下发方案时，应按照仿真时间实时管理相位序号。
                            '''</span>
                            lamp<span class="token punctuation">.</span>setPhaseNumber<span class="token punctuation">(</span>phase_number<span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;FindError:未查找到信号灯:&quot;</span><span class="token punctuation">,</span> lampId<span class="token punctuation">)</span>

</code></pre></div><p>案例效果：</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/20231201_134842_双环信控方案下发测试效果.mp4"></video></p> <h2 id="_4-需求加载与管理"><a href="#_4-需求加载与管理" class="header-anchor">#</a> 4. 需求加载与管理</h2> <h3 id="_4-1-流量加载"><a href="#_4-1-流量加载" class="header-anchor">#</a> 4.1. 流量加载</h3> <p>支持多种方式加载车辆，供用户灵活使用</p> <p>1-新建发车点，设置发车流量时间间隔；设置发车分布；设置车辆组成，车辆类型（发车点已创建后无法修改车辆组成和车辆类型，可以创建车辆组成和车辆类型后设置发车点）；</p> <p><img src="/img/%E5%88%9B%E5%BB%BA%E8%BD%A6%E8%BE%86%E7%BB%84%E6%88%90%EF%BC%8C%E6%8C%87%E5%AE%9A%E8%BD%A6%E5%9E%8B.png" alt="创建车辆组成，指定车型"></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231110_122009_流量加载_创建车辆组成和发车点.mp4"></video></p> <p>2-动态发车：不设置发车点，在指定车道和位置处加载车辆（一辆一辆加载）</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231113_095503_指定车道和位置加载车辆.mp4"></video></p> <p>核心代码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">traffic_loading</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 流量加载
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">'''1.新建发车点'''</span>
    <span class="token comment"># 创建两条新路段和一条连接段作为示例</span>
    startPoint1 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint1 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint1 <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint1<span class="token punctuation">,</span> endPoint1<span class="token punctuation">]</span>
    link1 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;流量加载路段1&quot;</span><span class="token punctuation">)</span>

    startPoint2 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    endPoint2 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lPoint2 <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint2<span class="token punctuation">,</span> endPoint2<span class="token punctuation">]</span>
    link2 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;流量加载路段2&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 连接段车道连接列表</span>
    lLaneObjects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> link1 <span class="token keyword">and</span> link2<span class="token punctuation">:</span>
        lFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        lToLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        connector <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createConnector<span class="token punctuation">(</span>link1<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link2<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span>
                                             <span class="token string">&quot;流量加载连接段&quot;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> connector<span class="token punctuation">:</span>
            lLaneObjects <span class="token operator">=</span> connector<span class="token punctuation">.</span>laneObjects<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> laneObj <span class="token keyword">in</span> lLaneObjects<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上游车道ID&quot;</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>fromLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;下游车道ID&quot;</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>toLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># 创建车辆组成及指定车辆类型</span>
        vehiType_proportion_lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 车型组成：小客车0.3，大客车0.2，公交车0.1，货车0.4</span>
        vehiType_proportion_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>VehiComposition<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        vehiType_proportion_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>VehiComposition<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        vehiType_proportion_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>VehiComposition<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        vehiType_proportion_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>VehiComposition<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        vehiCompositionID <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createVehicleComposition<span class="token punctuation">(</span><span class="token string">&quot;动态创建车型组成&quot;</span><span class="token punctuation">,</span> vehiType_proportion_lst<span class="token punctuation">)</span>
        <span class="token keyword">if</span> vehiCompositionID <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;车型组成创建成功，id为：&quot;</span><span class="token punctuation">,</span> vehiCompositionID<span class="token punctuation">)</span>
            <span class="token comment"># 新建发车点,车型组成ID为动态创建的，600秒发300辆车</span>
            <span class="token keyword">if</span> link1<span class="token punctuation">:</span>
                dp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDispatchPoint<span class="token punctuation">(</span>link1<span class="token punctuation">)</span>
                <span class="token keyword">if</span> dp<span class="token punctuation">:</span>
                    dp<span class="token punctuation">.</span>addDispatchInterval<span class="token punctuation">(</span>vehiCompositionID<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>

        <span class="token triple-quoted-string string">'''2.动态发车'''</span>
        <span class="token comment"># 创建两条新路段和一条连接段作为示例</span>
        startPoint3 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        endPoint3 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        lPoint3 <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint3<span class="token punctuation">,</span> endPoint3<span class="token punctuation">]</span>
        link3 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint3<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;动态加载车辆段&quot;</span><span class="token punctuation">)</span>

        startPoint4 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        endPoint4 <span class="token operator">=</span> QPointF<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        lPoint4 <span class="token operator">=</span> <span class="token punctuation">[</span>startPoint4<span class="token punctuation">,</span> endPoint4<span class="token punctuation">]</span>
        link4 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createLink<span class="token punctuation">(</span>lPoint4<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;动态加载车辆段&quot;</span><span class="token punctuation">)</span>

        <span class="token comment"># 连接段车道连接列表</span>
        lLaneObjects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> link3 <span class="token keyword">and</span> link4<span class="token punctuation">:</span>
            lFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
            lToLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
            connector <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createConnector<span class="token punctuation">(</span>link3<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> link4<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lFromLaneNumber<span class="token punctuation">,</span> lToLaneNumber<span class="token punctuation">,</span>
                                                 <span class="token string">&quot;动态加载加载连接段&quot;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> connector<span class="token punctuation">:</span>
                lLaneObjects <span class="token operator">=</span> connector<span class="token punctuation">.</span>laneObjects<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> laneObj <span class="token keyword">in</span> lLaneObjects<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上游车道ID&quot;</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>fromLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;下游车道ID&quot;</span><span class="token punctuation">,</span> laneObj<span class="token punctuation">.</span>toLane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 在指定车道和位置动态加载车辆(示例：在0,1,2车道不同位置动态加载车辆)</span>
        dvp_lane0 <span class="token operator">=</span> Online<span class="token punctuation">.</span>DynaVehiParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
        dvp_lane1 <span class="token operator">=</span> Online<span class="token punctuation">.</span>DynaVehiParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
        dvp_lane2 <span class="token operator">=</span> Online<span class="token punctuation">.</span>DynaVehiParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
        dvp_lane0<span class="token punctuation">.</span>vehiTypeCode <span class="token operator">=</span> <span class="token number">1</span>
        dvp_lane1<span class="token punctuation">.</span>vehiTypeCode <span class="token operator">=</span> <span class="token number">2</span>
        dvp_lane2<span class="token punctuation">.</span>vehiTypeCode <span class="token operator">=</span> <span class="token number">3</span>
        dvp_lane0<span class="token punctuation">.</span>roadId <span class="token operator">=</span> link3<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        dvp_lane1<span class="token punctuation">.</span>roadId <span class="token operator">=</span> link3<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        dvp_lane2<span class="token punctuation">.</span>roadId <span class="token operator">=</span> link4<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        dvp_lane0<span class="token punctuation">.</span>laneNumber <span class="token operator">=</span> <span class="token number">0</span>
        dvp_lane1<span class="token punctuation">.</span>laneNumber <span class="token operator">=</span> <span class="token number">1</span>
        dvp_lane2<span class="token punctuation">.</span>laneNumber <span class="token operator">=</span> <span class="token number">2</span>
        dvp_lane0<span class="token punctuation">.</span>dist <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
        dvp_lane1<span class="token punctuation">.</span>dist <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
        dvp_lane2<span class="token punctuation">.</span>dist <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
        dvp_lane0<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">20</span>
        dvp_lane0<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">30</span>
        dvp_lane0<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">40</span>
        dvp_lane0<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;#FF0000&quot;</span>
        dvp_lane1<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;#008000&quot;</span>
        dvp_lane2<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;#0000FF&quot;</span>
        vehi_lane0 <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>createGVehicle<span class="token punctuation">(</span>dvp_lane0<span class="token punctuation">)</span>
        vehi_lane1 <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>createGVehicle<span class="token punctuation">(</span>dvp_lane1<span class="token punctuation">)</span>
        vehi_lane2 <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>createGVehicle<span class="token punctuation">(</span>dvp_lane2<span class="token punctuation">)</span>

</code></pre></div><p>3- 路径（veh path）加载：单车车辆路径（根据方式4间接实现）</p> <p>或者通过IVehicleDriving类实现</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 修改路径（L1所有车辆均修改为右转路径）</span>
<span class="token keyword">for</span> vehi <span class="token keyword">in</span> allVehiStarted_lst<span class="token punctuation">:</span>
    <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment"># 修改车辆路径</span>
        decisionPoints_lst <span class="token operator">=</span> netiface<span class="token punctuation">.</span>decisionPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
        decisionPoint_link1 <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> decisionPoint <span class="token keyword">in</span> decisionPoints_lst<span class="token punctuation">:</span>
            <span class="token keyword">if</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                decisionPoint_link1 <span class="token operator">=</span> decisionPoint
                <span class="token keyword">break</span>
        decisionPoint_link1_routings_lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> decisionPoint_link1<span class="token punctuation">:</span>
            decisionPoint_link1_routings_lst <span class="token operator">=</span> decisionPoint_link1<span class="token punctuation">.</span>routings<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>decisionPoint_link1_routings_lst<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>routing<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> decisionPoint_link1_routings_lst<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token punctuation">.</span>vehicleDriving<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setRouting<span class="token punctuation">(</span>decisionPoint_link1_routings_lst<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{}车辆修改路径成功。&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>4- flow 路径加载：发车点+静态路径</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">flow_loading</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 路径加载
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 以标准四岔路口为例 (L3-C2-L10)</span>
    link3 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    link10 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    link6 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
    link7 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
    link8 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token comment"># 新建发车点</span>
    <span class="token keyword">if</span> link3<span class="token punctuation">:</span>
        dp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDispatchPoint<span class="token punctuation">(</span>link3<span class="token punctuation">)</span>
        <span class="token keyword">if</span> dp<span class="token punctuation">:</span>
            dp<span class="token punctuation">.</span>addDispatchInterval<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1800</span><span class="token punctuation">,</span> <span class="token number">900</span><span class="token punctuation">)</span>
    <span class="token comment"># 创建决策点</span>
    decisionPoint <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDecisionPoint<span class="token punctuation">(</span>link3<span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 创建路径(左，直，右)</span>
    decisionRouting1 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>link3<span class="token punctuation">,</span> link10<span class="token punctuation">,</span> link6<span class="token punctuation">]</span><span class="token punctuation">)</span>
    decisionRouting2 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>link3<span class="token punctuation">,</span> link10<span class="token punctuation">,</span> link8<span class="token punctuation">]</span><span class="token punctuation">)</span>
    decisionRouting3 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>link3<span class="token punctuation">,</span> link10<span class="token punctuation">,</span> link7<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 分配左、直、右流量比</span>
    flowRatio_left <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flowRatio_left<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">1</span>
    flowRatio_left<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRouting1<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    flowRatio_left<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
    flowRatio_left<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
    flowRatio_left<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">2.0</span>
    flowRatio_straight <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flowRatio_straight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">2</span>
    flowRatio_straight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRouting2<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    flowRatio_straight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
    flowRatio_straight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
    flowRatio_straight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">3.0</span>
    flowRatio_right <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flowRatio_right<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">3</span>
    flowRatio_right<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRouting3<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    flowRatio_right<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
    flowRatio_right<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
    flowRatio_right<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">1.0</span>

    <span class="token comment"># 决策点数据</span>
    decisionPointData <span class="token operator">=</span> _DecisionPoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
    decisionPointData<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    decisionPointData<span class="token punctuation">.</span>deciPointName <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span>
    decisionPointPos <span class="token operator">=</span> QPointF<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getPointByDist<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decisionPointPos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        decisionPointData<span class="token punctuation">.</span>X <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span>
        decisionPointData<span class="token punctuation">.</span>Y <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span>
        decisionPointData<span class="token punctuation">.</span>Z <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>z<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 更新决策点及其各路径不同时间段流量比</span>
    updated_decision_point <span class="token operator">=</span> netiface<span class="token punctuation">.</span>updateDecipointPoint<span class="token punctuation">(</span>
        decisionPointData<span class="token punctuation">,</span> <span class="token punctuation">[</span>flowRatio_left<span class="token punctuation">,</span> flowRatio_straight<span class="token punctuation">,</span> flowRatio_right<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> updated_decision_point<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;决策点创建成功。&quot;</span><span class="token punctuation">)</span>
        <span class="token comment"># 删除右转路径</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>netiface<span class="token punctuation">.</span>removeDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> decisionRouting3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;删除右转路径成功。&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>5- 断面流量+转向比例（路径比例）加载</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">flow_loading_section</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> current_time<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 路径断面流量加载
    :param current_time: 当前仿真时间
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 读取方案数据</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./Data/flow_ratio_quarter.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json_file<span class="token punctuation">:</span>
        flow_ratio_quarter_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>json_file<span class="token punctuation">)</span>
    <span class="token keyword">for</span> linkId<span class="token punctuation">,</span> quarter_ratios <span class="token keyword">in</span> flow_ratio_quarter_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        decisionPoint <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token comment"># 查找到决策点</span>
        decisionPoints_lst <span class="token operator">=</span> netiface<span class="token punctuation">.</span>decisionPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> _decisionPoint <span class="token keyword">in</span> decisionPoints_lst<span class="token punctuation">:</span>
            <span class="token keyword">if</span> _decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>linkId<span class="token punctuation">)</span><span class="token punctuation">:</span>
                decisionPoint <span class="token operator">=</span> _decisionPoint
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> decisionPoint<span class="token punctuation">:</span>
            quarter_startTime_lst <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>quarter_ratios<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> index<span class="token punctuation">,</span> quarter_ratio <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>quarter_ratios<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                quarter_time_seconds <span class="token operator">=</span> time_to_seconds<span class="token punctuation">(</span>quarter_startTime_lst<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> index <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>quarter_startTime_lst<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    quarter_time_seconds_next <span class="token operator">=</span> time_to_seconds<span class="token punctuation">(</span>quarter_startTime_lst<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    quarter_time_seconds_next <span class="token operator">=</span> quarter_time_seconds <span class="token operator">+</span> <span class="token number">1</span>
                <span class="token keyword">if</span> quarter_time_seconds <span class="token operator">&lt;=</span> current_time <span class="token operator">&lt;</span> quarter_time_seconds_next<span class="token punctuation">:</span>
                    <span class="token comment"># 获取决策点现有路径</span>
                    decision_routings_lst <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>routings<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>decision_routings_lst<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token comment"># 分配左、直、右流量比</span>
                        flowRatio_left <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_left<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> decision_routings_lst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_left<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decision_routings_lst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_left<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
                        flowRatio_left<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
                        flowRatio_left<span class="token punctuation">.</span>ratio <span class="token operator">=</span> quarter_ratio<span class="token punctuation">[</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">]</span>
                        flowRatio_straight <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_straight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> decision_routings_lst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_straight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decision_routings_lst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_straight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
                        flowRatio_straight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
                        flowRatio_straight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> quarter_ratio<span class="token punctuation">[</span><span class="token string">&quot;straight&quot;</span><span class="token punctuation">]</span>
                        flowRatio_right <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_right<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> decision_routings_lst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_right<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decision_routings_lst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flowRatio_right<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
                        flowRatio_right<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
                        flowRatio_right<span class="token punctuation">.</span>ratio <span class="token operator">=</span> quarter_ratio<span class="token punctuation">[</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">]</span>
                        <span class="token comment"># 决策点数据</span>
                        decisionPointData <span class="token operator">=</span> _DecisionPoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decisionPointData<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decisionPointData<span class="token punctuation">.</span>deciPointName <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decisionPointPos <span class="token operator">=</span> QPointF<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getPointByDist<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decisionPointPos<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            decisionPointData<span class="token punctuation">.</span>X <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span>
                            decisionPointData<span class="token punctuation">.</span>Y <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span>
                            decisionPointData<span class="token punctuation">.</span>Z <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>z<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token comment"># 更新决策点及其各路径不同时间段流量比</span>
                        updated_decision_point <span class="token operator">=</span> netiface<span class="token punctuation">.</span>updateDecipointPoint<span class="token punctuation">(</span>
                            decisionPointData<span class="token punctuation">,</span> <span class="token punctuation">[</span>flowRatio_left<span class="token punctuation">,</span> flowRatio_straight<span class="token punctuation">,</span> flowRatio_right<span class="token punctuation">]</span>
                        <span class="token punctuation">)</span>
                        <span class="token keyword">if</span> updated_decision_point<span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{}流量更新成功。&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>quarter_startTime_lst<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;DecisionRoutingsError:决策点{}需要包含左、直、右三条路径。&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>decisionPoint<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 需路段存在决策点，才可更新，因此可用flow_loading函数新建决策点</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;FindError:ID为{}的路段不存在决策点&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>linkId<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="_4-2-路径管理"><a href="#_4-2-路径管理" class="header-anchor">#</a> 4.2.  路径管理</h3> <p>1- 新建决策点；新建决策路径，编辑决策路径流量比例，时间，路径的link,connector，删除路径。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 创建决策点</span>
decisionPoint <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createDecisionPoint<span class="token punctuation">(</span>link3<span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 创建路径(左，直，右)</span>
decisionRouting1 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>link3<span class="token punctuation">,</span> link10<span class="token punctuation">,</span> link6<span class="token punctuation">]</span><span class="token punctuation">)</span>
decisionRouting2 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>link3<span class="token punctuation">,</span> link10<span class="token punctuation">,</span> link8<span class="token punctuation">]</span><span class="token punctuation">)</span>
decisionRouting3 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>link3<span class="token punctuation">,</span> link10<span class="token punctuation">,</span> link7<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 分配左、直、右流量比</span>
flowRatio_left <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
flowRatio_left<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">1</span>
flowRatio_left<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRouting1<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
flowRatio_left<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
flowRatio_left<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
flowRatio_left<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">2.0</span>
flowRatio_straight <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
flowRatio_straight<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">2</span>
flowRatio_straight<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRouting2<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
flowRatio_straight<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
flowRatio_straight<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
flowRatio_straight<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">3.0</span>
flowRatio_right <span class="token operator">=</span> _RoutingFLowRatio<span class="token punctuation">(</span><span class="token punctuation">)</span>
flowRatio_right<span class="token punctuation">.</span>RoutingFLowRatioID <span class="token operator">=</span> <span class="token number">3</span>
flowRatio_right<span class="token punctuation">.</span>routingID <span class="token operator">=</span> decisionRouting3<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
flowRatio_right<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">0</span>
flowRatio_right<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">999999</span>
flowRatio_right<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">1.0</span>

<span class="token comment"># 决策点数据</span>
decisionPointData <span class="token operator">=</span> _DecisionPoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
decisionPointData<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
decisionPointData<span class="token punctuation">.</span>deciPointName <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span>
decisionPointPos <span class="token operator">=</span> QPointF<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getPointByDist<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decisionPointPos<span class="token punctuation">)</span><span class="token punctuation">:</span>
    decisionPointData<span class="token punctuation">.</span>X <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span>
    decisionPointData<span class="token punctuation">.</span>Y <span class="token operator">=</span> decisionPointPos<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span>
    decisionPointData<span class="token punctuation">.</span>Z <span class="token operator">=</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>z<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 更新决策点及其各路径不同时间段流量比</span>
updated_decision_point <span class="token operator">=</span> netiface<span class="token punctuation">.</span>updateDecipointPoint<span class="token punctuation">(</span>
    decisionPointData<span class="token punctuation">,</span> <span class="token punctuation">[</span>flowRatio_left<span class="token punctuation">,</span> flowRatio_straight<span class="token punctuation">,</span> flowRatio_right<span class="token punctuation">]</span>
<span class="token punctuation">)</span>



<span class="token comment"># 删除右转路径</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>netiface<span class="token punctuation">.</span>removeDeciRouting<span class="token punctuation">(</span>decisionPoint<span class="token punctuation">,</span> decisionRouting3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;删除右转路径成功。&quot;</span><span class="token punctuation">)</span>


</code></pre></div><p>2 - 运行过程中编辑决策路径的属性（流量比例，时间段信息），暂时不要求新增，删除，修改已有路径的“路径”（link,connector）</p> <p>见PyCustomerSimulator</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment"># 过载父类方法，动态修改决策点不同路径流量比</span>
    <span class="token keyword">def</span> <span class="token function">calcDynaFlowRatioParameters</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># TESSNG 顶层接口</span>
        iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 当前仿真计算批次</span>
        batchNum <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>batchNumber<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 在计算第20批次时修改某决策点各路径流量比</span>
        <span class="token keyword">if</span> batchNum <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">:</span>
            <span class="token comment"># 一个决策点某个时段各路径车辆分配比</span>
            dfi <span class="token operator">=</span> Online<span class="token punctuation">.</span>DecipointFlowRatioByInterval<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 决策点编号</span>
            dfi<span class="token punctuation">.</span>deciPointID <span class="token operator">=</span> <span class="token number">5</span>
            <span class="token comment"># 起始时间 单位秒</span>
            dfi<span class="token punctuation">.</span>startDateTime <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token comment"># 结束时间 单位秒</span>
            dfi<span class="token punctuation">.</span>endDateTime <span class="token operator">=</span> <span class="token number">84000</span>
            rfr1 <span class="token operator">=</span> Online<span class="token punctuation">.</span>RoutingFlowRatio<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            rfr2 <span class="token operator">=</span> Online<span class="token punctuation">.</span>RoutingFlowRatio<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            rfr3 <span class="token operator">=</span> Online<span class="token punctuation">.</span>RoutingFlowRatio<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            dfi<span class="token punctuation">.</span>mlRoutingFlowRatio <span class="token operator">=</span> <span class="token punctuation">[</span>rfr1<span class="token punctuation">,</span> rfr2<span class="token punctuation">,</span> rfr3<span class="token punctuation">]</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>dfi<span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><p>以上两点需求可在流量加载中找到实现方式。</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231113_114751_发车点+决策点创建+路径加载+删除路径.mp4"></video></p> <h3 id="_4-3-路径重构"><a href="#_4-3-路径重构" class="header-anchor">#</a> 4.3.  路径重构</h3> <p>1- 断面流量+转向流量重构车辆路径，并加载到仿真中;(暂时忽略)</p> <p>2- OD数据重构路径，并加载到仿真中(暂时忽略)</p> <p>用户可以利用自有算法实现OD分配、路径重构，然后依据4.1中所述的流量加载方式实现TESSNG 软件加载路径重构结果</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流量加载/20231113_145224_断面流量+转向比例加载.mp4"></video></p> <h2 id="_5-仿真运行"><a href="#_5-仿真运行" class="header-anchor">#</a> 5. 仿真运行</h2> <h3 id="_5-1-倒车入库"><a href="#_5-1-倒车入库" class="header-anchor">#</a> 5.1. 倒车入库</h3> <p>在实现自动泊车的仿真及调度时需要展示车辆倒车入库的过程，这个过程可让车辆顺向前移，将车辆旋转180度，展现的便是倒着行驶状态。</p> <p><img src="/img/%E5%9B%BE13%E8%BD%A6%E8%BE%86%E5%80%92%E8%BD%A6%E5%85%A5%E5%BA%93%E5%9C%BA%E6%99%AF.png" alt="车辆倒车入库场景"></p> <p>为了实现倒着行驶效果，可以实现PyCustomerSimulator的如下方法</p> <p>def ref_reCalcAngle(self, pIVehicle:Tessng.IVehicle, ref_outAngle:Tessng.objreal) -&gt; bool: ...</p> <h3 id="_5-2-循环仿真"><a href="#_5-2-循环仿真" class="header-anchor">#</a> 5.2. 循环仿真</h3> <p>对加载的路网启动仿真后，不需要人工干预的情况下重复仿真指定次数，且每次仿真前自动进行参数设置，仿真后输出仿真结果到文件。</p> <p>1）、仿真前判断当前仿真路网与上次仿真路网是否相同，如果不同设置仿真次数为1；</p> <p>2）、仿真结束后判断仿真次数是否小于指定次数，如果小于指定次数则发送要求仿真的消息给TESSNG主窗体，TESSNG主窗体启动仿真。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">afterStop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 这里设置要停止后仿真几次，</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>mAutoStartSimuCount <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    netface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    filePath <span class="token operator">=</span> netface<span class="token punctuation">.</span>netFilePath<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#范例打开临时路段会会创建车辆方阵，需要进行一些仿真过程控制</span>
    <span class="token keyword">if</span> <span class="token string">&quot;Temp&quot;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> filePath<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>mAutoInOutSi <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mAutoInOutSd <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mAutoStartSimuCount <span class="token operator">+=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>forReStartSimu<span class="token punctuation">.</span>emit<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="_5-3-流程控制"><a href="#_5-3-流程控制" class="header-anchor">#</a> 5.3. 流程控制</h3> <p>1-开始仿真</p> <p>2- 暂停仿真</p> <p>3- 恢复仿真</p> <p>4-结束关闭仿真</p> <p>5-生成仿真快照</p> <p>6-加载仿真快照</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">process_control</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 流程控制
          :param method_number：调用的方法序号
          :return:
          &quot;&quot;&quot;</span>
    <span class="token comment"># TESSNG 顶层接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''1. 启动、暂停、恢复、停止仿真'''</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>startSimu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> method_number <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>pauseSimu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> method_number <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>stopSimu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> method_number <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>pauseSimuOrNot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''2. 生成、加载仿真快照'''</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
        <span class="token comment"># 没生效，需分布式组件支持，暂时不清楚如何用</span>
        snapshotStr <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>catchSnapshotAsString<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>snapshotStr<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''8. 获取运动信息'''</span>
    <span class="token comment"># 8.1 获取路网在途车辆，见MySimulator中afterOneStep的simuiface.allVehiStarted()</span>
    <span class="token comment"># 8.2 根据路段|车道获取车辆list</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">8.2</span><span class="token punctuation">:</span>
        vehiOnRoad5_lst <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>vehisInLink<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        vehiOnLane20_lst <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>vehisInLane<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;L5路段车辆id：&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> vehi <span class="token keyword">in</span> vehiOnRoad5_lst<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;lane20车道车辆id：&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> vehi <span class="token keyword">in</span> vehiOnLane20_lst<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 8.3 根据车辆id获取具体的车辆信息,以id为300001的车辆为例</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">8.3</span><span class="token punctuation">:</span>
        vehi_300001 <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehicle<span class="token punctuation">(</span><span class="token number">300001</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;300001车辆的具体信息：&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;所在路段:&quot;</span><span class="token punctuation">,</span> vehi_300001<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;所在车道:&quot;</span><span class="token punctuation">,</span> vehi_300001<span class="token punctuation">.</span>lane<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前车速:&quot;</span><span class="token punctuation">,</span> vehi_300001<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前加速度:&quot;</span><span class="token punctuation">,</span> vehi_300001<span class="token punctuation">.</span>acce<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前角度:&quot;</span><span class="token punctuation">,</span> vehi_300001<span class="token punctuation">.</span>angle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前位置:&quot;</span><span class="token punctuation">,</span> vehi_300001<span class="token punctuation">.</span>pos<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;其它:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;......&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># 没看太懂</span>
    <span class="token comment"># 8.4 获取仿真模型中各种对象的信息</span>
    <span class="token comment"># 8.5 根据对象实例ID获取具体某一个对象的具体信息</span>
    <span class="token comment"># 8.6 根据车辆位置获取道路局部坐标；根据车辆车道局部坐标得到全局坐标</span>
    <span class="token comment"># 8.7 tessng平面坐标与地理坐标互转（转经纬度？，是的话暂时没有这个方法）</span>
    <span class="token comment"># 8.8 获取RSU预警信息（暂时没有）</span>
    <span class="token triple-quoted-string string">'''9. 设置随机种子'''</span>
    <span class="token comment"># 目前无法设置随机种子。</span>
    <span class="token triple-quoted-string string">'''10. 设置仿真精度'''</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>setSimuAccuracy<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''11. 设置仿真开始结束时间'''</span>
    <span class="token comment"># 可以设置仿真时长，无法设置仿真开始的时间，不过可以由定时器定时启动和结束仿真实现设置仿真开始结束时间，此处仅展示二次开发的设置仿真时长方法</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">11</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>setSimuIntervalScheming<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''12. 设置仿真加速比'''</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">:</span>
        simuiface<span class="token punctuation">.</span>setAcceMultiples<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>


</code></pre></div><p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_094245_启动-停止-暂停-恢复仿真.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_101732_查询指定车辆信息.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_115440_查询路段或车道车辆信息.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_155104_设置仿真精度.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_155826_设置仿真时长.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/流程控制/20231122_160110_设置仿真加速比.mp4"></video></p> <h3 id="_5-4-动作控制"><a href="#_5-4-动作控制" class="header-anchor">#</a> 5.4.  动作控制</h3> <p>运行过程中的操作：</p> <p>1- 修改发车流量信息，删除发车点</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_113447_动态发车流量编辑.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_114107_动态删除发车点.mp4"></video></p> <p>2- 修改限速区，事故区信息；删除减速区，限速区，事故区</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_130300_减速区.mp4"></video></p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_141714_施工区.mp4"></video></p> <p>3-车辆位置移动</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231114_133231_移动车辆.mp4"></video></p> <p>4-修改车辆速度</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231207_131017_车辆速度设置测试.mp4"></video></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">ref_reSetSpeed</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vehi<span class="token punctuation">,</span> ref_inOutSpeed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试让L12等待的车辆强制闯红灯</span>
    <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">:</span>
        vehi_currentSpeed <span class="token operator">=</span> vehi<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span>
        vehi_currentDistToEnd <span class="token operator">=</span> vehi<span class="token punctuation">.</span>vehicleDriving<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distToEndpoint<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> m2p<span class="token punctuation">(</span>vehi_currentSpeed<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token keyword">and</span> p2m<span class="token punctuation">(</span>vehi_currentDistToEnd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            random_number <span class="token operator">=</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> random_number <span class="token operator">&lt;</span> <span class="token number">0.3</span><span class="token punctuation">:</span>
                ref_inOutSpeed<span class="token punctuation">.</span>value <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vehi<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token comment"># 强制L5路段车辆在距路段终点50m处停车</span>
    vehi_currentDistToEnd <span class="token operator">=</span> vehi<span class="token punctuation">.</span>vehicleDriving<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distToEndpoint<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> p2m<span class="token punctuation">(</span>vehi_currentDistToEnd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
            ref_inOutSpeed<span class="token punctuation">.</span>value <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

</code></pre></div><p>5-修改车辆路径（nextroad, 甚至nextlane）</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/20231207_133054_修改车辆路径测试.mp4"></video></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 修改路径（L1所有车辆均修改为右转路径）</span>
<span class="token keyword">for</span> vehi <span class="token keyword">in</span> allVehiStarted_lst<span class="token punctuation">:</span>
    <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment"># 修改车辆路径</span>
        decisionPoints_lst <span class="token operator">=</span> netiface<span class="token punctuation">.</span>decisionPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
        decisionPoint_link1 <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> decisionPoint <span class="token keyword">in</span> decisionPoints_lst<span class="token punctuation">:</span>
            <span class="token keyword">if</span> decisionPoint<span class="token punctuation">.</span>link<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                decisionPoint_link1 <span class="token operator">=</span> decisionPoint
                <span class="token keyword">break</span>
        decisionPoint_link1_routings_lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> decisionPoint_link1<span class="token punctuation">:</span>
            decisionPoint_link1_routings_lst <span class="token operator">=</span> decisionPoint_link1<span class="token punctuation">.</span>routings<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>decisionPoint_link1_routings_lst<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>routing<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> decisionPoint_link1_routings_lst<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>vehi<span class="token punctuation">.</span>vehicleDriving<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setRouting<span class="token punctuation">(</span>decisionPoint_link1_routings_lst<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{}车辆修改路径成功。&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>6-强制车辆不变道</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/20231207_151904_强制车辆不变道测试.mp4"></video></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 撤销变道，可用于强制车辆不变道</span>
<span class="token keyword">def</span> <span class="token function">reCalcDismissChangeLane</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vehi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 禁止车辆变道到最右侧车道</span>
    lane <span class="token operator">=</span> vehi<span class="token punctuation">.</span>lane<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> lane<span class="token punctuation">.</span>number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>secondary_dev<span class="token punctuation">.</span>judge_vehicle_laneChange_direction<span class="token punctuation">(</span>vehi<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;right&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

</code></pre></div><p>7-强制车辆变道</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/20231207_180602_强制车辆变道测试.mp4"></video></p> <div class="language-python extra-class"><pre class="language-python"><code>	<span class="token keyword">def</span> <span class="token function">reCalcToLeftFreely</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pIVehicle<span class="token punctuation">:</span>Tessng<span class="token punctuation">.</span>IVehicle<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    	<span class="token keyword">return</span> <span class="token boolean">True</span>
</code></pre></div><p>8-强制车辆闯红灯</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231208_092546_强制车辆闯红灯测试.mp4"></video></p> <p>9-强制车辆停车</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_153837_强制车辆停车.mp4"></video></p> <p>10-强制清除车辆（车辆消失）</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_155811_强制清除车辆.mp4"></video></p> <p>11-修改车辆航向角</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_160304_修改航向角.mp4"></video></p> <p>12-修改车辆速度，加速度</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">ref_reSetSpeed</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vehi<span class="token punctuation">,</span> ref_inOutSpeed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试让L12等待的车辆强制闯红灯</span>
    <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">:</span>
        vehi_currentSpeed <span class="token operator">=</span> vehi<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span>
        vehi_currentDistToEnd <span class="token operator">=</span> vehi<span class="token punctuation">.</span>vehicleDriving<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distToEndpoint<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> m2p<span class="token punctuation">(</span>vehi_currentSpeed<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token keyword">and</span> p2m<span class="token punctuation">(</span>vehi_currentDistToEnd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            random_number <span class="token operator">=</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> random_number <span class="token operator">&lt;</span> <span class="token number">0.3</span><span class="token punctuation">:</span>
                ref_inOutSpeed<span class="token punctuation">.</span>value <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vehi<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token comment"># 强制L5路段车辆在距路段终点50m处停车</span>
    vehi_currentDistToEnd <span class="token operator">=</span> vehi<span class="token punctuation">.</span>vehicleDriving<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distToEndpoint<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> p2m<span class="token punctuation">(</span>vehi_currentDistToEnd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>roadId<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
            ref_inOutSpeed<span class="token punctuation">.</span>value <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

 <span class="token keyword">def</span> <span class="token function">ref_reSetAcce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vehi<span class="token punctuation">,</span> inOutAcce<span class="token punctuation">)</span><span class="token punctuation">:</span>
    roadName <span class="token operator">=</span> vehi<span class="token punctuation">.</span>roadName<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> roadName <span class="token operator">==</span> <span class="token string">&quot;连接段1&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> vehi<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> m2p<span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">/</span> <span class="token number">3.6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            inOutAcce<span class="token punctuation">.</span>value <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">elif</span> vehi<span class="token punctuation">.</span>currSpeed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> m2p<span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">/</span> <span class="token number">3.6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            inOutAcce<span class="token punctuation">.</span>value <span class="token operator">=</span> m2p<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

</code></pre></div><p>13- 车道关闭，恢复</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/动作控制/20231117_161500_车道封闭和恢复.mp4"></video></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">action_control</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 动作控制
    :param current_time: 当前仿真时间
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 以动作控制案例-机动车交叉口路网的L5路段为例</span>
    <span class="token triple-quoted-string string">'''1. 修改发车流量信息，删除发车点'''</span>
    <span class="token comment"># 修改发车流量信息需在MySimulator中的calcDynaDispatchParameters函数,删除发车点位于afterOneStep函数中</span>
    <span class="token triple-quoted-string string">'''2. 修改决策路径的属性，删除决策路径'''</span>
    <span class="token comment"># 见路径加载/路径管理模块</span>
    <span class="token triple-quoted-string string">'''3. 修改减速区，施工区，事故区信息；删除减速区，施工区，事故区'''</span>
    <span class="token comment"># 减速区见MySimulator中的ref_reCalcdesirSpeed函数，可由这种方式实现，无减速区类</span>
    <span class="token comment"># 施工区和事故区仅有创建和删除，无法进行修改，以施工区为例</span>
    <span class="token triple-quoted-string string">'''4. 车辆位置移动'''</span>
    <span class="token comment"># 见afterOneStep函数</span>
    <span class="token triple-quoted-string string">'''5. 修改车辆速度'''</span>
    <span class="token comment"># 同3减速区</span>
    <span class="token triple-quoted-string string">'''6. 修改车辆路径,next_lane暂时需要具体策略去做'''</span>
    <span class="token comment"># 以L1路段上的路径为例，见afterOneStep</span>
    <span class="token triple-quoted-string string">'''7. 强制车辆不变道'''</span>
    <span class="token comment"># 已经可以了</span>
    <span class="token triple-quoted-string string">'''8. 强制车辆变道'''</span>
    <span class="token comment"># MySimulator中的reCalcToLeftFreely和reCalcToRightFreely,return true即可，但是变道后仍有可能会变回来</span>
    <span class="token triple-quoted-string string">'''9. 强制车辆闯红灯'''</span>
    <span class="token comment"># 见MySimulator的ref_reSetSpeed函数</span>
    <span class="token triple-quoted-string string">'''10. 强制车辆停车'''</span>
    <span class="token comment"># 见MySimulator的ref_reSetSpeed函数</span>
    <span class="token triple-quoted-string string">'''11. 强制车辆跟车'''</span>
    <span class="token comment"># pass</span>
    <span class="token triple-quoted-string string">'''12. 强制清除车辆（车辆消失）'''</span>
    <span class="token comment"># 以L5路段上的路径为例，见afterStep</span>
    <span class="token triple-quoted-string string">'''13. 修改车辆航向角'''</span>
    <span class="token comment"># 以L5路段上的路径为例，见afterStep</span>
    <span class="token triple-quoted-string string">'''14. 修改车辆速度，加速度'''</span>
    <span class="token comment"># 同5，修改加速度函数为MySimulator的ref_reSetAcce，用法与设置速度相同</span>
    <span class="token triple-quoted-string string">'''15. 车道关闭，恢复'''</span>
    <span class="token comment"># 几种方法都可以实现：1.设置事件区。2.MySimulator中的自由变道，以L5路段50-100m处最右侧封闭30秒为例</span>


<span class="token keyword">def</span> <span class="token function">createworkZone</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 创建施工区
    :param :
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 创建施工区</span>
    workZone <span class="token operator">=</span> Online<span class="token punctuation">.</span>DynaRoadWorkZoneParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 道路ID</span>
    workZone<span class="token punctuation">.</span>roadId <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token comment"># 施工区名称</span>
    workZone<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;施工区，限速40,持续20秒&quot;</span>
    <span class="token comment"># 位置，距离路段或连接段起点距离，单位米</span>
    workZone<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token number">50</span>
    <span class="token comment"># 施工区长度，单位米</span>
    workZone<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">50</span>
    <span class="token comment"># 车辆经过施工区的最大车速，单位千米/小时</span>
    workZone<span class="token punctuation">.</span>limitSpeed <span class="token operator">=</span> <span class="token number">40</span>
    <span class="token comment"># 施工区施工时长，单位秒</span>
    workZone<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">20</span>
    <span class="token comment"># 施工区起始车道</span>
    workZone<span class="token punctuation">.</span>mlFromLaneNumber <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 创建施工区</span>
    zone <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createRoadWorkZone<span class="token punctuation">(</span>workZone<span class="token punctuation">)</span>

</code></pre></div><h3 id="_5-5-管控手段控制"><a href="#_5-5-管控手段控制" class="header-anchor">#</a> 5.5. 管控手段控制</h3> <p>1- 修改信号灯灯色（直接修改某个直行方向的信号灯颜色，如红色直接切换为绿色）</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/管控手段控制/20231120_150706_L12直行灯第10s强制修改为绿色持续50s.mp4"></video></p> <p>2- 修改信号灯组方案</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">double_ring_signal_control</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> current_simuTime<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; 双环信控方案下发
        :param current_simuTime: 当前仿真时间
        :return:
        &quot;&quot;&quot;</span>

        <span class="token comment"># 代表TESS NG的接口</span>
        iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 代表TESS NG的路网子接口</span>
        netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 读取方案数据</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./Data/Signal_Plan_Data_1109.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json_file<span class="token punctuation">:</span>
            signal_groups_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>json_file<span class="token punctuation">)</span>

        <span class="token comment"># 创建信号灯组和相位</span>
        <span class="token keyword">for</span> group_name<span class="token punctuation">,</span> group <span class="token keyword">in</span> signal_groups_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 当前灯组</span>
            current_signal_group <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token comment"># 通过灯组名称查询到灯组</span>
            all_signal_groups_lst <span class="token operator">=</span> netiface<span class="token punctuation">.</span>signalGroups<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> signal_group <span class="token keyword">in</span> all_signal_groups_lst<span class="token punctuation">:</span>
                <span class="token keyword">if</span> signal_group<span class="token punctuation">.</span>groupName<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> group_name<span class="token punctuation">:</span>
                    current_signal_group <span class="token operator">=</span> signal_group
                    <span class="token keyword">break</span>
            <span class="token keyword">if</span> current_signal_group<span class="token punctuation">:</span>
                current_signal_group_phases_lst <span class="token operator">=</span> current_signal_group<span class="token punctuation">.</span>phases<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;FindError: The signalGroup not in current net.&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

            <span class="token comment"># 获取所有灯组的起始时间</span>
            signal_group_startTime_lst <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> index<span class="token punctuation">,</span> group_data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                start_time <span class="token operator">=</span> signal_group_startTime_lst<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
                end_time <span class="token operator">=</span> signal_group_startTime_lst<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> index <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>
                    signal_group_startTime_lst<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">&quot;24:00&quot;</span>
                <span class="token comment"># 起始时间和结束时间的秒数表示</span>
                start_time_seconds <span class="token operator">=</span> time_to_seconds<span class="token punctuation">(</span>start_time<span class="token punctuation">)</span>
                end_time_seconds <span class="token operator">=</span> time_to_seconds<span class="token punctuation">(</span>end_time<span class="token punctuation">)</span>
                <span class="token comment"># 若当前仿真时间位于当前时段内，修改当前时段信号灯组的相位</span>
                <span class="token keyword">if</span> start_time_seconds <span class="token operator">&lt;=</span> current_simuTime <span class="token operator">&lt;</span> end_time_seconds<span class="token punctuation">:</span>
                    period_time <span class="token operator">=</span> group_data<span class="token punctuation">[</span><span class="token string">'cycle_time'</span><span class="token punctuation">]</span>
                    phases <span class="token operator">=</span> group_data<span class="token punctuation">[</span><span class="token string">'phases'</span><span class="token punctuation">]</span>
                    <span class="token comment"># 修改周期</span>
                    current_signal_group<span class="token punctuation">.</span>setPeriodTime<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>period_time<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> phase <span class="token keyword">in</span> phases<span class="token punctuation">:</span>
                        phase_name <span class="token operator">=</span> phase<span class="token punctuation">[</span><span class="token string">'phase_name'</span><span class="token punctuation">]</span>
                        phase_number <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>phase<span class="token punctuation">[</span><span class="token string">'phase_number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        color_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 按照红灯、绿灯、黄灯、红灯顺序计算</span>
                        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'红'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>phase<span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'绿'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>phase<span class="token punctuation">[</span><span class="token string">'green_time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'黄'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>period_time <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'green_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                                Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'红'</span><span class="token punctuation">,</span>
                                                     <span class="token builtin">int</span><span class="token punctuation">(</span>period_time <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'start_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> phase<span class="token punctuation">[</span><span class="token string">'green_time'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                        <span class="token comment"># 当前灯组包含的相位序号</span>
                        current_phase <span class="token operator">=</span> <span class="token boolean">None</span>
                        <span class="token keyword">for</span> current_signal_group_phase <span class="token keyword">in</span> current_signal_group_phases_lst<span class="token punctuation">:</span>
                            <span class="token keyword">if</span> phase_number <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>current_signal_group_phase<span class="token punctuation">.</span>number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                                current_phase <span class="token operator">=</span> current_signal_group_phase
                                <span class="token keyword">break</span>

                        <span class="token comment"># 若已存在该相位，修改相位灯色顺序，否则添加相位</span>
                        <span class="token keyword">if</span> current_phase<span class="token punctuation">:</span>
                            <span class="token comment"># 修改相位</span>
                            current_phase<span class="token punctuation">.</span>setColorList<span class="token punctuation">(</span>color_list<span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            signal_phase <span class="token operator">=</span> netiface<span class="token punctuation">.</span>createSignalPhase<span class="token punctuation">(</span>current_signal_group<span class="token punctuation">,</span> phase_name<span class="token punctuation">,</span> color_list<span class="token punctuation">)</span>
                            <span class="token comment"># 设置相位序号</span>
                            signal_phase<span class="token punctuation">.</span>setNumber<span class="token punctuation">(</span>phase_number<span class="token punctuation">)</span>
                        <span class="token comment"># 设置相位包含的信号灯</span>
                        <span class="token keyword">for</span> lampId <span class="token keyword">in</span> phase<span class="token punctuation">[</span><span class="token string">&quot;lamp_lst&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            lamp <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findSignalLamp<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>lampId<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token keyword">if</span> lamp<span class="token punctuation">:</span>
                                <span class="token string">''</span>'
                                目前一个信号灯属于多个相位，相位间不交叉。因此如果要实际下发方案时，应按照仿真时间实时管理相位序号。

</code></pre></div><p>3- 修改相位绿灯时间长度</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/管控手段控制/20231120_153332_修改相位红绿灯持续时间_L12直行红绿灯由红90绿32黄3红25改为红10绿110黄3红28.mp4"></video></p> <p>4- 修改限速区，施工区，事故区</p> <p>目前无修改方法,只能删除后新增</p> <p>5- 修改link, connector 限速</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/管控手段控制/20231120_160424_L5路段最高限速由80修改至20.mp4"></video></p> <p>6- 修改link, connector 允许的车辆类型（暂时无法实现）</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">control_Measures</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 管控手段控制
    :param method_number:调用的方法序号
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># TESSNG 顶层接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''1. 修改信号灯灯色'''</span>
    <span class="token comment"># 见MySimulator的afterOneStep函数，L5路段信号灯第10秒红灯变绿灯，持续20秒。</span>
    <span class="token triple-quoted-string string">'''2. 修改信号灯组方案'''</span>
    <span class="token comment"># 见双环管控方案下发，目前仅可用该方法修改。</span>
    <span class="token triple-quoted-string string">'''3. 修改相位绿灯时间长度'''</span>
    <span class="token comment"># 除双环管控方案下所包含方法外，还有相位类自带的修改方法,以L12路段相位直行信号灯相位为例（ID为7），由红90绿32黄3红25改为红10绿110黄3红28</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        signalPhase_L12_7 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findSignalPhase<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
        color_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 按照红灯、绿灯、黄灯、红灯顺序计算</span>
        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'红'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'绿'</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'黄'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        color_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Online<span class="token punctuation">.</span>ColorInterval<span class="token punctuation">(</span><span class="token string">'红'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        signalPhase_L12_7<span class="token punctuation">.</span>setColorList<span class="token punctuation">(</span>color_list<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''4. 修改减速区，施工区，事故区'''</span>
    <span class="token comment"># 目前二次开发，施工区/事故区无修改方法，且经测试，施工区的“获取施工区所在的车道列表”方法暂时无效。</span>
    <span class="token triple-quoted-string string">'''5. 修改link, connector 限速'''</span>
    <span class="token comment"># 以L5路段最高限速由80调整至20，连接段无法修改限速。</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
        link5 <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        link5<span class="token punctuation">.</span>setLimitSpeed<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''6. 修改link, connector 允许的车辆类型'''</span>
    <span class="token comment"># 修改后，发车点发出的车仍会按照类型发出，被禁止的车辆类型仍会驶入。</span>
    <span class="token keyword">if</span> method_number <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre></div><h2 id="_6-底层模型修改"><a href="#_6-底层模型修改" class="header-anchor">#</a> 6. 底层模型修改</h2> <h3 id="_6-1-跟驰模型"><a href="#_6-1-跟驰模型" class="header-anchor">#</a> 6.1 跟驰模型</h3> <p>1-修改跟驰模型参数（机动车，非机动车）</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/跟驰模型参数修改/20231120_144406_跟驰模型参数修改.mp4"></video></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">reSetFollowingParams</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 重设跟驰模型参数
    :return: 返回 'Tessng.Online.FollowingModelParam' 的列表
    &quot;&quot;&quot;</span>
    <span class="token comment"># 机动车</span>
    followingModelParam_motor <span class="token operator">=</span> Online<span class="token punctuation">.</span>FollowingModelParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
    followingModelParam_motor<span class="token punctuation">.</span>vtype <span class="token operator">=</span> Online<span class="token punctuation">.</span>Motor
    followingModelParam_motor<span class="token punctuation">.</span>alfa <span class="token operator">=</span> <span class="token number">5</span>
    followingModelParam_motor<span class="token punctuation">.</span>beit <span class="token operator">=</span> <span class="token number">3</span>
    followingModelParam_motor<span class="token punctuation">.</span>safeDistance <span class="token operator">=</span> <span class="token number">15</span>
    followingModelParam_motor<span class="token punctuation">.</span>safeInterval <span class="token operator">=</span> <span class="token number">10</span>

    <span class="token comment"># 非机动车</span>
    followingModelParam_Nonmotor <span class="token operator">=</span> Online<span class="token punctuation">.</span>FollowingModelParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
    followingModelParam_Nonmotor<span class="token punctuation">.</span>vtype <span class="token operator">=</span> Online<span class="token punctuation">.</span>Nonmotor
    followingModelParam_Nonmotor<span class="token punctuation">.</span>alfa <span class="token operator">=</span> <span class="token number">3</span>
    followingModelParam_Nonmotor<span class="token punctuation">.</span>beit <span class="token operator">=</span> <span class="token number">1</span>
    followingModelParam_Nonmotor<span class="token punctuation">.</span>safeDistance <span class="token operator">=</span> <span class="token number">5</span>
    followingModelParam_Nonmotor<span class="token punctuation">.</span>safeInterval <span class="token operator">=</span> <span class="token number">6</span>

    followingModelParam_lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    followingModelParam_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>followingModelParam_motor<span class="token punctuation">)</span>
    followingModelParam_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>followingModelParam_Nonmotor<span class="token punctuation">)</span>

    <span class="token keyword">return</span> followingModelParam_lst
</code></pre></div><p>默认参数效果</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/换道模型/20231120_181258_无修改版本.mp4"></video></p> <p>修改参数使车辆倾向变道</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/换道模型/20231120_182330_修改_倾向变道.mp4"></video></p> <p>修改参数使车辆不倾向变道</p> <p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/换道模型/20231120_182702_修改_不倾向变道.mp4"></video></p> <h3 id="_6-2-换道模型"><a href="#_6-2-换道模型" class="header-anchor">#</a> 6.2. 换道模型</h3> <p>1-选择变道类型：强制变道，压迫变道，自由变道</p> <p>暂不支持二次开发接口选择变道类型</p> <p>2- 设置强制变道，压迫变道参数(暂不支持，仅支持自有变道参数修改)</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">lane_changing_model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 换道模型
    :param method_number：调用的方法序号
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># TESSNG 顶层接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''1. 选择变道类型：强制变道，压迫变道，自由变道'''</span>
    <span class="token triple-quoted-string string">'''2. 设置强制变道，压迫变道参数'''</span>
    <span class="token comment"># 目前仅有MySimulator中的ref_reSetChangeLaneFreelyParam函数设置安全操作时间、安全变道(完成变道前半段)后距前车距离、目标车道后车影响系数</span>
    <span class="token comment"># 以L5路段两侧车道往中间变道为例</span>

    

<span class="token keyword">def</span> <span class="token function">judge_vehicle_laneChange_direction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vehi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    判断车辆是左变道还是右变道。
    :param vehi: 运行车辆
    :return:
    '''</span>
    lane <span class="token operator">=</span> vehi<span class="token punctuation">.</span>lane<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vehi_currPos <span class="token operator">=</span> vehi<span class="token punctuation">.</span>pos<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vehi_currDistToStart <span class="token operator">=</span> lane<span class="token punctuation">.</span>distToStartPoint<span class="token punctuation">(</span>vehi_currPos<span class="token punctuation">)</span>
    lane_centerBreakPoints <span class="token operator">=</span> lane<span class="token punctuation">.</span>centerBreakPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vehi_segmentIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment"># 获取车辆所在的道路分段号</span>
    <span class="token keyword">for</span> index<span class="token punctuation">,</span> centerBreakPoint <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lane_centerBreakPoints<span class="token punctuation">)</span><span class="token punctuation">:</span>
        lane_centerBreakPoints_distToStart <span class="token operator">=</span> lane<span class="token punctuation">.</span>distToStartPoint<span class="token punctuation">(</span>centerBreakPoint<span class="token punctuation">)</span>
        <span class="token keyword">if</span> vehi_currDistToStart <span class="token operator">&lt;</span> lane_centerBreakPoints_distToStart<span class="token punctuation">:</span>
            vehi_segmentIndex <span class="token operator">=</span> index
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;</span> vehi_segmentIndex <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lane_centerBreakPoints<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_breakPoint <span class="token operator">=</span> lane_centerBreakPoints<span class="token punctuation">[</span>vehi_segmentIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
        end_breakPoint <span class="token operator">=</span> lane_centerBreakPoints<span class="token punctuation">[</span>vehi_segmentIndex<span class="token punctuation">]</span>
        <span class="token comment"># 以点积判断车辆处于中心线左侧还是右侧</span>
        vehi_direction <span class="token operator">=</span> car_position_road<span class="token punctuation">(</span>start_breakPoint<span class="token punctuation">,</span> end_breakPoint<span class="token punctuation">,</span> vehi_currPos<span class="token punctuation">)</span>
        <span class="token comment"># 判断车头角度偏度</span>
        breakLane_angle <span class="token operator">=</span> calculate_angle<span class="token punctuation">(</span>start_breakPoint<span class="token punctuation">,</span> end_breakPoint<span class="token punctuation">)</span>
        <span class="token comment"># 若车辆处于中心线右侧且车头右偏，则判定为右变道意图</span>
        <span class="token keyword">if</span> vehi_direction <span class="token operator">==</span> <span class="token string">&quot;right&quot;</span> <span class="token keyword">and</span> vehi<span class="token punctuation">.</span>angle<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> breakLane_angle<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;right:&quot;</span><span class="token punctuation">,</span> vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vehi<span class="token punctuation">.</span>angle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breakLane_angle<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">&quot;right&quot;</span>
        <span class="token comment"># 若车辆处于中心线左侧且车头左偏，则判定为左变道意图</span>
        <span class="token keyword">elif</span> vehi_direction <span class="token operator">==</span> <span class="token string">&quot;left&quot;</span> <span class="token keyword">and</span> vehi<span class="token punctuation">.</span>angle<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> breakLane_angle<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;left:&quot;</span><span class="token punctuation">,</span> vehi<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vehi<span class="token punctuation">.</span>angle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breakLane_angle<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">&quot;left&quot;</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;noChange&quot;</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;FindError:can't find the segment,relevant info:&quot;</span><span class="token punctuation">,</span> vehi_segmentIndex<span class="token punctuation">,</span> vehi_currDistToStart<span class="token punctuation">,</span>
              vehi_currPos<span class="token punctuation">)</span>
</code></pre></div><p><video width="100%" controls="controls" src="https://www.jidatraffic.com/newWebsite/video/20231213_162031_修改自由变道参数测试.mp4"></video></p> <h3 id="_6-3-冲突交互模型"><a href="#_6-3-冲突交互模型" class="header-anchor">#</a> 6.3. 冲突交互模型</h3> <p>1-根据link,车道序号|连接器编号获取冲突连接器对的优先关系</p> <p>2-修改连接器对的优先关系</p> <p>3- 修改连接器对的冲突模型参数</p> <p>4- 新增，修改，删除冲突模型参数</p> <p>5-获取所有冲突关系的冲突连接器对</p> <p>6- 一键设置同等路权的工具函数</p> <p>7- 重置优先关系</p> <p>8- 获取面域与连接器的映射关系</p> <p><strong>目前版本暂不支持二次开发方式操作以上参数， 用户只能在建模阶段人工设置</strong></p> <h3 id="_6-4-车辆汇入模型"><a href="#_6-4-车辆汇入模型" class="header-anchor">#</a> 6.4.  车辆汇入模型</h3> <p>暂不支持二次开发操作，用户可根据跟车模型，自由换道模型调整车辆运动行为</p> <h3 id="_6-5-车辆穿越模型"><a href="#_6-5-车辆穿越模型" class="header-anchor">#</a> 6.5. 车辆穿越模型</h3> <p>暂不支持二次开发操作，用户可根据跟车模型，自由换道模型，冲突交互模型调整车辆运动行为</p> <h2 id="_7-仿真输出"><a href="#_7-仿真输出" class="header-anchor">#</a> 7. 仿真输出</h2> <h3 id="_7-1-获取路网几何线性数据"><a href="#_7-1-获取路网几何线性数据" class="header-anchor">#</a> 7.1. 获取路网几何线性数据</h3> <p>路网二维平面主要由路段连接段组成，路段由路段自身和车道组成，连接段由连接段自身和“车道连接”组成，路段、车道、“车道连接”都存在中心线断点序列，车辆都是在这些点构成的线上移动的。取得这些断点序列的步骤如下：</p> <p>1）获取所有路段；</p> <p>2）获取路段的所有车道；</p> <p>3）获取车道的中心线断点序列</p> <p>4）获取所有连接段</p> <p>5）获取连接段的所有“车道连接”</p> <p>6）获取“车道连接”中心线断点序列</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">afterLoadNet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 代表TESS NG的接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 代表TESS NG的路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取路段数</span>
    count <span class="token operator">=</span> netiface<span class="token punctuation">.</span>linkCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if (count == 0):</span>
    <span class="token comment">#     self.createNet()</span>

    <span class="token triple-quoted-string string">'''调用相应二次开发案例函数'''</span>
    <span class="token comment"># 信控编辑案例 （默认路网）</span>
    <span class="token comment"># self.secondary_dev.edit_signal_controller()</span>
    <span class="token comment"># 双环信控方案下发单次测试（输入测试仿真时间）</span>
    <span class="token comment"># self.secondary_dev.double_ring_signal_control(27000)</span>
    <span class="token comment"># 流量加载</span>
    <span class="token comment"># self.secondary_dev.traffic_loading()</span>
    <span class="token comment"># 路径加载</span>
    <span class="token comment"># self.secondary_dev.flow_loading()</span>
    <span class="token comment"># 动作控制</span>
    <span class="token comment"># self.secondary_dev.action_control()</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>netiface<span class="token punctuation">.</span>linkCount<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#所有路段</span>
        lLink <span class="token operator">=</span> netiface<span class="token punctuation">.</span>links<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#ID等于1的路段</span>
        link <span class="token operator">=</span> netiface<span class="token punctuation">.</span>findLink<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> link <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment">#路段中心线断点集</span>
            lPoint <span class="token operator">=</span> link<span class="token punctuation">.</span>centerBreakPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># print(&quot;一条路段中心线断点：&quot;, [(p.x(), p.y()) for p in lPoint])</span>
            lLane <span class="token operator">=</span> link<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> lLane <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lLane<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token comment">#第一条车道中心线断点</span>
                lPoint <span class="token operator">=</span> lLane<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>centerBreakPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># print(&quot;一条车道中心线断点：&quot;, [(p.x(), p.y()) for p in lPoint])</span>
        <span class="token comment">#所有连接段</span>
        lConnector <span class="token operator">=</span> netiface<span class="token punctuation">.</span>connectors<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> lConnector <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lConnector<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment">#第一条连接段的所有“车道连接”</span>
            lLaneConnector <span class="token operator">=</span> lConnector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>laneConnectors<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">#其中第一条“车道连接”</span>
            laneConnector <span class="token operator">=</span> lLaneConnector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment">#&quot;车道连接“断点集</span>
            lPoint <span class="token operator">=</span> laneConnector<span class="token punctuation">.</span>centerBreakPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># print(&quot;一条'车道连接'中心线断点：&quot;, [(p.x(), p.y()) for p in lPoint])</span>
</code></pre></div><h3 id="_7-2-检测器-采集器-排队计数器编辑"><a href="#_7-2-检测器-采集器-排队计数器编辑" class="header-anchor">#</a> 7.2. 检测器|采集器|排队计数器编辑</h3> <p>1-根据车道序号，位置新建排队计数器</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 在路段9最左侧车道100米处创建排队计数器</span>
counter <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createVehiQueueCounterOnLink<span class="token punctuation">(</span>leftLane<span class="token punctuation">,</span> dist<span class="token punctuation">)</span>
<span class="token keyword">if</span> counter <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;计数器所在点坐标为: (</span><span class="token interpolation"><span class="token punctuation">{</span>counter<span class="token punctuation">.</span>point<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>counter<span class="token punctuation">.</span>point<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>2-根据车道序号，位置新建行程时间检测器</p> <div class="language-python extra-class"><pre class="language-python"><code>lVehicleTravelDetector <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createVehicleTravelDetector_link2link<span class="token punctuation">(</span>link<span class="token punctuation">,</span> link<span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>m2p<span class="token punctuation">(</span><span class="token number">550</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span> lVehicleTravelDetector <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
      <span class="token keyword">for</span> detector <span class="token keyword">in</span> lVehicleTravelDetector<span class="token punctuation">:</span>
          detector<span class="token punctuation">.</span>setFromTime<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
          detector<span class="token punctuation">.</span>setToTime<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

</code></pre></div><p>3-根据路段，车道序号获取检测器</p> <p>4- 根据检测器获取车道</p> <p>5-设置检测器属性，如检测开始结束时间，检测间隔</p> <div class="language-python extra-class"><pre class="language-python"><code>lVehicleTravelDetector <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createVehicleTravelDetector_link2link<span class="token punctuation">(</span>link<span class="token punctuation">,</span> link<span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>m2p<span class="token punctuation">(</span><span class="token number">550</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span> lVehicleTravelDetector <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
      <span class="token keyword">for</span> detector <span class="token keyword">in</span> lVehicleTravelDetector<span class="token punctuation">:</span>
          detector<span class="token punctuation">.</span>setFromTime<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
          detector<span class="token punctuation">.</span>setToTime<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
</code></pre></div><p>详见: <a href="/vuepress/document/V3.x/Python3/details.html#_2-18-IVehicleDrivInfoCollector">接口详解-IVehicleDrivInfoCollector</a>、<a href="/vuepress/document/V3.x/Python3/details.html#_2-19-IVehicleQueueCounter">接口详解-IVehicleQueueCounter</a>、<a href="/vuepress/document/V3.x/Python3/details.html#_2-20-IVehicleTravelDetector">接口详解-IVehicleTravelDetector</a></p> <h3 id="_7-3-输出控制"><a href="#_7-3-输出控制" class="header-anchor">#</a> 7.3. 输出控制</h3> <p>1- 设置仿真过程中输出</p> <div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">afterOneStep</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># = == == == == == =以下是获取一些仿真过程数据的方法 == == == == == ==</span>
    <span class="token comment"># TESSNG 顶层接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 当前仿真计算批次</span>
    batchNum <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>batchNumber<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 当前已仿真时间，单位：毫秒</span>
    simuTime <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>simuTimeIntervalWithAcceMutiples<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 当前正在运行车辆列表</span>
    lAllVehi <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>allVehiStarted<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取最近集计时间段内排队计数器集计数据</span>
    lVehiQueueAggr <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisQueueAggregated<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lVehiQueueAggr<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> simuTime <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">300</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>simuTime<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lVehiQueueAggrInterval<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>simuTime <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">300</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> vqAggr <span class="token keyword">in</span> lVehiQueueAggr<span class="token punctuation">:</span>
            vehiCounterId <span class="token operator">=</span> vqAggr<span class="token punctuation">.</span>counterId
            <span class="token comment"># 定位到示例路段上的排队计数器</span>
            <span class="token keyword">if</span> vehiCounterId <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">4501</span><span class="token punctuation">,</span> <span class="token number">4502</span><span class="token punctuation">,</span> <span class="token number">4503</span><span class="token punctuation">,</span> <span class="token number">4504</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> vehiCounterId <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>VehiQueueAggregationDict<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>VehiQueueAggregationDict<span class="token punctuation">[</span>vehiCounterId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                self<span class="token punctuation">.</span>VehiQueueAggregationDict<span class="token punctuation">[</span>vehiCounterId<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>vqAggr<span class="token punctuation">.</span>avgQueueLength<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;车辆排队集计数据：&quot;</span><span class="token punctuation">,</span> vqAggr<span class="token punctuation">.</span>counterId<span class="token punctuation">,</span> vqAggr<span class="token punctuation">.</span>avgQueueLength<span class="token punctuation">,</span> vqAggr<span class="token punctuation">.</span>maxQueueLength<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>vehiQueueAggregateFlag <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre></div><p>2- 设置仿真结束后输出</p> <p>3- 设置轨迹输出频率，仿真过程中输出还是仿真结束后输出；输出的路径和名称</p> <p>4- 输出结构化路网</p> <p>5- 输出连接器和车道的路网的映射关系</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">afterOneStep</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># = == == == == == =以下是获取一些仿真过程数据的方法 == == == == == ==</span>
    <span class="token comment"># TESSNG 顶层接口</span>
    iface <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 仿真子接口</span>
    simuiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>simuInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TESSNG 路网子接口</span>
    netiface <span class="token operator">=</span> iface<span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 当前仿真计算批次</span>
    batchNum <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>batchNumber<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 当前已仿真时间，单位：毫秒</span>
    simuTime <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>simuTimeIntervalWithAcceMutiples<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 仿真速度调整</span>
    <span class="token comment"># simuiface.setAcceMultiples(1)</span>
    <span class="token comment"># 正在运行的所有车辆</span>
    allVehiStarted_lst <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>allVehiStarted<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取车辆状态，含位置</span>
    lVehiStatus <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisStatus<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># print(&quot;车辆位置：&quot;, [(status.vehiId, status.mPoint.x(), status.mPoint.y()) for status in lVehiStatus])</span>
    <span class="token comment"># 信号灯组相位颜色</span>
    lPhoneColor <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getSignalPhasesColor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># print(&quot;信号灯组相位颜色&quot;, [(pcolor.signalGroupId, pcolor.phaseNumber, pcolor.color, pcolor.mrIntervalSetted, pcolor.mrIntervalByNow) for pcolor in lPhoneColor])</span>
    <span class="token comment"># 获取当前仿真时间完成穿越采集器的所有车辆信息</span>
    lVehiInfo <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisInfoCollected<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if len(lVehiInfo) &gt; 0:</span>
    <span class="token comment">#    print(&quot;车辆信息采集器采集信息：&quot;, [(vinfo.collectorId, vinfo.vehiId) for vinfo in lVehiInfo])</span>
    <span class="token comment"># 获取最近集计时间段内采集器采集的所有车辆集计信息</span>
    lVehisInfoAggr <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisInfoAggregated<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if len(lVehisInfoAggr) &gt; 0:</span>
    <span class="token comment">#    print(&quot;车辆信息采集集计数据：&quot;, [(vinfo.collectorId, vinfo.vehiCount) for vinfo in lVehisInfoAggr])</span>
    <span class="token comment"># 获取当前仿真时间排队计数器计数的车辆排队信息</span>
    lVehiQueue <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisQueueCounted<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if len(lVehiQueue) &gt; 0:</span>
    <span class="token comment">#    print(&quot;车辆排队计数器计数：&quot;, [(vq.counterId, vq.queueLength) for vq in lVehiQueue])</span>
    <span class="token comment"># 获取最近集计时间段内排队计数器集计数据</span>
    lVehiQueueAggr <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisQueueAggregated<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if len(lVehiQueueAggr) &gt; 0:</span>
    <span class="token comment">#    print(&quot;车辆排队集计数据：&quot;, [(vqAggr.counterId, vqAggr.avgQueueLength) for vqAggr in lVehiQueueAggr])</span>
    <span class="token comment"># 获取当前仿真时间行程时间检测器完成的行程时间检测信息</span>
    lVehiTravel <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisTravelDetected<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if len(lVehiTravel) &gt; 0:</span>
    <span class="token comment">#    print(&quot;车辆行程时间检测信息：&quot;, [(vtrav.detectedId, vtrav.travelDistance) for vtrav in lVehiTravel])</span>
    <span class="token comment"># 获取最近集计时间段内行程时间检测器集计数据</span>
    lVehiTravAggr <span class="token operator">=</span> simuiface<span class="token punctuation">.</span>getVehisTravelAggregated<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># if len(lVehiTravAggr) &gt; 0:</span>
    <span class="token comment">#    print(&quot;车辆行程时间集计数据：&quot;, [(vTravAggr.detectedId, vTravAggr.vehiCount, vTravAggr.avgTravelDistance) for vTravAggr in lVehiTravAggr])</span>
</code></pre></div><h2 id="_8-特殊应用场景"><a href="#_8-特殊应用场景" class="header-anchor">#</a> 8. 特殊应用场景</h2> <h3 id="_8-1-公交系统"><a href="#_8-1-公交系统" class="header-anchor">#</a> 8.1. 公交系统</h3> <p>1-新建公交站点（港湾式，路侧式）</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 创建公交线路</span>
busLine <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusLine<span class="token punctuation">(</span><span class="token punctuation">[</span>link10<span class="token punctuation">,</span> link11<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> busLine <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
   busLine<span class="token punctuation">.</span>setDesirSpeed<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   busStation1 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusStation<span class="token punctuation">(</span>link10<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;公交站1&quot;</span><span class="token punctuation">)</span>
   busStation2 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusStation<span class="token punctuation">(</span>link11<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;公交站2&quot;</span><span class="token punctuation">)</span>
   busStation2<span class="token punctuation">.</span>setType<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#站点类型 1：路边式、2：港湾式</span>

</code></pre></div><p>2-新建公交线路</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 创建公交线路</span>
busLine <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusLine<span class="token punctuation">(</span><span class="token punctuation">[</span>link10<span class="token punctuation">,</span> link11<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> busLine <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
   busLine<span class="token punctuation">.</span>setDesirSpeed<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   busStation1 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusStation<span class="token punctuation">(</span>link10<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;公交站1&quot;</span><span class="token punctuation">)</span>
   busStation2 <span class="token operator">=</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBusStation<span class="token punctuation">(</span>link11<span class="token punctuation">.</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;公交站2&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>3-编辑线路站点</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">//</span>创建公交线路
IBusLine<span class="token operator">*</span> pBusLine <span class="token operator">=</span> gpTessInterface<span class="token operator">-</span><span class="token operator">&gt;</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>createBusLine<span class="token punctuation">(</span>QList<span class="token operator">&lt;</span>ILink<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> pLink10 <span class="token operator">&lt;&lt;</span> pLink11<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pBusLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pBusLine<span class="token operator">-</span><span class="token operator">&gt;</span>setDesirSpeed<span class="token punctuation">(</span>m2p<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			IBusStation<span class="token operator">*</span> pBusStation1 <span class="token operator">=</span> gpTessInterface<span class="token operator">-</span><span class="token operator">&gt;</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>createBusStation<span class="token punctuation">(</span>pLink10<span class="token operator">-</span><span class="token operator">&gt;</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;公交站1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			IBusStation<span class="token operator">*</span> pBusStation2 <span class="token operator">=</span> gpTessInterface<span class="token operator">-</span><span class="token operator">&gt;</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>createBusStation<span class="token punctuation">(</span>pLink11<span class="token operator">-</span><span class="token operator">&gt;</span>lanes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m2p<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;公交站2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 关联公交线路</span>
<span class="token keyword">if</span> busStation1 <span class="token keyword">and</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addBusStationToLine<span class="token punctuation">(</span>busLine<span class="token punctuation">,</span> busStation1<span class="token punctuation">)</span><span class="token punctuation">:</span>
  	busStation1<span class="token punctuation">.</span>setType<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;公交站1已关联到公交线路&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> busStation2 <span class="token keyword">and</span> tessngIFace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>netInterface<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addBusStationToLine<span class="token punctuation">(</span>busLine<span class="token punctuation">,</span> busStation2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;公交站2已关联到公交线路&quot;</span><span class="token punctuation">)</span>

QList<span class="token operator">&lt;</span>IBusStationLine<span class="token operator">*</span><span class="token operator">&gt;</span> lStationLine <span class="token operator">=</span> pBusLine<span class="token operator">-</span><span class="token operator">&gt;</span>stationLines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>!lStationLine<span class="token punctuation">.</span>isEmpty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			IBusStationLine<span class="token operator">*</span> pStationLine <span class="token operator">=</span> lStationLine<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token operator">//</span> 设置车辆停靠时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span>
			pStationLine<span class="token operator">-</span><span class="token operator">&gt;</span>setBusParkingTime<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress/document/V3.x/Python3/details.html" class="prev">
          接口详解
        </a></span> <span class="next"><a href="/vuepress/document/V3.x/Python3/demo.html">
          行业案例
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-6ea58682 data-v-98796a12><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_1-界面交互" class="sidebar-link reco-side-_1-界面交互" data-v-6ea58682>1. 界面交互</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_1-1-增加菜单及菜单项" class="sidebar-link reco-side-_1-1-增加菜单及菜单项" data-v-6ea58682>1.1. 增加菜单及菜单项</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_1-2-自定义车辆显示内容" class="sidebar-link reco-side-_1-2-自定义车辆显示内容" data-v-6ea58682>1.2. 自定义车辆显示内容</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_2-路网编辑" class="sidebar-link reco-side-_2-路网编辑" data-v-6ea58682>2. 路网编辑</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_2-1-代码新建路网" class="sidebar-link reco-side-_2-1-代码新建路网" data-v-6ea58682>2.1.  代码新建路网</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_2-2-地图转tessng路网" class="sidebar-link reco-side-_2-2-地图转tessng路网" data-v-6ea58682>2.2. 地图转TESSNG路网</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_2-3-修改路网元素" class="sidebar-link reco-side-_2-3-修改路网元素" data-v-6ea58682>2.3. 修改路网元素</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_2-4-编辑路网附着物" class="sidebar-link reco-side-_2-4-编辑路网附着物" data-v-6ea58682>2.4. 编辑路网附着物</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_3-信控编辑" class="sidebar-link reco-side-_3-信控编辑" data-v-6ea58682>3. 信控编辑</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_3-1-新建信号灯" class="sidebar-link reco-side-_3-1-新建信号灯" data-v-6ea58682>3.1. 新建信号灯</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_3-2-编辑信号灯组" class="sidebar-link reco-side-_3-2-编辑信号灯组" data-v-6ea58682>3.2.  编辑信号灯组</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_3-3-信控方案下发" class="sidebar-link reco-side-_3-3-信控方案下发" data-v-6ea58682>3.3. 信控方案下发</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_4-需求加载与管理" class="sidebar-link reco-side-_4-需求加载与管理" data-v-6ea58682>4. 需求加载与管理</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_4-1-流量加载" class="sidebar-link reco-side-_4-1-流量加载" data-v-6ea58682>4.1. 流量加载</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_4-2-路径管理" class="sidebar-link reco-side-_4-2-路径管理" data-v-6ea58682>4.2.  路径管理</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_4-3-路径重构" class="sidebar-link reco-side-_4-3-路径重构" data-v-6ea58682>4.3.  路径重构</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_5-仿真运行" class="sidebar-link reco-side-_5-仿真运行" data-v-6ea58682>5. 仿真运行</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_5-1-倒车入库" class="sidebar-link reco-side-_5-1-倒车入库" data-v-6ea58682>5.1. 倒车入库</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_5-2-循环仿真" class="sidebar-link reco-side-_5-2-循环仿真" data-v-6ea58682>5.2. 循环仿真</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_5-3-流程控制" class="sidebar-link reco-side-_5-3-流程控制" data-v-6ea58682>5.3. 流程控制</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_5-4-动作控制" class="sidebar-link reco-side-_5-4-动作控制" data-v-6ea58682>5.4.  动作控制</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_5-5-管控手段控制" class="sidebar-link reco-side-_5-5-管控手段控制" data-v-6ea58682>5.5. 管控手段控制</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_6-底层模型修改" class="sidebar-link reco-side-_6-底层模型修改" data-v-6ea58682>6. 底层模型修改</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_6-1-跟驰模型" class="sidebar-link reco-side-_6-1-跟驰模型" data-v-6ea58682>6.1 跟驰模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_6-2-换道模型" class="sidebar-link reco-side-_6-2-换道模型" data-v-6ea58682>6.2. 换道模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_6-3-冲突交互模型" class="sidebar-link reco-side-_6-3-冲突交互模型" data-v-6ea58682>6.3. 冲突交互模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_6-4-车辆汇入模型" class="sidebar-link reco-side-_6-4-车辆汇入模型" data-v-6ea58682>6.4.  车辆汇入模型</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_6-5-车辆穿越模型" class="sidebar-link reco-side-_6-5-车辆穿越模型" data-v-6ea58682>6.5. 车辆穿越模型</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_7-仿真输出" class="sidebar-link reco-side-_7-仿真输出" data-v-6ea58682>7. 仿真输出</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_7-1-获取路网几何线性数据" class="sidebar-link reco-side-_7-1-获取路网几何线性数据" data-v-6ea58682>7.1. 获取路网几何线性数据</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_7-2-检测器-采集器-排队计数器编辑" class="sidebar-link reco-side-_7-2-检测器-采集器-排队计数器编辑" data-v-6ea58682>7.2. 检测器|采集器|排队计数器编辑</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_7-3-输出控制" class="sidebar-link reco-side-_7-3-输出控制" data-v-6ea58682>7.3. 输出控制</a></li><li class="level-2" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_8-特殊应用场景" class="sidebar-link reco-side-_8-特殊应用场景" data-v-6ea58682>8. 特殊应用场景</a></li><li class="level-3" data-v-6ea58682><a href="/vuepress/document/V3.x/Python3/turorials.html#_8-1-公交系统" class="sidebar-link reco-side-_8-1-公交系统" data-v-6ea58682>8.1. 公交系统</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/vuepress/assets/js/app.bd557f6f.js" defer></script><script src="/vuepress/assets/js/4.fa06e885.js" defer></script><script src="/vuepress/assets/js/3.26fa4d2a.js" defer></script><script src="/vuepress/assets/js/1.8ad87f6f.js" defer></script><script src="/vuepress/assets/js/2.87db2cf7.js" defer></script><script src="/vuepress/assets/js/57.a78e7125.js" defer></script>
  </body>
</html>
